{
    "name": "Power of attorney",
    "data": [
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "MenuItem(Title:Wallet, Page:profile_view, Icon:\"icon-wallet\")\r\nMenuGroup(Title:Multiwallet, Icon:\"icon-arrow-right\"){\r\n    MenuItem(Title:Create multiwallet, Page:multiwallet_create, Icon:\"fa icon-plus\")\r\n    MenuItem(Title:Atoorney list, Page:attorney_list, Icon:\"icon-list\")\r\n}\r\nMenuItem(Title:Notifications, Page:notifications_list, Icon:\"icon-flag\")\r\nMenuItem(Title:Membership, Page:members_list, Icon:\"fa icon-people\")\r\nMenuGroup(Title:Admin, Icon:\"icon-arrow-right\"){\r\n\tMenuItem(Title:Roles, Page:roles_list, Icon:\"fa fa-list-ul\")\r\n\tMenuItem(Title:Voting, Page:voting_list, Icon:\"fa fa-edit\")\r\n}\r\nMenuGroup(Title:Admin, Icon:\"icon-arrow-right\"){\r\n\tMenuItem(Title:Voting templates, Page:voting_templates, Icon:\"fa icon-pin\")\r\n    MenuItem(Title:Platform parameter,Page:sysparams_list, Icon:\"fa icon-settings\")\r\n    MenuItem(Title:Candidate for validators, Page:sysparams_candidates, Icon:\"icon-list\")\r\n    MenuItem(Title:Ecosystems list, Page:sysparams_ecos, Icon:\"icon-list\")\r\n    MenuItem(Title:Tokens refund list, Page:tokenrefund_list, Icon:\"icon-list\")\r\n\tMenuItem(Title:Ecosystems, Page:membership_ecosystems, Icon:\"fa fa-list-ul\")\r\n}\nMenuItem(Title:$blockcron_list$, Page:blockcron_list, Icon:\"icon-list\")",
            "Name": "default_menu",
            "Type": "menu"
        },
        {
            "Name": "power_of_attorney",
            "Columns": "[{\"conditions\":\"true\",\"name\":\"params\",\"type\":\"json\"},{\"conditions\":\"true\",\"name\":\"address\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"date_expiration\",\"type\":\"datetime\"},{\"conditions\":\"true\",\"name\":\"key_id_attorney\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"date_last_transaction\",\"type\":\"datetime\"},{\"conditions\":\"true\",\"name\":\"rid\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"type\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"delete\",\"type\":\"character\"},{\"conditions\":\"true\",\"name\":\"contract\",\"type\":\"varchar\"}]",
            "Permissions": "{\"insert\": \"ContractAccess(\\\"attorney_Add\\\",\\\"MultiwalletCreate\\\")\", \"update\": \"ContractAccess(\\\"attorney_Add\\\",\\\"attorney_Del\\\",\\\"TokenTransferCheckAccess\\\")\", \"new_column\": \"ContractConditions(\\\"MainCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Conditions": "true",
            "Value": "TokenTransfer,Test",
            "Name": "attorney_contracts",
            "Type": "app_params"
        },
        {
            "Conditions": "true",
            "Value": "DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\r\nAppParam(App:#application_id#, Name: attorney_contracts, Source: src_contracts)\r\n\r\nSetTitle($attorney_add$)\r\n\r\nDBFind(Name: \"roles\", Source: src_roles)\r\nDBFind(Name:power_of_attorney).WhereId(#attorney_id#).Vars(power_of_attorney)\r\nJsonToSource(Source: src_params, Data: #power_of_attorney_params#)\r\n\r\nDiv(content-wrapper){\r\n    Div(breadcrumb){\r\n        LinkPage($attorney_list$, attorney_list)\r\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\r\n        Span(Class: text-muted, Body: $attorney_add$)\r\n    }\r\n    Form(row){\r\n        Div(col-md-6){\r\n            Div(panel panel-primary){\r\n                Div(panel-heading){\r\n                    LangRes(general_info)\r\n                }\r\n                Div(panel-body){\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 text-right){\r\n                                Label(LangRes(attorney_id))\r\n                            }\r\n                            Div(col-md-9 text-left){\r\n                                Input(Name: AttorneyId)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 text-right){\r\n                                Label(LangRes(contract))\r\n                            }\r\n                            Div(col-md-9 text-left){\r\n                                Select(Name: ContractName, Source: src_contracts, NameColumn: \"name\", ValueColumn: \"name\")\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 text-right){\r\n                                Label(LangRes(expiration_date))\r\n                            }\r\n                            Div(col-md-9 text-left){\r\n                                Input(Type:date, Name: DateExpiration)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    Div(pull-left){\r\n                        Button(Body: LangRes(back), Class: btn, Page: attorney_list)\r\n                    }\r\n                    Button(Body: LangRes(issue), Class: btn btn-primary, Page: attorney_list, Contract: AttorneyAdd)\r\n                }\r\n            }\r\n        }\r\n        Div(col-md-6){\r\n            Div(panel panel-primary){\r\n                Div(panel-heading){\r\n                    LangRes(power_of_attorney_params)\r\n                }\r\n                Div(panel-body){\r\n                    Div(row text-muted){\r\n                        Div(col-md-3){\r\n                            Label(LangRes(name))\r\n                        }\r\n                        Div(col-md-8){\r\n                            Label(LangRes(value))\r\n                        }\r\n                    }\r\n                    If(GetVar(params_count) == \"\"){\r\n                        SetVar(params_count,1)\r\n                    }\r\n                    If(#flag_del_last_param# == 1){\r\n                        SetVar(params_count, Calculate(Exp:#params_count#-1, Type: int))\r\n                    }\r\n                    \r\n                    SetVar(next_params_count, Calculate(Exp:#params_count#+1, Type: int))\r\n\r\n                    Range(params_range, 0, #params_count#)\r\n                    ForList(Source: params_range, Index:cur_param){\r\n                        Div(list-group-item){\r\n                            Div(row){\r\n                                Div(col-md-3){\r\n                                    Input(Name:ParamsNames)\r\n                                }\r\n                                Div(col-md-7){\r\n                                    Input(Name:ParamsValues)\r\n                                }\r\n                                Div(col-md-2){\r\n                                    If(And(#cur_param# == #params_count#, #cur_param# > 1)){\r\n                                        Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, PageParams: \"params_count=#params_count#,flag_del_last_param=1\", Page: attorney_add)\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(text-right){\r\n                        LinkPage(Body: LangRes(add_parameter), Page: attorney_add, PageParams: \"params_count=#next_params_count#\")\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Name": "attorney_add",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "true",
            "Value": "DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\nAppParam(App:#application_id#, Name: attorney_contracts, Source: src_contracts)\n\nSetTitle($attorney_edit$)\n\nDBFind(Name: \"roles\", Source: src_roles)\nDBFind(Name:power_of_attorney).WhereId(#attorney_id#).Vars(power_of_attorney)\nJsonToSource(Source: src_params, Data: #power_of_attorney_params#)\n\nDiv(content-wrapper){\n    Div(breadcrumb){\n        LinkPage($attorney_list$, attorney_list)\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\n        Span(Class: text-muted, Body: $attorney_edit$)\n    }\n    Form(row){\n        Div(col-md-6){\n            Div(panel panel-primary){\n                Div(panel-heading){\n                    LangRes(general_info)\n                }\n                Div(panel-body){\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 text-right){\n                                Label(LangRes(role))\n                            }\n                            Div(col-md-9 text-left){\n                                Select(Source: src_roles, NameColumn: \"role_name\", ValueColumn: \"id\", Value: #power_of_attorney_role_id_attorney#)\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 text-right){\n                                Label(LangRes(attorney_id))\n                            }\n                            Div(col-md-9 text-left){\n                                Input(Name: AttorneyId, Value: #power_of_attorney_key_id_attorney#)\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 text-right){\n                                Label(LangRes(contract))\n                            }\n                            Div(col-md-9 text-left){\n                                Select(Name: ContractName, Source: src_contracts, NameColumn: \"name\", ValueColumn: \"name\", Value: #power_of_attorney_contract#)\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 text-right){\n                                Label(LangRes(expiration_date))\n                            }\n                            Div(col-md-9 text-left){\n                                Input(Type:date, Name: DateExpiration, Value: DateTime(#power_of_attorney_date_expiration#, \"YYYY-MM-DD\"))\n                            }\n                        }\n                    }\n                }\n            }\n            \n        }\n        Div(col-md-6){\n            Div(panel panel-primary){\n                Div(panel-heading){\n                    LangRes(power_of_attorney_params)\n                }\n                Div(panel-body){\n                    Div(row text-muted){\n                        Div(col-md-3){\n                            Label(LangRes(name))\n                        }\n                        Div(col-md-7){\n                            Label(LangRes(value))\n                        }\n                    }\n                    If(GetVar(max_filled_params) == \"\"){\n                        ForList(Source: src_params, Index: cur_param){\n                            SetVar(max_filled_params, #cur_param#)\n                        }\n                    }\n                    If(GetVar(params_count) == \"\"){\n                        SetVar(params_count, #max_filled_params#)\n                    }\n                    If(#flag_del_last_param# == 1){\n                        SetVar(params_count, Calculate(Exp: #params_count# - 1, Type: int))\n                    }.ElseIf(#flag_del_last_param# > 1){\n                        SetVar(max_filled_params, #flag_del_last_param#)\n                        SetVar(params_count, #flag_del_last_param#)\n                    }\n                    SetVar(next_params_count, Calculate(Exp: #params_count# + 1, Type: int))\n\n                    ForList(Source: src_params, Index: cur_param){\n                        If(And(#cur_param# <= #max_filled_params#, #cur_param# <= #params_count#)){\n                            Div(list-group-item){\n                                Div(row){\n                                    Div(col-md-3){\n                                        Input(Name: ParamsNames, Value: #key#)\n                                    }\n                                    Div(col-md-7){\n                                        Input(Name: ParamsValues, Value: #value#)\n                                    }\n                                    Div(col-md-2){\n                                        If(And(#cur_param# > 1, #cur_param# == #params_count#)){\n                                            Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, PageParams: \"attorney_id=#attorney_id#,params_count=#params_count#,flag_del_last_param=#cur_param#,max_filled_params=#max_filled_params#\", Page: attorney_edit)\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Range(params_range, #max_filled_params#, #params_count#)\n                    ForList(Source: params_range, Index: cur_param){\n                        Div(list-group-item){\n                            Div(row){\n                                Div(col-md-3){\n                                    Input(Name:ParamsNames)\n                                }\n                                Div(col-md-7){\n                                    Input(Name:ParamsValues)\n                                }\n                                Div(col-md-2){\n                                    If(And(#cur_param# > 0, Calculate(#cur_param# + 1) == #params_count#)){\n                                        Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, Page: attorney_edit, PageParams: \"attorney_id=#attorney_id#,params_count=#params_count#,flag_del_last_param=1,max_filled_params=#max_filled_params#\")\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Div(text-right){\n                        LinkPage(Body: LangRes(add_parameter), Page: attorney_edit, PageParams: \"attorney_id=#attorney_id#,params_count=#next_params_count#,max_filled_params=#max_filled_params#\")\n                    }\n                }\n                Div(panel-footer text-right){\n                    Button(Body: LangRes(save), Class: btn btn-primary, Page: attorney_list, Contract: attorney_Add, Params: \"Id=#attorney_id#\")    \n                }\n            }  \n        }\n    }\n}",
            "Name": "attorney_edit",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "true",
            "Value": "SetTitle($attorney_list$)\nAddToolButton(Page: attorney_add, Title:$attorney_add$)\n\nDBFind(Name: power_of_attorney, Source: src_attorney).Where(address = #key_id# and delete = '0').Custom(custom_date_expiration){\n    DateTime(#date_expiration#,\"YYYY-MM-DD\")\n}.Custom(custom_action){\n    Button(Body: View, Class: btn btn-primary, Page: attorney_view, PageParams: \"attorney_id=#id#\")\n}.Custom(custom_key_id_attorney){\n    LinkPage(Body: Address(#key_id_attorney#), Page: profile_view, PageParams: \"v_member_id=#key_id_attorney#\")\n}\n\nDiv(content-wrapper){\n    Div(breadcrumb){\n        Span(Class: text-muted, Body: $attorney_list$)\n    }\n    Form(panel panel-primary){\n        Div(panel-body){\n            Div(row){\n                Div(table-responsive){\n                    Table(src_attorney, \"Contract=contract,Attorney=custom_key_id_attorney,Expiration date=custom_date_expiration,=custom_action\")\n                }\n            }\n        }\n    }\n}",
            "Name": "attorney_list",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "true",
            "Value": "If(#notific_id#>0){\r\n    DBFind(Name: notifications, Source: src_notifications).Columns(\"id,page_params->id\").Where(\"id=#notific_id#\").Vars(notific)\r\n    SetVar(attorney_id, #notific_page_params_id#)\r\n}\r\n\r\nSetTitle($attorney_view$)\r\n\r\nDBFind(Name:power_of_attorney).WhereId(#attorney_id#).Vars(power_of_attorney)\r\nJsonToSource(Source: src_params, Data: #power_of_attorney_params#)\r\n\r\nDiv(content-wrapper){\r\n    Div(breadcrumb){\r\n        LinkPage($attorney$, attorney_list)\r\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\r\n        Span(Class: text-muted, Body: $attorney_view$)\r\n    }\r\n    Form(row){\r\n        Div(col-md-10 col-lg-offset-1){\r\n            Div(panel panel-primary){\r\n                Div(panel-heading){\r\n                    LangRes(attorney_general_info)\r\n                }\r\n                Div(panel-body){\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 text-right){\r\n                                Label(LangRes(attorney))\r\n                            }\r\n                            Div(col-md-9 text-left){\r\n                                #power_of_attorney_key_id_attorney#\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 text-right){\r\n                                Label(LangRes(contract))\r\n                            }\r\n                            Div(col-md-9 text-left){\r\n                                #power_of_attorney_contract#\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 text-right){\r\n                                Label(LangRes(expiration_date))\r\n                            }\r\n                            Div(col-md-9 text-left){\r\n                                DateTime(#power_of_attorney_date_expiration#, \"YYYY-MM-DD\")\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(panel panel-primary){\r\n                Div(panel-heading){\r\n                    LangRes(attorney_params)\r\n                }\r\n                Div(panel-body){\r\n                    Div(row text-muted){\r\n                        Div(col-md-3 mt-lg){\r\n                            Label(LangRes(name))\r\n                        }\r\n                        Div(col-md-8 mt-lg){\r\n                            Label(LangRes(value))\r\n                        }\r\n                    }\r\n                    ForList(Source: src_params){\r\n                        Div(col-md-3 mt-lg){\r\n                            #key#\r\n                        }\r\n                        Div(col-md-8 mt-lg){\r\n                            #value#\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    If(#notific_id#>0){\r\n                        Button(Body: LangRes(informed), Class: btn btn-success, Contract: notifications_Close, Params: \"notific_id=#notific_id#\")\r\n                    }\r\n                    Button(Body: LangRes(edit), Class: btn btn-primary, Page: attorney_edit, PageParams: \"attorney_id=#attorney_id#\")\r\n                    Button(Body: LangRes(delete), Class: btn btn-danger, Contract: AttorneyDel, Params: \"Id=#attorney_id#\", Page: attorney_list)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Name": "attorney_view",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "true",
            "Value": "contract AttorneyAdd {\n    data {\n        Id string \"optional\"\n        AttorneyId int\n        ContractName string\n        DateExpiration string\n        ParamsNames array \"optional\"\n        ParamsValues array \"optional\"\n    }\n    conditions {\n        $Id = Int($Id)\n        if $Id > 0 {\n            $PowerOfAttorney = DBRow(\"power_of_attorney\").Where(\"id = ? and address=? and delete=?\",$Id,$key_id,0)\n            if !$PowerOfAttorney {\n                warning \"Power of attorney does not exists\"\n            }\n        }\n        $Attorney = DBRow(\"keys\").WhereId($AttorneyId)\n        if !$Attorney {\n            warning \"Attorney not found\"\n        }\n        $Contract = DBRow(\"contracts\").Where(\"name = ?\", $ContractName)\n        if !$Contract {\n            warning \"Contract not found\"\n        }\n        if Len($ParamsNames) > Len($ParamsValues) {\n            error \"Incorrect params list\"\n        }\n    }\n    action {\n        var params map i,id int\n        while i < Len($ParamsNames) {\n            params[$ParamsNames[i]] = $ParamsValues[i]\n            i = i + 1\n        }\n        if $Id > 0 {\n            DBUpdate(\"power_of_attorney\", $Id, \"key_id_attorney,contract,date_expiration,params\", $AttorneyId, $ContractName, \"timestamp \" + $DateExpiration, params)\n        }else{\n            id = DBInsert(\"power_of_attorney\", \"key_id_attorney,address,contract,date_expiration,params\", $AttorneyId, $key_id, $ContractName, \"timestamp \" + $DateExpiration, params)\n            var notification map\n            notification[\"member_id\"] = $AttorneyId\n            notification[\"sender\"] = 1\n            notification[\"text_header\"] = \"You got new power of attorney\"\n            notification[\"page_name\"] = \"attorney_add\"\n            notification[\"params_map\"] = Sprintf(`{\"id\":\"%v\"}`,id)\n            CallContract(\"notifications_Send\",notification)\n        }\n    }\n}",
            "Name": "AttorneyAdd",
            "Type": "contracts"
        },
        {
            "Conditions": "true",
            "Value": "contract AttorneyCheckAccess {\n    data {\n        contract_name string\n        wallet_id int\n    }\n\n    conditions {\n        var attorney_id int\n        attorney_id = DBFind(\"power_of_attorney\").Where(\"delete = ? and contract = ? and address = ? and (key_id_attorney = ? or rid = ?)\", 0, $contract_name, $wallet_id, $key_id, $role_id).One(\"id\")\n        if !attorney_id {\n            warning Sprintf(\"You don't have access to wallet %s\", $wallet_id)\n        }\n        $result = attorney_id\n    }\n    action {\n    }\n}",
            "Name": "AttorneyCheckAccess",
            "Type": "contracts"
        },
        {
            "Conditions": "true",
            "Value": "contract AttorneyDel {\n    data {\n        Id int\n    }\n    conditions {\n        $PowerOfAttorney = DBRow(\"power_of_attorney\").Where(\"id=? and address=?\",$Id,$key_id)\n        if !$PowerOfAttorney {\n            warning \"Power of attorney does not exists\"\n        }\n    }\n    action {\n        DBUpdate(\"power_of_attorney\", $Id, \"delete\", 1)\n    }\n}",
            "Name": "AttorneyDel",
            "Type": "contracts"
        }
    ]
}