{
    "name": "Power of attorney",
    "conditions": "ContractConditions(\"MainCondition\")",
    "data": [
        {
            "Name": "default_menu",
            "Conditions": "ContractAccess(\"@1EditMenu\")",
            "Value": "MenuItem(Title:$@1poa_list$, Page:@1poa_list, Icon:\"icon-note\")",
            "Type": "menu"
        },
        {
            "Name": "poa",
            "Columns": "[{\"conditions\":\"true\",\"name\":\"poa_sender\",\"type\":\"json\"},{\"conditions\":\"true\",\"name\":\"date_created\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"date_expiration\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"deleted\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"contract\",\"type\":\"text\"},{\"conditions\":\"true\",\"name\":\"ecosystem\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"params\",\"type\":\"json\"},{\"conditions\":\"true\",\"name\":\"template_id\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"poa_recipient\",\"type\":\"json\"},{\"conditions\":\"true\",\"name\":\"date_deleted\",\"type\":\"number\"}]",
            "Permissions": "{\"read\": \"true\", \"insert\": \"true\", \"update\": \"true\", \"new_column\": \"true\"}",
            "Type": "tables"
        },
        {
            "Name": "poa_templates",
            "Columns": "[{\"conditions\":\"true\",\"name\":\"deleted\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"contract\",\"type\":\"text\"},{\"conditions\":\"{\\\"read\\\":\\\"true\\\",\\\"update\\\":\\\"true\\\"}\",\"name\":\"ecosystem\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"date_created\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"params\",\"type\":\"json\"},{\"conditions\":\"true\",\"name\":\"creator\",\"type\":\"json\"},{\"conditions\":\"true\",\"name\":\"date_deleted\",\"type\":\"number\"}]",
            "Permissions": "{\"read\": \"true\", \"insert\": \"true\", \"update\": \"true\", \"new_column\": \"true\"}",
            "Type": "tables"
        },
        {
            "Name": "poa_add",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Form(){\r\n    Input(Name:TemplateId, Class: hidden, Value: #template_id#)\r\n    DBFind(@1poa_templates).Vars(pre).Where({id:#template_id#,ecosystem:#ecosystem_id#})\r\n    Div(row){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1recipient)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            Input(Name: Recipient, Placeholder: \"xxxx-xxxx-xxxx-xxxx-xxxx\")\r\n        }\r\n    }\r\n    Div(row mt-sm){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1expiration_date)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            Div(row){\r\n                Div(col-md-6){\r\n                    Input(Name: DateExpiration, Type: date)\r\n                }\r\n                \r\n                Div(col-md-6){\r\n                    Input(Name: TimeExpiration, Type: time)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Div(row mt-lg){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1contract)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            Input(Name:ContractName, Disabled: \"true\", Value: #pre_contract#)\r\n        }\r\n    }\r\n    Div(row mt){\r\n        Div(col-md-3){}\r\n        Div(col-md-9){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Div(row){\r\n                        Div(col-md-6){\r\n                            Span(Class: h6 m0 text-muted, Body: $@1parameter$)\r\n                        }\r\n                        Div(col-md-6){\r\n                            Span(Class: h6 m0 text-muted, Body: $@1value$)\r\n                        }\r\n                    }\r\n                    JsonToSource(pv, #pre_params#)\r\n                    ForList(Source: pv){\r\n                        Div(row mt-sm){\r\n                            Div(col-md-6){\r\n                                Input(Name: ParamArr, Value: `#key#`, Disabled: 1)\r\n                            }\r\n                            Div(col-md-6){\r\n                                Input(Name: ValueArr)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Button(Body: LangRes(@1add), Class: btn btn-primary pull-right mt, Page: @1poa_list, Contract: @1PoaAdd)\r\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: @1poa_template_list)\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poa_list",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetVar(this_page, @1poa_list)\nDiv(content-wrapper){\n\tSetTitle($@1poa_list$)\n\tAddToolButton(Page: @1poa_template_list, Title:$@1poa_template_list$)\n\n    If(GetVar(Search)){\n        SetVar(Where,{name:{\"$like\":#Search#}})\n    }.Else{\n        SetVar(Where,{id:{\"$neq\":0}}).(Search,)\n    }\n    \n    Form(panel panel-primary){\n        Div(panel-body){\n            Div(row){\n                Div(col-md-12){\n                    Form(input-group){\n                        Div(input-group-addon){\n                            LangRes(@1name)\n                        }\n                        Input(Name: Search, Value: #Search#)\n                        Div(input-group-btn){\n                            If(GetVar(Search)!=\"\"){\n                                Button(Class: btn btn-default fa fa-close, Page: #this_page#)\n                            }\n                            Button(Class: btn btn-default fa fa-search, Page: #this_page#, PageParams: \"Search=Val(Search),type=1\")\n                        }\n                    }\n                }\n            }\n\n\t\t\tDBFind(@1poa, src_poa).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,contract,params,date_created,date_expiration,poa_recipient->member_id,poa_recipient->member_name,poa_recipient->image_id,poa_sender->member_id,poa_sender->member_name,poa_sender->image_id,deleted\").Count(poa_count).Custom(_contract){\n\t\t\t\tSpan(Class: h5 text-bold, Body: #contract#)\n\t\t\t}.Custom(_creator){\n\t\t\t\tIf(And(#creator.member_name#!=NULL,#creator.member_name#!=\"\")){\n\t\t\t\t\tLinkPage(Class: #style_link# text-bold, Page: @1profile_view, PageParams: \"v_key_id=#creator.member_id#\"){\n\t\t\t\t\t\t#creator.member_name#\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.Custom(_date_created){\n\t\t\t\tDiv(h6){\n\t\t\t\t\tDiv(text-nowrap){DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\")}\n\t\t\t\t}\n\t\t\t}.Custom(_date_expiration){\n\t\t\t\tDiv(h6){\n\t\t\t\t\tDiv(text-nowrap){DateTime(DateTime: #date_expiration#, Format: \"DD.MM.YYYY HH:MI\")}\n\t\t\t\t}\n\t\t\t}.Custom(custom_recipient){\n\t\t\t\tLinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#poa_recipient.member_id#\"){\n\t\t\t\t\tIf(#poa_recipient.image_id#>0){\n\t\t\t\t\t\tImage(Src: Binary().ById(#poa_recipient.image_id#), Class: img-circle).Style(width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\n\t\t\t\t\t\tSpan(#poa_recipient.member_name#)\n\t\t\t\t\t}.Else{\n\t\t\t\t\t\tDiv(){\n\t\t\t\t\t\t\tSpan(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\n\t\t\t\t\t\t\tSpan(#poa_recipient.member_name#)\n\t\t\t\t\t\t}.Style(display:flex; align-items:center;)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.Custom(custom_arrow){\n\t\t\t\tEm(Class: fa fa-long-arrow-right fa-1x #style_text#)\n\t\t\t}.Custom(custom_sender){\n\t\t\t\tLinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#poa_sender.member_id#\"){\n\t\t\t\t\tIf(#poa_sender.image_id#>0){\n\t\t\t\t\t\tImage(Src: Binary().ById(#poa_sender.image_id#), Class: img-circle).Style(width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\n\t\t\t\t\t\tSpan(#poa_sender.member_name#)\n\t\t\t\t\t}.Else{\n\t\t\t\t\t\tDiv(){\n\t\t\t\t\t\t\tSpan(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\n\t\t\t\t\t\t\tSpan(#poa_sender.member_name#)\n\t\t\t\t\t\t}.Style(display:flex; align-items:center;)\n\t\t\t\t\t}\n\t\t\t\t}\n            }.Custom(_params){\n                Span(Class: text-muted h6){\n                    JsonToSource(pv, #params#)\n                    ForList(Source: pv, Index:s_ind){\n                        If(#s_ind#>1){\n                           Span(\",\").Style(margin-right: 5px;)\n                        }\n                        \"#key#\"\n                    }\n                }\n\t\t\t}.Custom(_action){\n                Div(text-right button-group text-nowrap){\n\t\t\t\t    If(#poa_sender.member_id#==#key_id#){\n\t\t\t\t\t\tIf(#deleted# == 0){\n\t\t\t\t\t\t\tButton(Class: fa fa-trash btn btn-danger mh-sm, Contract: @1PoaDelete, Params: \"PoaeId=#id#\", Page: #this_page#).Alert(Text: \"$@1sure_want_delete$\", ConfirmButton: $@1yes$, CancelButton: $@1no$, Icon: question)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n                    Button(Class: icon-eye btn btn-default mh-sm, PageParams: \"poa_id=#id#\", Page: @1poa_view).Popup(50, $@1poa_list$)\n\t\t\t\t}\n\t\t\t}\n\n            Div(row){\n                Div(col-md-12){\n                    If(#poa_count#>0){\n                        Div(table-responsive){\n                            Table(src_poa, \"$@1contract$=_contract,$@1sender$=custom_sender,=custom_arrow,$@1recipient$=custom_recipient,$@1params$=_params,$@1date_created$=_date_created,$@1expiration_date$=_date_expiration,=_action\")\n                        }\n                    }.Else{\n                        Div(h4 text-muted text-center){\n                            $@1poa_list$ $@1not_founded$\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poa_template_add",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Form(){\r\n    Div(row){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1contract)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            Input(Name:ContractName)\r\n        }\r\n    }\r\n    Div(row mt-sm){\r\n        Div(col-md-3 mt text-right){\r\n            Label(){\r\n                LangRes(@1params)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            If(GetVar(cs)==\"\"){\r\n                SetVar(cs,0)\r\n            }\r\n            If(#del# == 1){\r\n                SetVar(cs,Calculate(#cs# - 1))\r\n            }.Else{\r\n                SetVar(cs,Calculate(#cs# + 1))\r\n            }\r\n            \r\n            Range(params_range, 0, #cs#)\r\n            ForList(Source: params_range){\r\n                Div(row mt-sm){\r\n                    Div(col-md-10){\r\n                        Input(Name:ParamArr)\r\n                    }\r\n                    Div(col-md-2 text-center){\r\n                        If(#cs#==#params_range_index#){\r\n                            Button(Class:fa fa-trash btn btn-default, PageParams: \"cs=#cs#,del=1\", Page: @1poa_template_add).Popup(Header: $@1template_add$, Width: \"50\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Button(Class: btn-xs btn-link mt, Page: @1poa_template_add, PageParams:\"cs=#cs#\"){\r\n                Span(Class: h5, Body: $@1add_parameter$)\r\n            }.Popup(Header: $@1template_add$, Width: \"50\")\r\n        }\r\n    }\r\n    Button(Body: LangRes(@1add), Class: btn btn-primary pull-right mt-sm, Page: @1poa_template_list, Contract: @1PoaTemplateAdd)\r\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt-sm, Page: @1poa_template_list)\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poa_template_edit",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Form(){\r\n    Input(Name:TemplateId, Class: hidden, Value: #template_id#)\r\n    DBFind(@1poa_templates).Vars(pre).Where({id:#template_id#,ecosystem:#ecosystem_id#})\r\n    Div(row){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1contract)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            Input(Name:ContractName, Disabled: \"true\", Value: #pre_contract#)\r\n        }\r\n    }\r\n    Div(row mt-sm){\r\n        Div(col-md-3 mt text-right){\r\n            Label(){\r\n                LangRes(@1params)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            JsonToSource(pv, #pre_params#)\r\n            ForList(Source: pv, Index:s_ind){\r\n                SetVar(max_sec, #s_ind#)\r\n            }\r\n            If(GetVar(cs)==\"\"){\r\n                SetVar(cs, #max_sec#)\r\n            }\r\n            If(Or(#del_flag#==1,#del_data#>0)){\r\n                SetVar(cs, Calculate(Exp:#cs#-1, Type: int))\r\n            }\r\n            \r\n            SetVar(next_sec, Calculate(Exp:#cs#+1, Type: int))\r\n            SetVar(data_sec, Calculate(Exp:#cs#-#max_sec#, Type: int))\r\n\r\n            ForList(Source: pv, Index:s_ind){\r\n                If(#s_ind#>#cs#){\r\n                }.Else{\r\n                    Div(row mt-sm){\r\n                        Div(col-md-10){\r\n                            Input(Name: ParamArr, Value: `#key#`)\r\n                        }\r\n                        Div(col-md-2 text-center){\r\n                            If(#s_ind#==#cs#){\r\n                                Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, PageParams: \"template_id=#template_id#,cs=#cs#,del_data=#s_ind#\", Page: @1poa_template_edit).Popup(Header: $@1template_edit$, Width: \"50\")\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Range(params_range, #max_sec#, #cs#)\r\n            ForList(Source: params_range, Index:s_ind){\r\n                Div(row mt-sm){\r\n                    Div(col-md-10){\r\n                        Input(Name:ParamArr)\r\n                    }\r\n                    Div(col-md-2 text-center){\r\n                        If(#s_ind#==#data_sec#){\r\n                            Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, PageParams: \"template_id=#template_id#,cs=#cs#,del_flag=1\", Page: @1poa_template_edit).Popup(Header: $@1template_edit$, Width: \"50\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Button(Class: btn-xs btn-link mt, Page: @1poa_template_edit, PageParams: \"template_id=#template_id#,cs=#next_sec#\"){\r\n                Span(Class: h5, Body: $@1add_parameter$)\r\n            }.Popup(Header: $@1ecosystem$, Width: \"50\")\r\n        }\r\n    }\r\n    Button(Body: LangRes(@1save), Class: btn btn-primary pull-right mt-sm, Page: @1poa_template_list, Contract: @1PoaTemplateEdit)\r\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt-sm, Page: @1poa_template_list)\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poa_template_list",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetVar(this_page, @1poa_template_list)\r\nDiv(content-wrapper){\r\n\tSetTitle($@1poa_template_list$)\r\n\tDiv(breadcrumb){\r\n\t\tLinkPage($@1poa_list$, @1poa_list)\r\n\t\tSpan(/, mh)\r\n\t\tSpan($@1poa_template_list$, text-muted)\r\n\t}\r\n\t\r\n\tSetVar(admin_role_id, EcosysParam(Name:role_admin))\r\n    If(And(#admin_role_id#>0,#role_id#==#admin_role_id#)){\r\n        AddToolButton(Page: @1poa_template_add, Title: $@1template_add$).Popup(Header: $@1template_add$, Width: \"50\")\r\n    }\r\n\r\n    If(GetVar(Search)){\r\n        SetVar(Where,{name:{\"$like\":#Search#}})\r\n    }.Else{\r\n        SetVar(Where,{id:{\"$neq\":0}}).(Search,)\r\n    }\r\n    \r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Form(input-group){\r\n                        Div(input-group-addon){\r\n                            LangRes(@1name)\r\n                        }\r\n                        Input(Name: Search, Value: #Search#)\r\n                        Div(input-group-btn){\r\n                            If(GetVar(Search)!=\"\"){\r\n                                Button(Class: btn btn-default fa fa-close, Page: #this_page#)\r\n                            }\r\n                            Button(Class: btn btn-default fa fa-search, Page: #this_page#, PageParams: \"Search=Val(Search),type=1\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n\t\t\tDBFind(@1poa_templates, src_poa).Order(\"contract\").Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,contract,params,creator->member_id,creator->member_name,date_created,deleted\").Count(templates_count).Custom(_contract){\r\n\t\t\t\tButton(Class: btn-xs btn-link, PageParams: \"template_id=#id#\", Page: @1poa_add){\r\n\t\t\t\t\tSpan(Class: h5 text-bold, Body: #contract#)\r\n\t\t\t\t}.Popup(50, $@1poa_add$)\r\n\t\t\t}.Custom(_creator){\r\n\t\t\t\tIf(And(#creator.member_name#!=NULL,#creator.member_name#!=\"\")){\r\n\t\t\t\t\tLinkPage(Class: text-primary, Page: @1profile_view, PageParams: \"v_key_id=#creator.member_id#\"){\r\n\t\t\t\t\t\t#creator.member_name#\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}.Custom(_date){\r\n\t\t\t\tDiv(h6){\r\n\t\t\t\t\tDiv(text-nowrap){DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\")}\r\n\t\t\t\t}\r\n            }.Custom(_params){\r\n                Span(Class: text-muted h6){\r\n                    JsonToSource(pv, #params#)\r\n                    ForList(Source: pv, Index:s_ind){\r\n                        If(#s_ind#>1){\r\n                           Span(\",\").Style(margin-right: 5px;)\r\n                        }\r\n                        \"#key#\"\r\n                    }\r\n                }\r\n\t\t\t}.Custom(_action){\r\n\t\t\t\tIf(#creator.member_id#==#key_id#){\r\n\t\t\t\t\tDiv(text-right button-group text-nowrap){\r\n\t\t\t\t\t\tIf(#deleted# == 0){\r\n\t\t\t\t\t\t\tButton(Class: fa fa-trash btn btn-danger mh-sm, Contract: @1PoaTemplateDelete, Params: \"TemplateId=#id#\", Page: #this_page#).Alert(Text: \"$@1sure_want_delete$\", ConfirmButton: $@1yes$, CancelButton: $@1no$, Icon: question)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tButton(Class: fa fa-edit btn btn-default mh-sm, PageParams: \"template_id=#id#\", Page: @1poa_template_edit).Popup(50, $@1template_edit$)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    If(#templates_count#>0){\r\n                        Div(table-responsive){\r\n                            Table(src_poa, \"$@1contract$=_contract,$@1date_created$=_date,$@1creator$=_creator,$@1params$=_params,=_action\")\r\n                        }\r\n                    }.Else{\r\n                        Div(h4 text-muted text-center){\r\n                            $@1poa_template_list$ $@1not_founded$\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poa_view",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Form(){\r\n    Input(Name:TemplateId, Class: hidden, Value: #template_id#)\r\n    DBFind(@1poa).Vars(pre).Where({id:#poa_id#,ecosystem:#ecosystem_id#}).Columns(\"poa_sender->member_id,poa_recipient->member_id,contract,params,date_expiration\")\r\n    Div(row){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1sender)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            SetVar(sender_id, Address(#pre_poa_sender_member_id#))\r\n            Input(Name: Recipient, Disabled: \"true\", Value: #sender_id#)\r\n        }\r\n    }\r\n    Div(row mt-sm){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1recipient)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            SetVar(recipient_id, Address(#pre_poa_recipient_member_id#))\r\n            Input(Name: Recipient, Disabled: \"true\", Value: #recipient_id#)\r\n        }\r\n    }\r\n    Div(row mt-sm){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1expiration_date)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            SetVar(date_expiration, DateTime(DateTime: #pre_date_expiration#, Format: \"DD.MM.YYYY HH:MI\"))\r\n            Input(Name: DateExpiration, Disabled: \"true\", Value: #date_expiration#)\r\n        }\r\n    }\r\n    Div(row mt-lg){\r\n        Div(col-md-3 mt-sm text-right){\r\n            Label(){\r\n                LangRes(@1contract)\r\n            }\r\n        }\r\n        Div(col-md-9){\r\n            Input(Name:ContractName, Disabled: \"true\", Value: #pre_contract#)\r\n        }\r\n    }\r\n    Div(row mt){\r\n        Div(col-md-3){}\r\n        Div(col-md-9){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Div(row){\r\n                        Div(col-md-6){\r\n                            Span(Class: h6 m0 text-muted, Body: $@1parameter$)\r\n                        }\r\n                        Div(col-md-6){\r\n                            Span(Class: h6 m0 text-muted, Body: $@1value$)\r\n                        }\r\n                    }\r\n                    JsonToSource(pv, #pre_params#)\r\n                    ForList(Source: pv){\r\n                        Div(row mt-sm){\r\n                            Div(col-md-6){\r\n                                Input(Name: ParamArr, Value: `#key#`, Disabled: 1)\r\n                            }\r\n                            Div(col-md-6){\r\n                                Input(Name: ValueArr, Value: `#value#`, Disabled: 1)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: @1poa_list)\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "PoaAdd",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract PoaAdd {\n    data {\n        Recipient string\n        DateExpiration string \"optional\"\n        TimeExpiration string \"optional\"\n        TemplateId int\n        ParamArr array\n        ValueArr array\n    }\n\n    func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"@1members\").Where({ecosystem:$ecosystem_id, id:kid}).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        } else {\n            member = DBFind(\"@1keys\").Where({ecosystem:$ecosystem_id, id:kid}).Row()\n            if member {\n                res[\"member_id\"] = member[\"id\"]\n                res[\"member_name\"] = IdToAddress(Int(member[\"id\"]))\n                res[\"image_id\"] = 0\n            }\n        }\n        return res\n    }\n\n    func trimZeroTime(s string) string {\n        if Contains(s, \"T00:00:00Z\") {\n            s = s Replace(s, \"T00:00:00Z\", \"\")\n        }\n        return s\n    }\n\n    func dateAddTime(d, t string) string {\n        var dt string\n        if Size(t) == 5 {\n            dt = Sprintf(\"%v %v:00\", trimZeroTime(d), t)\n        }\n        return dt\n    }\n\n    conditions {\n        //check date\n        $date_expiration = dateAddTime($DateExpiration, $TimeExpiration)\n        if UnixDateTime($date_expiration) == 0 {        // invalid datetimes\n            error LangRes(\"@1invalid_expiration_date\", \"en\") \n        }\n\n        //check the recipient key\n        $recipient_id = AddressToId($Recipient)\n        if $recipient_id == 0 {\n            error Sprintf(LangRes(\"@1recipient_x_invalid\", \"en\"), $Recipient)\n        }\n\n        //check template\n        $template_map = DBFind(\"@1poa_templates\").Where({ecosystem:$ecosystem_id, id:$TemplateId}).Row()\n        if !$template_map {\n            error Sprintf(LangRes(\"@1poa_template_not_found\", \"en\"), $Recipient)\n        }\n    }\n    \n    action {\n        var i int params map\n        while i < Len($ParamArr) {\n            params[$ParamArr[i]] = $ValueArr[i]\n            i = i + 1\n        }\n        \n        var m map\n        m[\"contract\"] = $template_map[\"contract\"]\n        m[\"date_created\"] = $block_time \n        m[\"date_expiration\"] = UnixDateTime($date_expiration)\n        m[\"deleted\"] = 0\n        m[\"ecosystem\"] = $ecosystem_id\n        m[\"params\"] = params\n        m[\"poa_recipient\"] = getMemberInfo($recipient_id )\n        m[\"poa_sender\"] = getMemberInfo($key_id)\n        m[\"template_id\"] = $TemplateId\n        $result = DBInsert(\"@1poa\", m)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "PoaDelete",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract PoaDelete {\n    data {\n        PoaeId int\n    }\n\n    conditions {\n        var poa_map map\n        poa_map = DBFind(\"@1poa\").Where({\"id\":$PoaeId, \"ecosystem\":$ecosystem_id}).Columns(\"id,poa_sender->member_id\").Row()\n        if !poa_map {\n            error LangRes(\"@1poa_not_found\", \"en\") \n        }\n        if Int(poa_map[\"poa_sender.member_id\"]) != $key_id {\n            error LangRes(\"@1poa_not_rights_to_delete\", \"en\") \n        }\n    }\n\n    action {\n        var m map\n        m[\"deleted\"] = 1\n        m[\"date_deleted\"] = $block_time\n        DBUpdate(\"@1poa\", $PoaeId, m)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "PoaTemplateAdd",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract PoaTemplateAdd {\n    data {\n        ContractName string\n        ParamArr array\n    }\n\n    func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"@1members\").Where({ecosystem:$ecosystem_id, id:kid}).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        } else {\n            member = DBFind(\"@1keys\").Where({ecosystem:$ecosystem_id, id:kid}).Row()\n            if member {\n                res[\"member_id\"] = member[\"id\"]\n                res[\"member_name\"] = IdToAddress(Int(member[\"id\"]))\n                res[\"image_id\"] = 0\n            }\n        }\n        return res\n    }\n\n    conditions {\n        var role_id_param string\n        role_id_param = EcosysParam(\"role_admin\")\n        if Size(role_id_param) == 0 {\n            error LangRes(\"@1poa_not_rights_to_create\", \"en\") \n        }\n        var role_id int\n        role_id = Int(role_id_param)\n        \n        if !RoleAccess(role_id) {\n            error LangRes(\"@1poa_not_rights_to_create\", \"en\") \n        }  \n    }\n    \n    action {\n        var i int params map\n        while i < Len($ParamArr) {\n            params[$ParamArr[i]] = \"\"\n            i = i + 1\n        }\n\n        var m map\n        m[\"creator\"] = getMemberInfo($key_id)\n        m[\"contract\"] = $ContractName\n        m[\"date_created\"] = $block_time\n        m[\"params\"] = params\n        m[\"deleted\"] = 0\n        m[\"ecosystem\"] = $ecosystem_id\n        $result = DBInsert(\"@1poa_templates\", m)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "PoaTemplateDelete",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract PoaTemplateDelete {\n    data {\n        TemplateId int\n    }\n\n    conditions {\n        var poa_map map\n        poa_map = DBFind(\"@1poa_templates\").Where({\"id\":$TemplateId, \"ecosystem\":$ecosystem_id}).Columns(\"id,creator->member_id\").Row()\n        if !poa_map {\n            error LangRes(\"@1poa_template_not_found\", \"en\") \n        }\n        if Int(poa_map[\"creator.member_id\"]) != $key_id {\n            error LangRes(\"@1poa_not_rights_to_delete\", \"en\")\n        }\n    }\n\n    action {\n        var m map\n        m[\"deleted\"] = 1\n        m[\"date_deleted\"] = $block_time\n        DBUpdate(\"@1poa_templates\", $TemplateId, m)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "PoaTemplateEdit",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract PoaTemplateEdit {\n    data {\n        TemplateId int\n        ParamArr array\n    }\n\n    conditions {\n        var poa_template_map map\n        poa_template_map = DBFind(\"@1poa_templates\").Where({\"id\":$TemplateId, \"ecosystem\":$ecosystem_id}).Columns(\"id,creator->member_id\").Row()\n        if !poa_template_map {\n            error LangRes(\"@1poa_template_not_found\", \"en\")\n        }\n        if Int(poa_template_map[\"creator.member_id\"]) != $key_id {\n            error LangRes(\"@1poa_not_rights_to_edit\", \"en\") \n        }\n    }\n    \n    action {\n        var i int params map\n        while i < Len($ParamArr) {\n            params[$ParamArr[i]] = \"\"\n            i = i + 1\n        }\n\n        var m map \n        m[\"params\"] = params\n        DBUpdate(\"@1poa_templates\", $TemplateId, m)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "PoaTokensSend",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract PoaTokensSend {\n    data {\n        Amount money\n        Sender string\n        Recipient string\n        Comment string \"optional\"\n    }\n\n    func getPermission() {\n        var array_permissions array result i int prevContract string\n        array_permissions = [\"@1PoaTokensSend\"]\n\n        prevContract = $stack[0]\n        if Len($stack) > 2 {\n            prevContract = $stack[Len($stack) - 2]\n        }\n        while i < Len(array_permissions) {\n            var contract_name string\n            contract_name = array_permissions[i]\n            if contract_name==prevContract {\n                result = 1\n            }\n            i = i + 1\n        }\n\n        if result == 0 {\n            error LangRes(\"@1tokens_transfer_cannot_be_made\", \"en\")\n        }\n    }\n\n    func checkKeys() {\n        $sender_id = AddressToId($Sender)\n        $recipient_id = AddressToId($Recipient)\n\n        //check the sender key\n        if $sender_id == 0 {\n            error Sprintf(LangRes(\"@1sender_x_invalid\", \"en\"), $Sender)\n        }\n        //check the recipient key\n        if $recipient_id == 0 {\n            error Sprintf(LangRes(\"@1recipient_x_invalid\", \"en\"), $Recipient)\n        }\n    }\n\n    func checkPoa() {\n        var poa_map map\n        poa_map = DBFind(\"@1poa\").Where({\"contract\":\"@1PoaTokensSend\", \"poa_sender->member_id\": $sender_id, \"poa_recipient->member_id\":$key_id, \"ecosystem\":$ecosystem_id, \"deleted\": 0}).Columns(\"id,date_expiration,params->amount_max,params->amount_max_day,params->amount_max_month,params->amount_day,params->amount_month,params->date_day,params->date_month\").Row()\n        if !poa_map {\n            error LangRes(\"@1poa_not_found\", \"en\")\n        }\n\n        if UnixDateTime(BlockTime()) > Int(poa_map[\"date_expiration\"]) {\n            error LangRes(\"@1poa_expired\", \"en\")\n        }\n\n        $poa_id = poa_map[\"id\"]\n        $amount_max = poa_map[\"params.amount_max\"]\n        $amount_max_day = poa_map[\"params.amount_max_day\"]\n        $amount_max_month = poa_map[\"params.amount_max_month\"]\n        $amount_day = poa_map[\"params.amount_day\"]\n        $amount_month = poa_map[\"params.amount_month\"]\n        $date_day = poa_map[\"params.date_day\"]       // 2018-10-19 00:00:00\n        $date_month = poa_map[\"params.date_month\"]   // 2018-10-01 00:00:00\n\n        $cur_date_day = UnixDateTime(Substr(BlockTime(), 0, 10) + \" 00:00:00\")\n        $cur_date_month = UnixDateTime(Substr(BlockTime(), 0, 8) + \"01 00:00:00\")\n    }\n\n    func checkLimit() {\n        if Int($cur_date_day) > Int($date_day) {\n            $date_day = $cur_date_day\n            $amount_day = 0\n        }\n        if Int($cur_date_month) > Int($date_month) {\n            $date_month = $cur_date_month\n            $amount_month = 0\n        }\n\n        if Money($amount_max) < Money($Amount) {\n            error LangRes(\"poa_exceeded_single_limit\", \"en\")\n        }\n        if Money($amount_max_day) < Money($amount_day) + Money($Amount) {\n            error LangRes(\"poa_exceeded_daily_limit\", \"en\")\n        }\n        if Money($amount_max_month) < Money($amount_month) + Money($Amount) {\n            error LangRes(\"poa_exceeded_monthly_limit\", \"en\")\n        }\n    }\n\n    func updateParams() {\n        $amount_day = Money($amount_day) + Money($Amount)\n        $amount_month = Money($amount_month) + Money($Amount)\n\n        var m map\n        m[\"amount_max\"] = Str($amount_max)\n        m[\"amount_max_day\"] = Str($amount_max_day)\n        m[\"amount_max_month\"] = Str($amount_max_month)\n        m[\"amount_day\"] = Str($amount_day)\n        m[\"amount_month\"] = Str($amount_month)\n        m[\"date_day\"] = Str($date_day)\n        m[\"date_month\"] = Str($date_month)\n        DBUpdate(\"@1poa\", Int($poa_id), {\"params\": m})\n    }\n\n    conditions {\n        getPermission()\n        checkKeys()\n        checkPoa()\n        checkLimit()\n    }\n\n    action {\n        @1TokensTransfer(\"Amount,SenderId,RecipientId,Comment\", $Amount, $sender_id, $recipient_id, $Comment)\n        updateParams()\n    }\n}",
            "Type": "contracts"
        }
    ]
}