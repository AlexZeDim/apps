{
    "name": "Errand",
    "data": [
        {
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1errands$, Page: @1errand_list,Icon:\"icon-envelope\")\r\n    ",
            "Name": "default_menu",
            "Type": "menu"
        },
        {
            "Name": "errand_access",
            "Columns": "[{\"name\":\"deleted\",\"conditions\":\"ContractAccess(\\\"@1ErrandAccess\\\")\",\"type\":\"text\"},{\"name\":\"ecosystem_id\",\"conditions\":\"false\",\"type\":\"text\"},{\"name\":\"role_id\",\"conditions\":\"false\",\"type\":\"text\"}]",
            "Permissions": "{\"insert\": \"ContractAccess(\\\"@1ErrandAccess\\\")\", \"update\": \"ContractAccess(\\\"@1ErrandAccess\\\")\", \"new_column\": \"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Div(content-wrapper){\r\n    SetTitle($@1access_errands$)  \r\n    Form(){   \r\n        Div(col-md-12){\r\n            Label(){\r\n                Span($@1choose_role_errand$)\r\n                Span(Class: text-danger,Body: *)\r\n            }\r\n            DBFind(@1roles, src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\")\r\n            Select(Name: var_id, Source: src_roles, NameColumn: role_name, ValueColumn: id)\r\n        }\r\n        Div(col-md-12 mt-sm){\r\n            DBFind(\"@1errand_access\",Source: src_access).Where({\"ecosystem_id\":#ecosystem_id#,\"deleted\":0}).Custom(role_name){\r\n                DBFind(\"@1roles\").Where({\"id\":#role_id#,\"ecosystem\":#ecosystem_id#}).Vars(n)\r\n                Span(#n_role_name#)\r\n            }.Custom(delete){\r\n                Button(Body:$@1remove_access$,Contract:@1ErrandAccess,Page:@1errand_list,PageParams:\"type=#type#\",Params:\"type_del=1,id_del_role=#id#\",Class: pull-right btn btn-link)\r\n            }.Count(added_roles)\r\n            If(#added_roles# > 0){\r\n                Table(Source: src_access,Columns: \"$@1role$=role_name,=delete\")\r\n            }\r\n        }.Style(padding-top:20px;)\r\n        Div(row mt){\r\n            Div(col-md-12){\r\n                Button(Body: $@1back$, Class: btn btn-default pull-left, Page: @1errand_list,PageParams:\"type=#type#\")\r\n                Button(Body: $@1add_role$,Contract: @1ErrandAccess, Class: btn btn-primary pull-right,Page: @1errand_list,PageParams:\"type=#type#\")\r\n            }\r\n        }\r\n    }\r\n}",
            "Name": "errand_access",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetVar(this_page,\"@1errand_create\")\r\n\r\nIf(GetVar(errand_type)==\"\"){\r\n    SetVar(errand_type,0)\r\n}\r\n\r\nForm(){\r\n    Div(list-group-item){\r\n        Div(row mb-sm){\r\n            Div(col-md-3 mt-sm text-right){\r\n                Label(){\r\n                    $@1errand_performer$\r\n                    Span(*,text-danger)\r\n                }\r\n            }\r\n            Div(col-md-9 text-left){\r\n                If(GetVar(errand_type)==0){\r\n                    Button(Body: $@1role$, Class: btn btn-primary disabled)\r\n                    Button(Body: $@1member$, Page: #this_page#, PageParams: \"errand_type=1,type=#type#\", Class: btn btn-primary).Popup(50, \"$@1new_errand$\")                \r\n                    \r\n                }.ElseIf(GetVar(errand_type)==1){\r\n                    Button(Body: $@1role$, Page: #this_page#, PageParams: \"errand_type=0,type=#type#\", Class: btn btn-primary).Popup(50, \"$@1new_errand$\")\r\n                    Button(Body: $@1member$, Class: btn btn-primary disabled)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Div(list-group-item){\r\n        Div(row){\r\n            Div(col-md-3 mt-sm text-right){\r\n                Label(){\r\n                    If(GetVar(errand_type)==0){\r\n                        $@1choose_role_errand$ \r\n                    }.ElseIf(GetVar(errand_type)==1){\r\n                        $@1wallet_address$\r\n                    }\r\n                    Span(*,text-danger)\r\n                }\r\n            }\r\n            Div(col-md-9 text-left){\r\n                If(GetVar(errand_type)==0){\r\n                    DBFind(@1roles, src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\")\r\n                    Select(Name: rec_role_id, Source: src_roles, NameColumn: role_name, ValueColumn: id)\r\n                }.ElseIf(GetVar(errand_type)==1){\r\n                    Input(member_id,Placeholder: \"0000-0000-0000-0000-000\")\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Div(list-group-item){\r\n        Div(row mb-sm){\r\n            Div(col-md-3 mt-sm text-right){\r\n                Label(){\r\n                    $@1name$\r\n                    Span(*,text-danger)\r\n                }\r\n            }\r\n            Div(col-md-9 text-left){\r\n                Input(Name: errand_name, Value: \"New errand\")\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(col-md-3 mt-sm text-right){\r\n                Label(For: end_date){\r\n                    $@1date_end$\r\n                    Span(*,text-danger)\r\n                }\r\n            }\r\n            Div(col-md-9 text-left){\r\n                Div(row){\r\n                    Div(col-md-6){\r\n                        Input(Name: end_date, Type: date)\r\n                    }\r\n                    Div(col-md-6){\r\n                        Input(Name: end_time, Type: time)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }    \r\n    Div(list-group-item){\r\n        Div(row mb-sm){\r\n            Div(col-md-3 mt-sm text-right){\r\n                Label(){\r\n                    $@1body_text$\r\n                    Span(*,text-danger)\r\n                }\r\n            }\r\n            Div(col-md-9 text-left){\r\n                Input(Name: errand_text,Type: textarea)\r\n            }\r\n        }\r\n    }\r\n    Div(row mt){\r\n        Div(col-md-12){\r\n            Button(Body: $@1back$, Class: btn btn-default,PageParams:\"type=#type#\",Page: @1errand_list)\r\n            Button(Body: $@1send$, Class: btn btn-primary pull-right,PageParams:\"type=#type#\",Page: @1errand_list, Contract: @1ErrandCreate, Params: \"errand_type=#errand_type#,send_role_id=#role_id#\")\r\n        }\r\n    }\r\n}",
            "Name": "errand_create",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetVar(this_page, @1errand_list).(this_table, @1notifications)\r\nIf(GetVar(page_par)!=\"\"){\r\n    SetVar(Name: type, Value: #page_par#)\r\n}\r\nSetTitle($@1errands$)\r\nIf(#role_id# == EcosysParam(role_admin)){\r\n    AddToolButton(Title: $@1section_access_rights$, Page:@1errand_access,PageParams:\"type=#type#\", Icon: icon-plus).Popup(50, \"$@1section_access_rights$\")\r\n}\r\nDBFind(@1errand_access).Where({ecosystem_id:#ecosystem_id#,role_id:#role_id#,deleted:0}).Vars(check)\r\nIf(#check_id# > 0){ \r\n    AddToolButton(Title: $@1send$, Page: @1errand_create,PageParams:\"type=#type#\", Icon: icon-plus).Popup(50, \"$@1new_errand$\")\r\n}\r\nDiv(Class: content-wrapper){\r\n    If(Or(#type#==0,#type#==1)){\r\n    }.Else{\r\n        SetVar(Name: type, Value: 0) \r\n    }\r\n    Div(row){\r\n        Div(col-md-12){\r\n            Div(btn-group){\r\n                If(#type#==0){\r\n                    Span(Button(Body: Em(Class: fa fa-user) $@1individual_errands$, Page: @1errand_list, PageParams: \"type=0\", Class: btn bg-gray-lighter)).Style(margin-left:5px;)\r\n                }.Else{\r\n                    Span(Button(Body: Em(Class: fa fa-user) $@1individual_errands$, Page: @1errand_list, PageParams: \"type=0\", Class: btn bg-gray)).Style(margin-left:5px;)\r\n                }\r\n                If(#type#==1){\r\n                    Span(Button(Body: Em(Class: fa fa-users) $@1roles_errands$, Page: @1errand_list, PageParams: \"type=1\", Class: btn bg-gray-lighter)).Style(margin-left:5px;)\r\n                }.Else{\r\n                    Span(Button(Body: Em(Class: fa fa-users) $@1roles_errands$, Page: @1errand_list, PageParams: \"type=1\", Class: btn bg-gray)).Style(margin-left:5px;)\r\n                }\r\n                If(EcosysParam(Name:role_admin)==#role_id#){\r\n                    Span(Button(Body: $@1update_statuses$, Class: btn btn-default, Page: @1errand_list,PageParams: \"type=#type#\", Contract: @1ErrandStatusUpdate)).Style(margin-left:5px;)\r\n                }\r\n            }\r\n            Div(btn-group pull-right){\r\n                If(GetVar(Search)!=\"\"){\r\n                    Button(Class:btn bg-gray-lighter, Page: @1errand_list, PageParams: \"Status=0,Search=#Search#,type=#type#\"){Span(Body: Em(Class:fa fa-hourglass-half), Class: text-info)}\r\n                    Button(Class:btn bg-gray-lighter, Page: @1errand_list, PageParams: \"Status=1,Search=#Search#,type=#type#\"){Span(Body: Em(Class:fa fa-hourglass-end),Class: text-success)}\r\n                    Button(Class:btn bg-gray-lighter, Page: @1errand_list, PageParams: \"Status=-1,Search=#Search#,type=#type#\"){Span(Body: Em(Class:fa fa-times), Class: text-danger)} \r\n                }.Else{\r\n                    Button(Class:btn bg-gray-lighter, Page: @1errand_list, PageParams: \"Status=0,type=#type#\"){Span(Body: Em(Class:fa fa-hourglass-half), Class: text-info)}\r\n                    Button(Class:btn bg-gray-lighter, Page: @1errand_list, PageParams: \"Status=1,type=#type#\"){Span(Body: Em(Class:fa fa-hourglass-end),Class: text-success)}\r\n                    Button(Class:btn bg-gray-lighter, Page: @1errand_list, PageParams: \"Status=-1,type=#type#\"){Span(Body: Em(Class:fa fa-times), Class: text-danger)} \r\n                }            \r\n            }\r\n            If(Or(GetVar(Search)!=\"\",GetVar(Status)==-1,GetVar(Status)==0,GetVar(Status)==1)){\r\n                Span(Button(Class: btn btn-link pull-right, Page: @1errand_list,PageParams: \"type=#type#\", Body: $@1clear_filters$)).Style(padding-left:10px)\r\n            }\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(col-md-12){\r\n            Form(panel panel-primary){\r\n                Div(panel-body){\r\n                    Div(row){\r\n                        Div(col-md-12){\r\n                            If(#type#==0){  \r\n                                If(GetVar(Search)!=\"\"){\r\n                                    If(Or(GetVar(Status)==-1,GetVar(Status)==0,GetVar(Status)==1)){\r\n                                        SetVar(where,\"{'page_params->status':#Status#,'ecosystem':#ecosystem_id#,'page_params->name':{$like:#Search#},'page_params->type':task,'recipient->member_id': {'$neq': 0}}\")\r\n                                    }.Else{\r\n                                        SetVar(where,\"{'ecosystem':#ecosystem_id#,'page_params->name':{$like:#Search#},'page_params->type':task,'recipient->member_id': {'$neq': 0}}\")\r\n                                    }\r\n                                }.Else{\r\n                                    If(Or(GetVar(Status)==-1,GetVar(Status)==0,GetVar(Status)==1)){\r\n                                        SetVar(where,\"{'page_params->status':#Status#,'ecosystem':#ecosystem_id#,'page_params->type':task,'recipient->member_id': {'$neq': 0}}\").(Search,)\r\n                                    }.Else{\r\n                                        SetVar(where,\"{'ecosystem':#ecosystem_id#,'page_params->type':task,'recipient->member_id': {'$neq': 0}}\").(Search,)\r\n                                    }\r\n                                }             \r\n                            }\r\n                            If(#type#==1){\r\n                                If(GetVar(Search)!=\"\"){\r\n                                    If(Or(GetVar(Status)==-1,GetVar(Status)==0,GetVar(Status)==1)){\r\n                                        SetVar(where,\"{'page_params->status':#Status#,'ecosystem':#ecosystem_id#,'page_params->name':{$like:#Search#},'page_params->type':task,'recipient->role_id': {'$gt': 0}}\")\r\n                                    }.Else{\r\n                                        SetVar(where,\"{'ecosystem':#ecosystem_id#,'page_params->name':{$like:#Search#},'page_params->type':task,'recipient->role_id': {'$gt': 0}}\")\r\n                                    }\r\n                                }.Else{\r\n                                    If(Or(GetVar(Status)==-1,GetVar(Status)==0,GetVar(Status)==1)){\r\n                                        SetVar(where,\"{'page_params->status':#Status#,'ecosystem':#ecosystem_id#,'page_params->type':task,'recipient->role_id': {'$gt': 0}}\").(Search,)\r\n                                    }.Else{\r\n                                        SetVar(where,\"{'ecosystem':#ecosystem_id#,'page_params->type':task,'recipient->role_id': {'$gt': 0}}\").(Search,)\r\n                                    }\r\n                                }\r\n                            }\r\n                            SetVar(pager_table, @1notifications).(pager_page, @1errand_list).(pager_limit, 25).(page_par, #type#)\r\n                            Include(@1pager_header)\r\n                            DBFind(@1notifications,src_errands).Columns(\"id,ecosystem,page_params->status,page_params->name,recipient->role_name,recipient->role_id,recipient->member_name,recipient->member_id,recipient->image_id,sender->image_id,sender->role_name,sender->role_id,date_created,page_params->date_end\").Where(#where#).Limit(#pager_limit#).Offset(#pager_offset#).Custom(_status){\r\n                                If(#page_params.status# == 0){\r\n                                    Span(Body:Em(Class:fa fa-hourglass-half) $@1in_progress$,Class: text-info h4)\r\n                                }.ElseIf(#page_params.status# == -1){\r\n                                    Span(Body:Em(Class:fa fa-times) $@1expired$,Class: text-danger h4)\r\n                                }.ElseIf(#page_params.status# == 1){\r\n                                    Span(Body:Em(Class:fa fa-hourglass-end) $@1done$,Class: text-success h4)\r\n                                }\r\n                            }.Custom(_role){\r\n                                If(#recipient.role_id# > 0){\r\n                                    LinkPage(Class: text-primary h5 text-bold, Page: @1roles_view, PageParams: \"v_role_id=#recipient.role_id#\"){\r\n                                        Div(){\r\n                                            Span(Class: icon-people fa-2x mr-sm).(#recipient.role_name#)\r\n                                        }.Style(display:flex; align-items:center;)\r\n                                    }  \r\n                                }.ElseIf(#recipient.member_id# != 0){\r\n                                    LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#recipient.member_id#\"){\r\n                                        If(#recipient.image_id#>0){\r\n                                            Image(Src: Binary().ById(#recipient.image_id#), Class: img-circle).Style(height: 30px;width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\r\n                                            Span(#recipient.member_name#)\r\n                                        }.Else{\r\n                                            Div(){\r\n                                                Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n                                                Span(#recipient.member_name#)\r\n                                            }.Style(display:flex; align-items:center;)\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }.Custom(_name){\r\n                                LinkPage(#page_params.name#,Class: text-primary h5 text-bold,Page: @1errand_view,PageParams: \"errand_id=#id#,type=#type#\")\r\n                            }.Custom(custom_arrow){\r\n                                Em(Class: fa fa-long-arrow-right fa-1x)\r\n                            }.Custom(_sender){\r\n                                LinkPage(Class: text-primary h5 text-bold, Page: @1roles_view, PageParams: \"v_role_id=#sender.role_id#\"){\r\n                                    If(#sender.image_id#>0){\r\n                                        Image(Src: Binary().ById(#sender.image_id#), Class: mr-sm).Style(width: 30px; border: 1px solid #5A5D63;)\r\n                                        #sender.role_name#\r\n                                    }.Else{\r\n                                        Div(){\r\n                                            Span(Class: icon-people fa-2x mr-sm).(#sender.role_name#)\r\n                                        }.Style(display:flex; align-items:center;)\r\n                                    }\r\n                                }\r\n                            }.Custom(_date_start){\r\n                                Div(Class:h5){DateTime(DateTime: #date_created#, Format: \"YYYY.MM.DD HH:MI:SS\")}\r\n                            }.Custom(_date_end){\r\n                                Div(Class:h5){Span(#page_params.date_end#)}\r\n                            }.Count(count_records).Order({id:\"-1\"})\r\n                            Form(){     \r\n                                Div(col-md-12){\r\n                                    Div(input-group){\r\n                                        Div(input-group-addon){\r\n                                            LangRes($@1name$)\r\n                                        }\r\n                                        Input(Name: Search, Value: #Search#)\r\n                                        Div(input-group-btn){\r\n                                            Button(Body: Em(Class: fa fa-search), Class: btn btn-default, Page: @1errand_list, PageParams: \"Search=Val(Search),type=#type#\")\r\n                                        }\r\n                                    }\r\n                                }  \r\n                                Div(){\r\n                                    Table(Source: src_errands,Columns: \"$@1name$=_name,$@1sender$=_sender,=custom_arrow,$@1recipient$=_role,$@1date_start$=_date_start,$@1date_end$=_date_end,$@1status$=_status\")\r\n                                }.Style(\r\n                                    tr > *:first-child {\r\n                                        padding-left:20px;\r\n                                    }\r\n                                ) \r\n                            } \r\n                            If(GetVar(Search)!=\"\"){\r\n                                Div(Class: text-center){\r\n                                    Div(row){\r\n                                        If(#count_records# == 0){\r\n                                            Div(col-md-12){\r\n                                                Span(Body:$@1records_not_found$,Class: h4)\r\n                                            }.Style(padding-bottom:15px)\r\n                                        }\r\n                                        Button($@1view_all$,Class: btn btn-primary,Page: @1errand_list,PageParams: \"type=#type#\")\r\n                                    }\r\n                                }.Style(padding-top:15px;)\r\n                            } \r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Include(@1pager)\r\n        }\r\n    }\r\n}",
            "Name": "errand_list",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Div(content-wrapper){\r\n    If(#notific_id#>0){\r\n        DBFind(@1notifications).WhereId(#notific_id#).Columns(\"id,page_params->decision_errand_id,page_params->type,processing_info,closed\").Vars(check_decisions)\r\n        If(And(#check_decisions_page_params_type# == task_decision,#check_decisions_page_params_decision_errand_id# != \"\")){\r\n            SetVar(errand_id,#check_decisions_page_params_decision_errand_id#)\r\n        }.Else{\r\n            SetVar(errand_id,#notific_id#)\r\n        }\r\n    }.ElseIf(#errand_id#>0){\r\n        SetVar(errand_id,#errand_id#)\r\n    }\r\n\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#errand_id#}).Columns(\"id,page_params->name,sender->role_id,sender->role_name,sender->image_id,recipient->role_id,recipient->role_name,recipient->image_id,recipient->member_id,recipient->member_name,page_params->status,page_params->date_end,date_created,page_params->text,page_params->answer,processing_info,processing_info->member_id,processing_info->member_name,processing_info->image_id,closed\").Vars(prefix)\r\n    \r\n    Div(row){\r\n        Div(col-md-6 col-md-offset-3){\r\n            Form(panel panel-default){\r\n                Div(panel-body){\r\n                    Div(list-group-item text-center){\r\n                        Span(Class: h3, Body: #prefix_page_params_name#)\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-5 mt-sm text-right){\r\n                                Button(Class: btn-link text-primary h5 text-bold, Page: @1roles_view, PageParams: \"v_role_id=#prefix_sender_role_id#\"){\r\n                                    If(#prefix_sender_image_id#>0){\r\n                                        Image(Src: Binary().ById(#sender.image_id#), Class: mr-sm).Style(width: 30px; border: 1px solid #5A5D63;)\r\n                                        #prefix_sender_role_name#\r\n                                    }.Else{\r\n                                        Div(){\r\n                                            Span(Class: icon-people fa-2x mr-sm).(#prefix_sender_role_name#)\r\n                                        }.Style(display:flex; align-items:center;)\r\n                                    }\r\n                                }\r\n                            }\r\n                            Div(col-md-2 mt-sm text-center){\r\n                                Em(Class: fa fa-long-arrow-right fa-2x)\r\n                            }.Style(padding-top:12px;)\r\n                            Div(col-md-5 mt-sm text-left){\r\n                                If(#prefix_recipient_role_id# > 0){\r\n                                    Button(Class: btn-link text-primary h5 text-bold, Page: @1roles_view, PageParams: \"v_role_id=#prefix_recipient_role_id#\"){\r\n                                        If(#prefix_recipient_image_id#>0){\r\n                                            Image(Src: Binary().ById(#sender.image_id#), Class: mr-sm).Style(width: 30px; border: 1px solid #5A5D63;)\r\n                                            #prefix_recipient_role_name#\r\n                                        }.Else{\r\n                                            Div(){\r\n                                                Span(Class: icon-people fa-2x mr-sm).(#prefix_recipient_role_name#)\r\n                                            }.Style(display:flex; align-items:center;)\r\n                                        }\r\n                                    }\r\n                                }.ElseIf(#prefix_recipient_member_id# != 0){\r\n                                    Button(Class: btn-link text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#prefix_recipient_member_id#\"){\r\n                                        If(#prefix_recipient_image_id#>0){\r\n                                            Image(Src: Binary().ById(#prefix_recipient_image_id#), Class: img-circle).Style(height: 30px;width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\r\n                                            Span(#prefix_recipient_member_name#)\r\n                                        }.Else{\r\n                                            Div(){\r\n                                                Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n                                                Span(#prefix_recipient_member_name#)\r\n                                            }.Style(display:flex; align-items:center;)\r\n                                        }\r\n                                    }\r\n                                }   \r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-6 mt-sm text-right){\r\n                                Span(Class: h4, Body: $@1status$)\r\n                            }\r\n                            Div(col-md-6 mt-sm text-left){\r\n                                If(#prefix_page_params_status# == 0){\r\n                                    Span(Body:Em(Class:fa fa-hourglass-half) $@1in_progress$ ,Class: text-info h4)\r\n                                }.ElseIf(#prefix_page_params_status# == -1){\r\n                                    Span(Body:Em(Class:fa fa-times) $@1expired$,Class: text-danger h4)\r\n                                }.ElseIf(#prefix_page_params_status# == 1){\r\n                                    Span(Body:Em(Class:fa fa-hourglass-end) $@1done$,Class: text-success h4)\r\n                                }\r\n                            }\r\n                        }\r\n                        If(#prefix_processing_info# != \"\"){\r\n                            Div(row){\r\n                                Div(col-md-6 mt-sm text-right){\r\n                                    Span(Class: h4, Body: $@1performer_from_role$)\r\n                                }\r\n                                Div(col-md-6  text-left){\r\n                                    LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#prefix_processing_info_member_id#\"){\r\n                                        If(#prefix_processing_info_image_id#>0){\r\n                                            Image(Src: Binary().ById(#prefix_processing_info_image_id#), Class: img-circle).Style(height: 30px;width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\r\n                                            Span(#prefix_processing_info_member_name#)\r\n                                        }.Else{\r\n                                            Div(){\r\n                                                Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n                                                Span(#prefix_processing_info_member_name#)\r\n                                            }.Style(display:flex; align-items:center;)\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }.Style(padding-top:10px;padding-bottom:10px;)\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-6 mt-sm text-right){\r\n                                Span(Class: h4, Body: $@1date_start$)\r\n                            }\r\n                            Div(col-md-6 mt-sm text-left){\r\n                                Span(Class: h4){DateTime(DateTime: #prefix_date_created#, Format: \"YYYY.MM.DD HH:MI:SS\")}\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-6 mt-sm text-right){\r\n                                Span(Class: h4, Body: $@1date_end$)\r\n                            }\r\n                            Div(col-md-6 mt-sm text-left){\r\n                                Span(#prefix_page_params_date_end#,Class: h4)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-2 mt-sm text-left){\r\n                                Span(Class: h4, Body: $@1errand_text$)\r\n                            }\r\n                            Div(col-md-10 mt-sm text-left){\r\n                                Span(Class: h4, Body: #prefix_page_params_text#)\r\n                            }\r\n                        }\r\n                        If(Or(#prefix_recipient_member_id# == #key_id#,#prefix_processing_info_member_id# == #key_id#)){\r\n                            Div(row){\r\n                                Div(col-md-2 mt-sm text-left){\r\n                                    Span(Class: h4, Body: $@1answer$)\r\n                                }\r\n                                If(#prefix_page_params_status# == 0){\r\n                                    Div(col-md-10 mt-sm text-left){\r\n                                        Input(Name: answer_recipient,Type: textarea)\r\n                                    }\r\n                                }.Else{\r\n                                    Div(col-md-10 mt-sm text-left){\r\n                                        Span(Class: h4, Body: #prefix_page_params_answer#)\r\n                                    }\r\n                                }\r\n                            }.Style(padding-top:15px;)\r\n                        }.Else{\r\n                            If(#prefix_page_params_answer# != \"\"){\r\n                                Div(row){\r\n                                    Div(col-md-2 mt-sm text-left){\r\n                                        Span(Class: h4, Body: $@1answer$)\r\n                                    }\r\n                                    Div(col-md-10 mt-sm text-left){\r\n                                        Span(Class: h4, Body: #prefix_page_params_answer#)\r\n                                    }\r\n                                }.Style(padding-top:15px;)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer){\r\n                    Div(Class: clearfix){\r\n                        If(Or(#prefix_recipient_role_id# == #role_id#,#prefix_recipient_member_id# == #key_id#)){\r\n                            If(#prefix_page_params_status# == 0){\r\n                                If(Or(#prefix_recipient_member_id# == #key_id#,#prefix_processing_info_member_id# == #key_id#)){\r\n                                    Button($@1denial$,Class: pull-left btn btn-danger ml-sm,Page: @1errand_list,PageParams: \"type=#type#\",Contract: @1ErrandDecision,Params: \"errand_id=#errand_id#,errand_decision=1\")\r\n                                    Button($@1done$,Class: pull-right btn btn-success ml-sm,Page: @1errand_list,PageParams: \"type=#type#\",Contract: @1ErrandDecision,Params: \"errand_id=#errand_id#,errand_decision=0\")\r\n                                }.ElseIf(And(#prefix_recipient_role_id# > 0,#prefix_processing_info# ==\"\")){\r\n                                    If(#notific_id# > 0){\r\n                                        Button($@1back$,Class: pull-left btn bg-gray ml-sm,Page: @1notifications_list)\r\n                                    }.Else{\r\n                                        Button($@1back$,Class: pull-left btn bg-gray ml-sm,Page: @1errand_list,PageParams: \"type=#type#\")\r\n                                    }\r\n                                    Button($@1start_process$,Class: pull-right btn btn-info ml-sm,Page: @1errand_view,PageParams: \"notific_id=#errand_id#\",Contract: @1NotificationsProcess, Params: \"notific_id=#errand_id#\")\r\n                                }\r\n                            }.ElseIf(#errand_id# > 0){\r\n                                If(#notific_id# > 0){\r\n                                    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Vars(cl)\r\n                                }\r\n                                If(#cl_closed# == 0){\r\n                                    If(#cl_processing_info# ==\"\"){\r\n                                        Button($@1start_process$,Class: btn btn-info ml-sm,Page: @1errand_view,PageParams: \"notific_id=#notific_id#\",Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\r\n                                    }.Else{\r\n                                        Button($@1close$,Class: pull-left btn bg-gray ml-sm,Page: @1notifications_list,Contract: @1NotificationsClose,Params: \"notific_id=#notific_id#\")\r\n                                    }\r\n                                }.Else{\r\n                                    Button($@1back$,Class: pull-left btn bg-gray ml-sm,Page: @1errand_list,PageParams: \"type=#type#\")\r\n                                }\r\n                            }\r\n                        }.Else{\r\n                            If(#check_decisions_closed# == 0){\r\n                                If(#check_decisions_processing_info# ==\"\"){\r\n                                    Button($@1start_process$,Class: btn btn-info ml-sm,Page: @1errand_view,PageParams: \"notific_id=#notific_id#\",Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\r\n                                }.Else{\r\n                                    Button($@1close$,Class: pull-left btn bg-gray ml-sm,Page: @1notifications_list,Contract: @1NotificationsClose,Params: \"notific_id=#notific_id#\")\r\n                                }\r\n                            }.Else{\r\n                                If(#notific_id# > 0){\r\n                                    Button($@1back$,Class: pull-left btn bg-gray ml-sm,Page: @1notifications_list,PageParams: \"type=#type#\") \r\n                                }.Else{\r\n                                    Button($@1back$,Class: pull-left btn bg-gray ml-sm,Page: @1errand_list,PageParams: \"type=#type#\") \r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Name": "errand_view",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract ErrandAccess {\r\n    data {\r\n        var_id int\r\n        type_del int \"optional\"\r\n        id_del_role int \"optional\"\r\n    }\r\n    conditions {\r\n        var admin_id int\r\n        admin_id = EcosysParam(\"role_admin\")\r\n        if !RoleAccess(Int(admin_id)) {\r\n            warning LangRes(\"@1access_denied\", \"en\")\r\n        }\r\n        if $type_del == 1 {\r\n\r\n        } else{\r\n            $check_role = DBFind(\"@1roles\").Where({\"id\":$var_id,\"deleted\":0,\"ecosystem\":$ecosystem_id})\r\n            if(!$check_role){\r\n                error LangRes(\"@1role_not_found\", \"en\")\r\n            }\r\n\r\n            $check_added_roles = DBFind(\"@1errand_access\").Where({\"role_id\":$var_id,\"ecosystem_id\":$ecosystem_id,\"deleted\":0})\r\n            if($check_added_roles){\r\n                error LangRes(\"@1role_added_before\", \"en\")\r\n            }\r\n        }\r\n        \r\n    }\r\n    action {\r\n        if $type_del == 1 {\r\n            DBUpdate(\"@1errand_access\",$id_del_role,{\"deleted\":1})\r\n        } else{\r\n            DBInsert(\"@1errand_access\",{\"role_id\":$var_id,\"ecosystem_id\":$ecosystem_id,\"deleted\":0})\r\n        }\r\n    }\r\n}",
            "Name": "ErrandAccess",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract ErrandCreate {\r\n    data {\r\n        errand_type int\r\n        rec_role_id int \"optional\"\r\n        send_role_id int\r\n        member_id string \"optional\"\r\n        errand_name string\r\n        errand_text string\r\n        \r\n        \r\n        end_date string\r\n        end_time string \"optional\"\r\n\r\n    }\r\n    func isCalledFromPage() bool {\r\n        return $stack[0] == Sprintf(\"@%v%v\", $ecosystem_id, $this_contract)\r\n    }\r\n    func trimZeroTime(s string) string {\r\n        if Contains(s, \"T00:00:00Z\") {\r\n            s = s Replace(s, \"T00:00:00Z\", \"\")\r\n        }\r\n        return s\r\n    }\r\n    func dateAddTime(d, t string) string {\r\n        var dt string\r\n        if Size(t) == 5 {\r\n            dt = Sprintf(\"%v %v:00\", trimZeroTime(d), t)\r\n        }\r\n        return dt\r\n    }\r\n    func fixDatetimes() {\r\n        $date_ended = dateAddTime($end_date, $end_time)\r\n\r\n        if UnixDateTime($date_ended) == 0 { // invalid datetimes\r\n            if isCalledFromPage(){\r\n                var errs array\r\n                if Size($end_date) < 10 {\r\n                    error LangRes(\"@1ending_date_invalid\", \"en\")\r\n                }\r\n                if Size($end_time) < 5 {\r\n                    error LangRes(\"@1invalid_time_end\", \"en\")\r\n                }\r\n            }\r\n        }\r\n        if UnixDateTime($date_ended) < $block_time{\r\n            error LangRes(\"@1starting_date_invalid\", \"en\")\r\n        }\r\n    }\r\n    conditions {\r\n        $check_access = DBFind(\"@1errand_access\").Where({ecosystem_id:$ecosystem_id,role_id:$send_role_id,deleted:0})\r\n        if !$check_access {\r\n            warning LangRes(\"@1access_denied\", \"en\")\r\n        }\r\n        if $end_date == \"\" {\r\n            info LangRes(\"@1ending_date_invalid\", \"en\")\r\n        }\r\n        if $end_time == \"\" {\r\n            info LangRes(\"@1invalid_time_end\", \"en\")\r\n        }\r\n        if $errand_name == \"\" {\r\n            info LangRes(\"@1empty_name\", \"en\")\r\n        }\r\n        if $errand_text == \"\" {\r\n            info LangRes(\"@1empty_text\", \"en\")\r\n        }\r\n        if $errand_type == 0 {\r\n            $valid_role = DBFind(\"roles\").Where({ecosystem:$ecosystem_id,id:$rec_role_id,deleted:0}).One(\"id\")\r\n            if $valid_role == 0 {\r\n                info LangRes(\"@1role_not_found\", \"en\")\r\n            }\r\n        }\r\n        if $errand_type == 1 {\r\n            if $member_id == \"\" {\r\n                info LangRes(\"@1empty_wallet\", \"en\")\r\n            }\r\n            $member_id = AddressToId($member_id)\r\n            $check_member = DBFind(\"@1members\").Where({id:$member_id,ecosystem:$ecosystem_id}).One(\"id\")\r\n            if (Int($check_member) == 0){\r\n                error LangRes(\"@1member_not_fount\", \"en\")\r\n            }\r\n        }\r\n        fixDatetimes()\r\n    }\r\n    action {\r\n        var info_errand map\r\n\r\n        info_errand[\"name\"] = $errand_name\r\n        info_errand[\"text\"] = $errand_text\r\n        info_errand[\"date_end\"] = $date_ended\r\n        info_errand[\"status\"] = 0\r\n        info_errand[\"type\"] = \"task\"\r\n        if $errand_type == 0 {\r\n            info_errand[\"recipient_type\"] = 0\r\n        }\r\n        if $errand_type == 1 {\r\n            info_errand[\"recipient_type\"] = 1\r\n        }\r\n        \r\n        \r\n        if $errand_type == 0 {\r\n            @1NotificationsSend(\"current_role_id,rid,sender,icon_name,text_header,text_body,page_name,params_map,closure_type,eco_id\",$send_role_id,$rec_role_id, 2, \"icon icon-envelope-open\", \"New Errand\", LangRes(\"@1details_view\", \"en\"), \"@1errand_view\",info_errand,1,$ecosystem_id)\r\n        }\r\n        if $errand_type == 1 {\r\n            @1NotificationsSend(\"current_role_id,member_id,sender,icon_name,text_header,text_body,page_name,params_map,rid,closure_type,eco_id\",$send_role_id,Int($member_id), 2, \"icon icon-envelope-open\", \"New Errand\", LangRes(\"@1details_view\", \"en\"), \"@1errand_view\", info_errand, 0, 0,$ecosystem_id)\r\n        }\r\n    }\r\n}",
            "Name": "ErrandCreate",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract ErrandDecision {\r\n    data {\r\n        errand_decision int\r\n        errand_id int\r\n        answer_recipient string\r\n    }\r\n    conditions {\r\n        if ($answer_recipient == \"\") {\r\n            info LangRes(\"@1empty_answer\", \"en\")\r\n        }\r\n        $errand_map = DBFind(\"@1notifications\").Where({\"id\":$errand_id}).Columns(\"id,processing_info,processing_info->member_id,page_params,page_params->name,page_params->text,page_params->type,page_params->date_end,closed,recipient->role_id,recipient->member_id,page_params->recipient_type,sender->role_id\").Row()\r\n        if (Int($errand_map[\"page_params.recipient_type\"]) == 0) { //role errand\r\n            if !RoleAccess(Int($errand_map[\"recipient.role_id\"])) {\r\n                warning LangRes(\"@1access_denied\", \"en\")\r\n            }\r\n            if ($errand_map[\"processing_info\"] == \"\") {\r\n                info LangRes(\"@1start_process_errand\", \"en\")\r\n            }\r\n            if (Int($errand_map[\"processing_info.member_id\"]) != $key_id) {\r\n                info LangRes(\"@1another_start_process_errand\", \"en\")\r\n            }\r\n        } else { //member errand\r\n            if (Int($errand_map[\"recipient.member_id\"]) != $key_id){\r\n                warning LangRes(\"@1access_denied\", \"en\")\r\n            }\r\n        }\r\n        if ($errand_map[\"closed\"] != 0){\r\n            info LangRes(\"@1already_start_process_errand\", \"en\")\r\n        }\r\n    }\r\n    action {\r\n        var answer_map map\r\n        answer_map[\"name\"] = $errand_map[\"page_params.name\"]\r\n        answer_map[\"text\"] = $errand_map[\"page_params.text\"]\r\n        answer_map[\"type\"] = $errand_map[\"page_params.type\"]\r\n        answer_map[\"date_end\"] = $errand_map[\"page_params.date_end\"]\r\n        answer_map[\"answer\"] = $answer_recipient\r\n        \r\n        if $errand_decision == 0 {\r\n            answer_map[\"status\"] = 1\r\n            DBUpdate(\"@1notifications\",$errand_id,{\"page_params\":answer_map})\r\n        }\r\n\r\n        if $errand_decision == 1 {\r\n            answer_map[\"status\"] = -1\r\n            DBUpdate(\"@1notifications\",$errand_id,{\"page_params\":answer_map})\r\n        }\r\n        if (Int($errand_map[\"page_params.recipient_type\"]) == 0) {\r\n            var info_errand map\r\n            info_errand[\"decision_errand_id\"] = $errand_id\r\n            info_errand[\"type\"] = \"task_decision\"\r\n            @1NotificationsSend(\"current_role_id,rid,sender,icon_name,text_header,text_body,page_name,params_map,closure_type,eco_id\",Int($errand_map[\"recipient.role_id\"]),Int($errand_map[\"sender.role_id\"]), 2, \"icon icon-envelope-open\", \"Decision by errand\", LangRes(\"@1details_view\", \"en\"), \"@1errand_view\",info_errand,1,$ecosystem_id)\r\n        }\r\n        else{\r\n            var info_errand map\r\n            info_errand[\"decision_errand_id\"] = $errand_id\r\n            info_errand[\"type\"] = \"task_decision\"\r\n            @1NotificationsSend(\"rid,sender,icon_name,text_header,text_body,page_name,params_map,closure_type,eco_id\",Int($errand_map[\"sender.role_id\"]), 1, \"icon icon-envelope-open\", \"Decision by errand\", LangRes(\"@1details_view\", \"en\"), \"@1errand_view\",info_errand,1,$ecosystem_id)\r\n        }\r\n        @1NotificationsClose(\"notific_id\", $errand_id)\r\n    }\r\n}",
            "Name": "ErrandDecision",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract ErrandStatusUpdate {\r\n    data {\r\n        \r\n    }\r\n    conditions {\r\n        var admin_id int\r\n        admin_id = EcosysParam(\"role_admin\")\r\n       \r\n        if !RoleAccess(Int(admin_id)) {\r\n            warning LangRes(\"@1access_denied\", \"en\")\r\n        }\r\n    }\r\n    action {\r\n        var bt string\r\n        bt = BlockTime()\r\n\r\n        var errands array i lenErrands status int v map\r\n        errands = DBFind(\"@1notifications\").Columns(\"id,page_params->date_end,page_params->type,page_params->status\").Where({\"page_params->type\":\"task\",\"page_params->date_end\":{\"$lte\":bt},\"page_params->status\":0})\r\n        lenErrands = Len(errands)\r\n        \r\n        while i < lenErrands{\r\n            v = errands[i]\r\n            status = -1\r\n            DBUpdate(\"@1notifications\", Int(v[\"id\"]), {\"page_params->status\":status})\r\n            i = i + 1\r\n        }\r\n    }\r\n}",
            "Name": "ErrandStatusUpdate",
            "Type": "contracts"
        }
    ]
}