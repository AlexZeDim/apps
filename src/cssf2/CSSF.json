{
    "name": "CSSF",
    "data": [
        {
            "Type": "blocks",
            "Name": "profile_view",
            "Value": "Div(content-wrapper){\r\n    SetTitle($user_info$)\r\n\r\n    If(Or(#v_member_id#>0,#v_member_id#<0)){\r\n    }.Else{\r\n        SetVar(Name: v_member_id, Value: #key_id#)\r\n    }\r\n    DBFind(Name: members, Source: src_member).Where(\"id=#v_member_id#\").Vars(prefix)\r\n    DBFind(Name: keys, Source: src_keys).Where(\"id=#key_id#\").Vars(tokens)\r\n\r\n    Form(row){\r\n        Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\r\n            Div(panel panel-default){\r\n                Div(panel-heading text-center){\r\n                    Span(Class: h3, Body: LangRes(user_info))\r\n                }\r\n                Div(panel-body){\r\n                    Div(form-group){\r\n                        Div(row){\r\n                            Div(col-md-12 mt-sm text-center){\r\n                                If(Or(#prefix_id#>0,#prefix_id#<0)){\r\n                                    If(#prefix_id# == #key_id#){\r\n                                        Button(Class: btn btn-link, Page: profile_edit, PageParams: \"v_member_id=#key_id#\"){\r\n                                            Span(Class: fa icon-user fa-5x)\r\n                                            Div(m0 h3 text-bold){#prefix_member_name#}\r\n                                        }\r\n                                    }.Else{\r\n                                        Div(){\r\n                                            Span(Class: fa icon-user fa-5x)\r\n                                            Div(m0 h3 text-bold){#prefix_member_name#}\r\n                                        }\r\n                                    }\r\n                                }.Else{\r\n                                    Span(Class: h3 text-bold, Body: \"No profile available\")\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    If(Or(#prefix_id#>0,#prefix_id#<0)){\r\n                        Div(list-group-item text-center){\r\n                            Div(text-muted m0 h5, Body: LangRes(address))\r\n                            Span(Class: h5, Body: Address(#prefix_id#))\r\n                        }\r\n                    }\r\n                    Div(list-group-item text-center){\r\n                        Div(text-muted m0 h5, Body: LangRes(roles))\r\n                        DBFind(Name: roles_participants, Source: src_check).Columns(\"id\").Where(\"member->member_id='#v_member_id#' and deleted=0\").Vars(check)\r\n                        If(#check_id#>0){\r\n                            DBFind(Name: roles_participants, Source: src_roles).Columns(\"role->id,role->name\").Where(\"member->member_id='#v_member_id#' and deleted=0\").Order(\"id\")\r\n                            ForList(src_roles){\r\n                                Span(){\r\n                                    LinkPage(Page: roles_view, PageParams: \"v_role_id=#role.id#\"){\r\n                                        Span(Class: h5 text-bold, Body: \"#role.name#\")\r\n                                    }\r\n                                }.Style(margin-right: 5px; margin-left: 5px;)\r\n                            }\r\n                        }.Else{\r\n                            Span(LangRes(no))\r\n                        }\r\n                    }\r\n                    If(Or(#prefix_id#>0,#prefix_id#<0)){\r\n                        If(#prefix_id# == #key_id#){\r\n                            Div(list-group-item text-center){\r\n                                Div(text-muted m0 h5, Body: Tokens)\r\n                                Span(Class:text-bold h4, Body: #tokens_amount# APL)\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    DBFind(Name: keys).Where(\"id=#v_member_id#\").Vars(check_b)\r\n                    If(And(#check_b_blocked#==1,#check_b_deleted#==0)){\r\n                        Div(list-group-item text-center){\r\n                            Div(text-warning text-bold m0 h3, Body: Member blocked)\r\n                        }\r\n                    }\r\n                    If(#check_b_deleted#==1){\r\n                        Div(list-group-item text-center){\r\n                            Div(text-danger text-bold m0 h3, Body: Member removed)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            If(Or(#prefix_id#>0,#prefix_id#<0)){\r\n                If(#prefix_id# == #key_id#){\r\n                    If(And(#tokens_blocked#==0,#tokens_deleted#==0)){\r\n                        Div(panel panel-default){\r\n                            Div(panel-heading text-center){\r\n                                Span(Class: h3, Body: Sending tokens)\r\n                            }\r\n                            Div(panel-body){\r\n                                Div(list-group-item){\r\n                                    Div(row){\r\n                                        Div(col-md-3 mt-sm text-right){\r\n                                            Label(){\r\n                                                Span(Body: Recipient)\r\n                                                Span(Class: text-danger, Body:*)\r\n                                            }\r\n                                        }\r\n                                        Div(col-md-9 mc-sm text-left){\r\n                                            DBFind(Name: members, Source: source_members).Columns(\"id,member_name\").Where(\"fin_inst>0 and id != #key_id#\").Custom(custom_username){\r\n                                                Address(#id#)\r\n                                            }\r\n                                            Select(Name: Recipient, Source: source_members, NameColumn: custom_username, ValueColumn: id)\r\n                                        }\r\n                                    }\r\n                                }\r\n                                Div(list-group-item){\r\n                                    Div(row){\r\n                                        Div(col-md-3 mt-sm text-right){\r\n                                            Label(){\r\n                                                Span(Body: Amount (APL))\r\n                                                Span(Class: text-danger, Body:*)\r\n                                            }\r\n                                        }\r\n                                        Div(col-md-9 mc-sm text-left){\r\n                                            Input(Name: Amount, Type: Money)\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            Div(panel-footer text-right){\r\n                                Button(Body: Send, Class: btn btn-primary, Contract: TokensTransfer, Page: transactions)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "blocks",
            "Name": "accounts",
            "Value": "Div(content-wrapper){\r\n    SetTitle($accounts$)\r\n\r\n    If(#role_id#==0){\r\n       SetVar(v_Where, \"id=#key_id#\")\r\n    }\r\n    If(#role_id#==1){\r\n       SetVar(v_Where, \"id=#key_id#\")\r\n    }\r\n    If(#role_id#>1){\r\n       SetVar(v_Where, \"fin_inst=#role_id# or id=#key_id#\")\r\n    }\r\n\r\n    DBFind(Name: keys, Source: src_keys).Columns(\"id,multi,amount,deleted,blocked\").Custom(custom_id){\r\n        Span(Class: h5 text-muted, Body: #id#)\r\n    }.Custom(custom_member_id){\r\n        Span(Class: text-muted, Body: Address(#id#))\r\n    }.Custom(custom_username){\r\n        SetVar(Name: row_member_name, Value: \"\")\r\n        DBFind(Name: members, Source: src_member).Columns(\"id,member_name\").Where(\"id=#id#\").Vars(row)\r\n        LinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#id#\"){\r\n            Div(){\r\n                Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n                Span(#row_member_name#)\r\n            }.Style(display:flex; align-items:center;)\r\n        }\r\n    }.Custom(custom_fin){\r\n        Span(Class: h4 text-bold, Body: #amount# APL)\r\n    }.Custom(custom_status){\r\n\t\tIf(#deleted#==1){\r\n\t\t\tSpan(Class: text-danger h4, Body: Deleted)\r\n\t\t}\r\n\t\tIf(And(#deleted#==0,#blocked#==1)){\r\n\t\t\tSpan(Class: text-warning h4, Body: Blocked)\r\n\t\t}\r\n\t\tIf(And(#deleted#==0,#blocked#==0)){\r\n\t\t\tSpan(Class: text-success h4, Body: Active)\r\n\t\t}\r\n    }.Where(#v_Where#).Order(\"id\")\r\n\r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Table(Source: src_keys, Columns: \"$username$=custom_username,$address$=custom_member_id,$amount$=custom_fin,Status=custom_status\")\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "blocks",
            "Name": "roles_list",
            "Value": "Div(content-wrapper){\r\n    DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(app)\r\n    SetTitle($roles$)\r\n\r\n    If(GetVar(isSearch) == 1){\r\n        SetVar(Name: v_Where, Value: \"role_name='#v_Search#' and deleted=0\")\r\n    }.Else{\r\n        SetVar(Name: v_Where, Value: \"id>0 and deleted=0\")\r\n        SetVar(Name: v_Search, Value: \"\")\r\n    }\r\n    \r\n    DBFind(Name: roles, Source: src_roles).Columns(\"id,role_name,financial_institutions->max_amount,financial_institutions->daily_limit,date_created,date_deleted,deleted\").Custom(custom_id){\r\n        Span(Body: #id#)\r\n    }.Custom(custom_date){\r\n        Div(text-muted h5 m0, Body: DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\"))\r\n    }.Custom(custom_name){\r\n        LinkPage(Class: text-primary h5 text-bold, Page: roles_view, PageParams: \"v_role_id=#id#\"){\r\n            Div(){\r\n                Span(Em(Class: fa icon-settings fa-2x)).Style(margin-right:10px;)\r\n                Span(#role_name#)\r\n            }.Style(display:flex; align-items:center;)\r\n        }\r\n    }.Custom(custom_amount){\r\n        SetVar(check_id, 0)\r\n\t\tIf(#financial_institutions.max_amount# > 0){\r\n\t\t\tDBFind(Name: roles_participants).Columns(\"id\").Where(\"role->id='#id#' and member->member_id='#key_id#' and deleted=0\").Vars(check)\r\n\t\t\tIf(#check_id#>0){\r\n\t\t\t\tLinkPage(Class: text-primary h5 text-bold, Page: roles_options, PageParams: \"v_role_id=#id#\"){\r\n\t\t\t\t\tSpan(Class: h4, Body: #financial_institutions.max_amount# APL)\r\n\t\t\t\t}\r\n\t\t\t}.Else{\r\n\t\t\t\tSpan(Class: h4, Body: #financial_institutions.max_amount# APL)\r\n\t\t\t}\r\n\t\t}\r\n\t}.Custom(custom_limit){\r\n        SetVar(check_id, 0)\r\n\t\tIf(#financial_institutions.daily_limit# > 0){\r\n\t\t\tDBFind(Name: roles_participants).Columns(\"id\").Where(\"role->id='#id#' and member->member_id='#key_id#' and deleted=0\").Vars(check)\r\n\t\t\tIf(#check_id#>0){\r\n\t\t\t\tLinkPage(Class: text-primary h5 text-bold, Page: roles_options, PageParams: \"v_role_id=#id#\"){\r\n\t\t\t\t\tSpan(Class: h4, Body: #financial_institutions.daily_limit# APL)\r\n\t\t\t\t}\r\n\t\t\t}.Else{\r\n\t\t\t\tSpan(Class: h4, Body: #financial_institutions.daily_limit# APL)\r\n\t\t\t}\r\n\t\t}\r\n    }.Custom(custom_status){\r\n        Span(Class: h4, Body: Active)\r\n    }.Where(#v_Where#).Order(\"deleted ASC, id ASC\")\r\n    \r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Table(Source: src_roles, Columns: \"$id$=custom_id,$name$=custom_name,Date=custom_date,Max amount APL=custom_amount,Daily limit=custom_limit,$status$=custom_status\")\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Notifications_Single_Close",
            "Value": "contract Notifications_Single_Close {\n    data {\n        notific_id int\n    }\n\n    conditions {\n        $processing_map = DBFind(\"members\").Where(\"id = $\", $key_id).Row()\n        if !$processing_map {\n            warning \"Member not found\"\n        }\n    }\n\n    action {\n        var processing_info map\n        processing_info[\"member_id\"] = $processing_map[\"id\"]\n        processing_info[\"member_name\"] = $processing_map[\"member_name\"]\n        processing_info[\"image_id\"] = $processing_map[\"image_id\"]\n\n        DBUpdate(\"notifications\", $notific_id, \"timestamp date_start_processing,processing_info,timestamp date_closed,closed\",\n            $block_time, processing_info, $block_time, 1)\n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "Notifications_Single_Send",
            "Value": "contract Notifications_Single_Send {\r\n    data {\r\n        member_id int\r\n        sender int\r\n        icon_name string\r\n        text_header string\r\n        text_body string \"optional\"\r\n        page_name string\r\n        params_map map\r\n    }\r\n\r\n    conditions {\r\n        $member_map = DBFind(\"members\").Where(\"id = $\", $member_id).Row()\r\n        if !$member_map {\r\n            warning \"Member not found\"\r\n        }\r\n\r\n        if $sender == 1 {\r\n            $sender_map = DBFind(\"members\").Where(\"id = $\", $key_id).Row()\r\n            if !$sender_map {\r\n                warning \"Member not found\"\r\n            }\r\n        }\r\n        if $sender == 2 {\r\n            // !!! need to fix role_id to the global variable !!!!\r\n            $sender_map = DBFind(\"roles\").Where(\"id = $\", 1).Row()\r\n            if !$sender_map {\r\n                warning \"Member not found\"\r\n            }\r\n        }\r\n    }\r\n\r\n    action {\r\n        var recipient map\r\n        recipient[\"member_id\"] = $member_map[\"id\"]\r\n        recipient[\"member_name\"] = $member_map[\"member_name\"]\r\n        recipient[\"image_id\"] = $member_map[\"image_id\"]\r\n\r\n        var sender map\r\n        if $sender == 1 {\r\n            sender[\"type\"] = 1\r\n            sender[\"member_id\"] = $sender_map[\"id\"]\r\n            sender[\"member_name\"] = $sender_map[\"member_name\"]\r\n            sender[\"image_id\"] = $sender_map[\"image_id\"]\r\n        }\r\n        if $sender == 2 {\r\n            sender[\"type\"] = 2\r\n            sender[\"role_id\"] = $sender_map[\"id\"]\r\n            sender[\"role_name\"] = $sender_map[\"role_name\"]\r\n            sender[\"image_id\"] = $sender_map[\"image_id\"]\r\n        }\r\n\r\n        var notification map\r\n        notification[\"header\"] = $text_header\r\n        notification[\"type\"] = 1\r\n        notification[\"icon\"] = $icon_name\r\n        notification[\"body\"] = $text_body\r\n\r\n        DBInsert(\"notifications\", \"recipient,sender,notification,page_name,page_params,timestamp date_created\",\r\n            recipient, sender, notification, $page_name, $params_map, $block_time)\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "Profile_Edit",
            "Value": "contract Profile_Edit {\n    data {\n        member_name string\n        member_image string \"image\"\n        information string \"optional\"\n    }\n\n    conditions {\n        var app_name string\n        app_name = \"Basic application\" \n\n        $member_map = DBFind(\"members\").Where(\"id = $\", $key_id).Row()\n        $app_id = DBFind(\"applications\").Where(\"name = $ AND deleted = 0\", app_name).One(\"id\")\n\n        if !$member_map {\n            // check member_name \n            $member_id = DBFind(\"members\").Where(\"member_name = $\", $member_name).One(\"id\")\n            if $member_id {\n                warning \"This member name is busy. Enter another member name, please\"\n            }\n\n            // check avatar \n            if Size($member_image) == 0 {\n                warning \"Avatar was not received\"\n            }\n        }\n    }\n\n    action {\n        var memberInfo map\n        var image_id int\n        var image_name string\n        image_name = \"avatar\" \n\n        if $member_map {\n            image_id = Int($member_map[\"image_id\"]) \n            if Size($member_image) > 0 {\n                image_id = UploadBinary(\"Name,Data,AppID,MemberID\", image_name, $member_image, Int($app_id), $key_id)\n            }\n            DBUpdate(\"members\", Int($member_map[\"id\"]), \"member_info->information,image_id\", $information, image_id)\n        } else {\n            memberInfo[\"information\"] = $information\n            image_id = UploadBinary(\"Name,Data,AppID,MemberID\", image_name, $member_image, Int($app_id), $key_id)\n            DBInsert(\"members\", \"id,member_name,image_id,member_info\", $key_id, $member_name, image_id, memberInfo)\n        }\n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "TokensTransfer",
            "Value": "contract TokensTransfer {\r\n    data {\r\n        SenderId string \"optional\"\r\n        RecipientId string\r\n        Amount string\r\n    }\r\n    \r\n    conditions {\r\n        if !($SenderId == $key_id || (Size($SenderId) > 0 && ($original_contract == \"voting_AcceptDecision\" || $original_contract == \"tokenrefund_Accept\"))) {\r\n            error \"sender id error\"\r\n        }\r\n        var addressLen int\r\n        addressLen = 24\r\n        \r\n        $amount = Money($Amount)\r\n        if $SenderId == \"\"{\r\n            $SenderId = Sprintf(\"%v\", $key_id)\r\n        }\r\n        if $amount <= 0 {\r\n            error \"TokensTransfer. Amount less than or equal to zero\"\r\n        }\r\n        \r\n        if !HasPrefix($SenderId, \"-\") && Contains($SenderId, \"-\"){\r\n            // is address. convert to key id\r\n            $SenderId = Sprintf(\"%v\", AddressToId($SenderId))\r\n        }\r\n        if !HasPrefix($RecipientId, \"-\") && Contains($RecipientId, \"-\"){\r\n            // is address. convert to key id\r\n            $RecipientId = Sprintf(\"%v\", AddressToId($RecipientId))\r\n        }\r\n        \r\n        if Size($SenderId) > addressLen{\r\n            $SenderId = Sprintf(\"%v\", PubToID($SenderId))\r\n        }\r\n        if Size($RecipientId) > addressLen{\r\n            $RecipientId = Sprintf(\"%v\", PubToID($RecipientId))\r\n        }\r\n        \r\n        \r\n        var sender map\r\n        sender = DBFind(\"keys\").Where(\"id=?\", $SenderId).Row()\r\n        if !sender{\r\n            error \"TokensTransfer. Sender is invalid\"\r\n        }\r\n        if sender[\"blocked\"] == 1{\r\n            error \"Sender blocked\"\r\n        }\r\n        if sender[\"amount\"] < $amount{\r\n            error Sprintf(\"The number of tokens of the sender (%v) is not enough\", sender[\"amount\"])\r\n        }\r\n    }\r\n    \r\n    action {\r\n        DBUpdate(\"keys\", Int($SenderId),\"-amount\", $amount)\r\n        DBUpdate(\"keys\", Int($RecipientId),\"+amount\", $amount)\r\n        //DBInsert(\"history\", \"sender_id,recipient_id,amount,block_id,txhash\", $SenderId, $RecipientId, $amount, $block, $txhash)\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "Profile_Edit_Member",
            "Value": "contract Profile_Edit_Member {\r\n    data {\r\n        member_key int\r\n    }\r\n\r\n    conditions {\r\n        var app_name string\r\n        $member_map = DBFind(\"members\").Where(\"id = $\", $member_key).Row()\r\n\r\n        $role_fin_inst = 0\r\n        var fin_inst_map map\r\n        fin_inst_map = DBFind(\"roles_participants\").Columns(\"role->id\").Where(\"role->type='4' and member->member_id=$ and deleted=0\", $key_id).Row()\r\n        if fin_inst_map {\r\n            $role_fin_inst = Int(fin_inst_map[\"role.id\"])\r\n        }\r\n    }\r\n\r\n    action {\r\n        if !$member_map {\r\n            DBInsert(\"members\", \"id,member_name,fin_inst\", $member_key, IdToAddress($member_key), $role_fin_inst)\r\n            DBUpdate(\"keys\", $member_key, \"multi,amount,fin_inst\", 1,0, $role_fin_inst)\r\n        }\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Reject_Request",
            "Value": "contract Reject_Request {\r\n    data {\r\n        member_id int\r\n    }\r\n\r\n    conditions {\r\n    }\r\n\r\n    action {\r\n        DBUpdate(\"keys\", $member_id, \"multi\", -1)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Roles_Assign",
            "Value": "contract Roles_Assign {\r\n    data {\r\n        rid int\r\n        member_id int\r\n    }\r\n    \r\n    conditions {\r\n        $role_map = DBFind(\"roles\").Columns(\"id,deleted,role_type,role_name,image_id,creator->member_id\").Where(\"id = $\", $rid).Row()\r\n        if !$role_map {\r\n            warning \"Role not found\"\r\n        }\r\n        \r\n        $member_map = DBFind(\"members\").Where(\"id = $\", $member_id).Row()\r\n        if !$member_map {\r\n            warning \"Member not found\"\r\n        }\r\n        \r\n        $appointer_map = DBFind(\"members\").Where(\"id = $\", $key_id).Row()\r\n        if !$appointer_map {\r\n            warning \"Appointer not found\"\r\n        }\r\n        \r\n        if $role_map[\"deleted\"] == 1 {\r\n            warning \"This role has been deleted. The appointment of members is impossible\"\r\n        }\r\n        \r\n        var specialRules map\r\n        specialRules[\"sysparams_AcceptValidator\"] = \"Validator\"\r\n        specialRules[\"sysparams_DelegateRefresh\"] = \"Delegate\"\r\n        specialRules[\"sysparams_CandidateValidatorRequest\"] = \"Candidate for validators\"\r\n        specialRules[\"voting_TemplateRun\"] = \"Investor with voting rights\"\r\n        specialRules[\"tokenrefund_Start\"] = \"Investor with voting rights\"\r\n        \r\n        if !(specialRules[$original_contract] == $role_map[\"role_name\"]) {\r\n            if $role_map[\"role_type\"] != 1 && $role_map[\"role_type\"] != 4 {\r\n                warning \"This role is not assignable. The appointment of members is impossible\"\r\n            }\r\n            // check creator of the role\r\n            if $role_map[\"creator.member_id\"] != $key_id {\r\n                warning \"Sorry, you are not the creator of this role. The appointment of members is impossible\"\r\n            }\r\n        }\r\n        \r\n        $assign_id = DBFind(\"roles_participants\").Where(\"role->id=$ and member->member_id=$ and deleted=0\", $rid, $member_id).One(\"id\")\r\n        if $assign_id {\r\n            warning \"This member has already been added\"\r\n        }\r\n        \r\n    }\r\n    \r\n    action {\r\n        var role map\r\n        role[\"id\"] = $role_map[\"id\"]\r\n        role[\"type\"] = $role_map[\"role_type\"]\r\n        role[\"name\"] = $role_map[\"role_name\"]\r\n        role[\"image_id\"] = $role_map[\"image_id\"]\r\n        \r\n        var member map\r\n        member[\"member_id\"] = $member_map[\"id\"]\r\n        member[\"member_name\"] = $member_map[\"member_name\"]\r\n        member[\"image_id\"] = $member_map[\"image_id\"]\r\n        \r\n        var appointed map\r\n        appointed[\"member_id\"] = $appointer_map[\"id\"]\r\n        appointed[\"member_name\"] = $appointer_map[\"member_name\"]\r\n        appointed[\"image_id\"] = $appointer_map[\"image_id\"]\r\n        \r\n        DBInsert(\"roles_participants\", \"role,member,appointed,timestamp date_created\", role, member, appointed, $block_time)\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "Roles_Create",
            "Value": "contract Roles_Create {\r\n    data {\r\n        role_name string\r\n        role_type int\r\n        icon string \"optional\"\r\n        company_id int \"optional\"\r\n    }\r\n    \r\n    conditions {\r\n        // system role\r\n        if $role_type == 3 {\r\n            warning \"System role can not be created\"\r\n        }\r\n        \r\n        // company role\r\n        if $role_type == 4 {\r\n            // check param\r\n            if $company_id == 0 {\r\n                warning \"On this page you can not create a role for the company. Go to the company's view page to create a role\"\r\n            }\r\n            \r\n            // check creator of the company\r\n            if $company_id != $key_id {\r\n                warning \"Sorry, you are not the creator of this company\"\r\n            }\r\n        }\r\n        \r\n        $member_map = DBFind(\"members\").Where(\"id = $\", $key_id).Row()\r\n        if !$member_map {\r\n            warning \"You are not a member of the ecosystem\"\r\n        }\r\n    }\r\n    \r\n    action {\r\n        var creator map\r\n        creator[\"member_id\"] = $member_map[\"id\"]\r\n        creator[\"member_name\"] = $member_map[\"member_name\"]\r\n        creator[\"image_id\"] = $member_map[\"image_id\"]\r\n        \r\n        // insert role\r\n        if $role_type == 4 {\r\n            $rid = DBInsert(\"roles\", \"role_name,role_type,creator,timestamp date_created,company_id\", $role_name, $role_type, creator, $block_time, $company_id)\r\n        } else {\r\n            $rid = DBInsert(\"roles\", \"role_name,role_type,creator,timestamp date_created,company_id\", $role_name, $role_type, creator, $block_time, 0)\r\n        }\r\n\r\n        // insert image\r\n        var imageId int\r\n        if Size($icon) > 0 {\r\n            var app_name string\r\n            app_name = \"Basic application\"\r\n\r\n            var image_name string\r\n            image_name = \"role-\" + Str($rid) + \" \" + MD5($icon)\r\n\r\n            $app_id = DBFind(\"applications\").Where(\"name = $ AND deleted = 0\", app_name).One(\"id\")\r\n            imageId = UploadBinary(\"Name,Data,AppID,MemberID\", image_name, $icon, Int($app_id), $key_id)\r\n        }\r\n\r\n        // update image\r\n        DBUpdate(\"roles\", $rid,  \"image_id\", imageId)\r\n\r\n        // result\r\n        $result = $rid\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "Roles_DellAll",
            "Value": "contract Roles_DellAll {\r\n    data {}\r\n    conditions {\r\n        $new_role_name = \"Apla Consensus asbl\"\r\n    }\r\n\r\n    action {\r\n\r\n        DBUpdate(\"roles\", 1, \"default_page\", \"roles_list\")\r\n\r\n        //DBUpdate(\"validated_transactions\", 3, \"tr_date\", \"2018-05-01T00:41:38Z\")\r\n\r\n        /*\r\n        DBUpdate(\"validated_transactions\", 10, \"deleted\", 1)\r\n        DBUpdate(\"validated_transactions\", 11, \"deleted\", 1)\r\n        DBUpdate(\"validated_transactions\", 12, \"deleted\", 1)\r\n        DBUpdate(\"validated_transactions\", 7, \"deleted\", 1)\r\n        DBUpdate(\"validated_transactions\", 8, \"deleted\", 1)\r\n        DBUpdate(\"validated_transactions\", 9, \"deleted\", 1)\r\n        */\r\n        /*\r\n        DBUpdate(\"roles\", 1, \"role_name\", $new_role_name)\r\n\r\n        var roles array\r\n        roles = DBFind(\"roles\").Columns(\"id\").Where(\"id > $\", 1)\r\n        \r\n        var i int\r\n        while i < Len(roles) {\r\n            var p map\r\n            p = roles[i]\r\n            DBUpdate(\"roles\", Int(p[\"id\"]), \"deleted\", 1)\r\n            i = i + 1\r\n        }\r\n\r\n        var part array\r\n        part = DBFind(\"roles_participants\").Columns(\"id\").Where(\"role->id = $\", 1)\r\n        \r\n        var j int\r\n        while j < Len(part) {\r\n            var p map\r\n            p = part[j]\r\n            DBUpdate(\"roles_participants\", Int(p[\"id\"]), \"role->name\", $new_role_name)\r\n            j = j + 1\r\n        }\r\n\r\n\r\n        var part2 array\r\n        part2 = DBFind(\"roles_participants\").Columns(\"id\").Where(\"role->id > $\", 1)\r\n        \r\n        var j int\r\n        while j < Len(part2) {\r\n            var p map\r\n            p = part2[j]\r\n            DBUpdate(\"roles_participants\", Int(p[\"id\"]), \"deleted\", 1)\r\n            j = j + 1\r\n        }\r\n        */\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Profile_Edit_Institution",
            "Value": "contract Profile_Edit_Institution {\r\n    data {\r\n        role_name string\r\n        member_key int\r\n    }\r\n\r\n    conditions {\r\n        var app_name string\r\n        $member_map = DBFind(\"members\").Where(\"id = $\", $member_key).Row()\r\n    }\r\n\r\n    action {\r\n        if !$member_map {\r\n            DBInsert(\"members\", \"id,member_name\", $member_key, IdToAddress($member_key))\r\n            DBUpdate(\"keys\", $member_key, \"multi\", 1)\r\n            \r\n            $rid = Roles_Create(\"role_name,role_type\", $role_name, 4)\r\n            Roles_Assign(\"rid,member_id\", $rid, $member_key)\r\n        }\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Upload_Doc_Accept",
            "Value": "contract Upload_Doc_Accept {\r\n    data {\r\n        notific_id int\r\n        validated_id int\r\n    }\r\n\r\n    conditions {\r\n\t\t$validated_map = DBFind(\"validated_transactions\").Where(\"id = ?\", $validated_id).Row()\r\n\t\tif Int($validated_map[\"delegate\"]) != $key_id {\r\n\t\t\twarning \"You are not a delegate\"\r\n\t\t}\r\n    }\r\n\r\n    action {\r\n\t\tTokensTransfer(\"Recipient,Amount,Status\", IdToAddress(Int($validated_map[\"recipient\"])), Money($validated_map[\"amount\"]), 4)\r\n        DBUpdate(\"validated_transactions\", $validated_id, \"status\", 2)\r\n\t\tNotifications_Single_Close(\"notific_id\", $notific_id)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Upload_Doc_Reject",
            "Value": "contract Upload_Doc_Reject {\r\n    data {\r\n        notific_id int\r\n        validated_id int\r\n    }\r\n\r\n    conditions {\r\n\t\t$validated_map = DBFind(\"validated_transactions\").Where(\"id = ?\", $validated_id).Row()\r\n\t\tif Int($validated_map[\"delegate\"]) != $key_id {\r\n\t\t\twarning \"You are not a delegate\"\r\n\t\t}\r\n    }\r\n\r\n    action {\r\n\t\tTokensTransfer(\"Recipient,Amount,Status\", IdToAddress(Int($validated_map[\"sender\"])), Money($validated_map[\"amount\"]), 3)\r\n        DBUpdate(\"validated_transactions\", $validated_id, \"status\", -1)\r\n\t\tNotifications_Single_Close(\"notific_id\", $notific_id)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Upload_doc",
            "Value": "contract Upload_doc {\r\n    data {\r\n        notific_id int\r\n        validated_id int\r\n\t\tinput_file bytes \"file\"\r\n    }\r\n\r\n    conditions {\r\n    }\r\n\t\r\n    action {\r\n\t\t$ApplicationId = Int(DBFind(\"applications\").Columns(\"id\").Where(\"name = ?\", \"CSSF\").One(\"id\"))\r\n\t\t$Name = \"Validated \" + Str($validated_id)\r\n\t\t$file = UploadBinary(\"ApplicationId,Name,Data\", $ApplicationId, $Name, $input_file)\r\n\t\tDBUpdate(\"validated_transactions\", $validated_id, \"document_id\", $file)\r\n\r\n\t\tvar validated_map map\r\n\t\tvalidated_map = DBFind(\"validated_transactions\").Where(\"id = ?\", $validated_id).Row()\r\n\t\tvar params_map map\r\n\t\tparams_map[\"transaction_id\"] = $validated_id\r\n\t\tNotifications_Single_Send(\"member_id,sender,icon_name,text_header,text_body,page_name,params_map\",\r\n\t\t\tInt(validated_map[\"delegate\"]), 1, \"fa-check\", \"Sending tokens\", \"Checking the financial institution\", \"page_upload_doc_check\", params_map)  \t\t\r\n\r\n\t\tNotifications_Single_Close(\"notific_id\", $notific_id)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Poles_Options",
            "Value": "contract Poles_Options {\r\n    data {\r\n        role_id int\r\n        max_amount money\r\n\t\tdaily_limit money\r\n    }\r\n    \r\n    conditions {\r\n    }\r\n\r\n    action {\r\n        DBUpdate(\"roles\", $role_id, \"financial_institutions->max_amount,financial_institutions->daily_limit\", $max_amount, $daily_limit)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Member_Blocking",
            "Value": "contract Member_Blocking {\r\n    data {\r\n        member_id int\r\n    }\r\n    conditions {\r\n        $keys_map = DBFind(\"keys\").Where(\"id = $\", $member_id).Row()\r\n    }\r\n    action {\r\n        DBUpdate(\"keys\", $member_id, \"blocked\", 1)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Member_Removing",
            "Value": "contract Member_Removing {\r\n    data {\r\n        member_id int\r\n    }\r\n    conditions {\r\n        $member_map = DBFind(\"keys\").Where(\"id = $\", $member_id).Row()\r\n    }\r\n    action {\r\n        var amount money\r\n        amount = Money($member_map[\"amount\"])\r\n        DBUpdate(\"keys\", $key_id, \"+amount\", amount)\r\n        DBUpdate(\"keys\", $member_id, \"amount,deleted\", 0, 1)\r\n\r\n        DBInsert(\"validated_transactions\", \"sender,recipient,delegate,amount,comment,document_id,financial_institution_id,status,timestamp tr_date\",\r\n            $member_id, $key_id, $key_id, amount, \"Member deleted\", 0, 0, 5, $block_time)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "Member_UnBlocking",
            "Value": "contract Member_UnBlocking {\r\n    data {\r\n        member_id int\r\n    }\r\n    conditions {\r\n        $keys_map = DBFind(\"keys\").Where(\"id = $\", $member_id).Row()\r\n    }\r\n    action {\r\n        DBUpdate(\"keys\", $member_id, \"blocked\", 0)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "menu",
            "Name": "default_menu",
            "Value": "Div(ajnav){\r\n    If(#role_id# == 0){\r\n        MenuItem(Title:Registration, Page: ajman_user_registration, Icon:\"fa icon-user\")\r\n    }.ElseIf(Or(#role_id# == 16,#role_id# == 18)){\r\n\t\tDiv(col text-center){\r\n\t\t\tDiv(col-md-12){\r\n\t\t\t\tDBFind(\"members\").Columns(\"id,member_name\").WhereId(#key_id#).Vars(pre)\r\n\t\t\t\tImage(Binary().ById(20), Class: img-thumbnail img-circle img-responsive thumb96)\r\n\t\t\t\tDiv(col-md-12 ajman-color-h1){\r\n\t\t\t\t\tSpan(Body:#pre_member_name#)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tDiv(col pd-top-50){\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Contracts\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"All Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"My Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=my\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Signed contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                        }\r\n                    }\r\n                }\r\n\t\t\t}\r\n\t\t}.Style(height: 100vh; background-color: #323639)\r\n    }.ElseIf(Or(#role_id# == 14,#role_id# == 15)){\r\n\t\tDiv(col text-center pd-top-50){\r\n\t\t\tDiv(col-md-12){\r\n\t\t\t\tDBFind(\"members\").Columns(\"id,member_name\").WhereId(#key_id#).Vars(pre)\r\n\t\t\t\tImage(Binary().ById(20), Class: img-thumbnail img-circle img-responsive thumb96)\r\n\t\t\t\tDiv(col-md-12 ajman-color-h1){\r\n\t\t\t\t\tSpan(Body:#pre_member_name#)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tDiv(col pd-top-50){\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Contracts\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"All Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"My Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=my\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Signed contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                        }\r\n                    }\r\n                }\r\n\t\t\t}\r\n\t\t}.Style(height: 100vh; background-color: #323639)\r\n    }.ElseIf(Or(#role_id# == 19,#role_id# == 21)){\r\n\t\tDiv(col text-center pd-top-50){\r\n\t\t\tDiv(col-md-12){\r\n\t\t\t\tDBFind(\"members\").Columns(\"id,member_name\").WhereId(#key_id#).Vars(pre)\r\n\t\t\t\tImage(Binary().ById(20), Class: img-thumbnail img-circle img-responsive thumb96)\r\n\t\t\t\tDiv(col-md-12 ajman-color-h1){\r\n\t\t\t\t\tSpan(Body:#pre_member_name#)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tDiv(col pd-top-50){\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Contracts\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"All Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Signed contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Managment control\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$profile$, Page:profile_view, Icon:\"fa icon-user\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$membership$, Page:members_list, Icon:\"fa icon-people\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuGroup(Title:$notifications$, Icon:\"fa fa-bell-o\"){\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$single_notifics$, Page:notifications_single, Icon:\"fa fa-bell-o\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$role_notifics$, Page:notifications_roles, Icon:\"fa fa-bullhorn\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$test_page$, Page:notifications_testpage, Icon:\"icon-settings\")\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$roles$, Page:roles_list, Icon:\"fa fa-list-ul\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title: $catalog_ecosystems$, Page: catalog_ecosystems, Icon:\"fa fa-book\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuGroup(Title:$admin$, Icon:\"fa icon-settings\"){\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$tokens_transfer$, Page:money_transfer, Icon:\"icon-energy\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$new_ecosystem$, Page:ecosystem_new, Icon:\"icon-globe\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title: $sysparams_list$,Page:sysparams_list, Icon:\"fa icon-settings\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$sysparams_candidates$, Page:sysparams_candidates, Icon:\"icon-list\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$sysparams_ecos$, Page:sysparams_ecos, Icon:\"icon-list\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$tokenrefund_list$, Page:tokenrefund_list, Icon:\"icon-list\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$tokens_transfer$, Page:tokens_transfer, Icon:\"icon-credit-card\")\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuGroup(Title:$voting$, Icon:\"fa fa-edit\"){\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$voting$, Page:voting_list, Icon:\"fa fa-edit\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$voting_templates$, Page:voting_templates, Icon:\"fa icon-pin\")\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\t\t\t}\r\n\t\t}.Style(height: 100vh; background-color: #323639)\r\n\t}.ElseIf(#role_id# == 22){\r\n    }.Else{\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Basic\", Icon: \"icon-folder\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:$profile$, Page:profile_view, Icon:\"fa icon-user\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:$membership$, Page:members_list, Icon:\"fa icon-people\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title:$notifications$, Icon:\"fa fa-bell-o\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$single_notifics$, Page:notifications_single, Icon:\"fa fa-bell-o\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$role_notifics$, Page:notifications_roles, Icon:\"fa fa-bullhorn\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$test_page$, Page:notifications_testpage, Icon:\"icon-settings\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:$roles$, Page:roles_list, Icon:\"fa fa-list-ul\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title: $catalog_ecosystems$, Page: catalog_ecosystems, Icon:\"fa fa-book\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title:$admin$, Icon:\"fa icon-settings\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$tokens_transfer$, Page:money_transfer, Icon:\"icon-energy\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$new_ecosystem$, Page:ecosystem_new, Icon:\"icon-globe\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title: $sysparams_list$,Page:sysparams_list, Icon:\"fa icon-settings\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$sysparams_candidates$, Page:sysparams_candidates, Icon:\"icon-list\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$sysparams_ecos$, Page:sysparams_ecos, Icon:\"icon-list\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$tokenrefund_list$, Page:tokenrefund_list, Icon:\"icon-list\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$tokens_transfer$, Page:tokens_transfer, Icon:\"icon-credit-card\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title:$voting$, Icon:\"fa fa-edit\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$voting$, Page:voting_list, Icon:\"fa fa-edit\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$voting_templates$, Page:voting_templates, Icon:\"fa icon-pin\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Договоры\", Icon: \"icon-folder\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Все договоры\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Мои договоры\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=my\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Подписанные договоры\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Арендовать Property\", Page:ajman_contract_add, Icon:\"fa fa-edit\", Params: \"property_id=2,unit_id=0,owner_id=7207124132448258015\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Арендовать Unit\", Page:ajman_contract_add, Icon:\"fa fa-edit\", Params: \"property_id=2,unit_id=1,owner_id=7207124132448258015\")\r\n                }\r\n            }\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:$business_manager$, Page:business_manager, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:$business_process$, Page:business_process, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:$ajman_user_registration$, Page:ajman_user_registration, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:\"Ajman_companies\", Page:Ajman_companies, Icon:\"icon-layers\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:\"Ajman_persones\", Page:Ajman_persones, Icon:\"icon-layers\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:\"Ajman Roles\", Page:ajamal_enter_user_role, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Add Property\", Page:property_add, Icon:\"icon-folder\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Add Unit\", Page:units_add, Icon:\"icon-folder\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                }\r\n            }\r\n        }\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Layout\", Icon: \"icon-layers\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_1, Page:aj_1, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_2, Page:aj_2, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_3, Page:aj_3, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_4, Page:aj_4, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_5, Page:aj_5, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_new, Page:aj_new, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:Table_Bled Page:Table_blead, Icon:\"fa fa-edit\")\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Title": "default",
            "Conditions": "ContractAccess(\"@1EditMenu\")"
        },
        {
            "Type": "pages",
            "Name": "members_list",
            "Value": "Div(content-wrapper){\r\n    SetTitle($membership$)\r\n    \r\n    If(GetVar(isSearch) == 1){\r\n        SetVar(Name: v_Where, Value: \"member_name='#v_Search#'\")\r\n    }.Else{\r\n        SetVar(Name: v_Where, Value: \"id!=0\")\r\n        SetVar(Name: v_Search, Value: \"\")\r\n    }\r\n    \r\n    DBFind(Name: members, Source: src_member).Columns(\"id,member_name,image_id\").Custom(custom_id){\r\n        Span(Class: h5, Body: #id#)\r\n    }.Custom(custom_member_id){\r\n        SetVar(Name: style_text, Value: \"text-normal\")\r\n        SetVar(Name: style_link, Value: \"text-primary\")\r\n        Span(Class: #style_text#, Body: Address(#id#))\r\n    }.Custom(custom_username){\r\n        SetVar(Name: img_id, Value: 0)\r\n        DBFind(Name: binaries, Source: src_binaries).Columns(\"name,app_id,id\").Where(\"id=#image_id#\").Vars(img)\r\n        LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#id#\"){\r\n            If(#img_id#>0){\r\n                Image(Src: Binary(Name: #img_name#,AppID:#img_app_id#, MemberID: #key_id#), Class: img-circle).Style(height: 30px;width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\r\n                Span(#member_name#)\r\n            }.Else{\r\n                Div(){\r\n                    Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n                    Span(#member_name#)\r\n                }.Style(display:flex; align-items:center;)\r\n            }\r\n        }\r\n    }.Where(#v_Where#).Order(\"member_name\")\r\n    \r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-1 mt-sm text-right){\r\n                    Label(For: Search){\r\n                        Span(Body: LangRes(name))\r\n                    }\r\n                }\r\n                Div(col-md-11){\r\n                    Div(input-group){\r\n                        Input(Name: Search, Value: #v_Search#)\r\n                        Div(input-group-btn){\r\n                            Button(Body: Em(Class: fa fa-search), Class: btn btn-default, Page: members_list, PageParams: \"isSearch=1,v_Search=Val(Search)\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Table(Source: src_member, Columns: \"$username$=custom_username,$id$=custom_id,$address$=custom_member_id\")\r\n                }\r\n            }\r\n            If(GetVar(isSearch) == 1){\r\n                Div(row){\r\n                    Div(col-md-12 mt-lg){\r\n                        Div(text-center){\r\n                            Button(Body: $view_all$, Class: btn btn-primary, Page: members_list, PageParams: \"isSearch=0\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "notifications_single",
            "Value": "Div(content-wrapper){\r\n    SetTitle($single_notifics$)\r\n    AddToolButton(Title: $send$, Page: notifications_single_send, Icon: icon-plus)\r\n\r\n    If(GetVar(isSearch) == 1){\r\n        SetVar(Name: v_Where, Value: \"notification->type='1' and recipient->member_name='#v_Search#'\")\r\n    }.Else{\r\n        SetVar(Name: v_Where, Value: \"notification->type='1'\")\r\n        SetVar(Name: v_Search, Value: \"\")\r\n    }\r\n    SetVar(pager_table,notifications).(pager_where,#v_Where#).(pager_page,notifications_single).(pager_limit,25)\r\n    Include(pager_header)\r\n    DBFind(Name: notifications, Source: src_notifications).Columns(\"id,recipient->member_id,recipient->member_name,recipient->image_id,sender->type,sender->member_id,sender->member_name,sender->role_id,sender->role_name,notification->icon,page_name,page_params,date_created,date_closed,closed\").Custom(custom_id){\r\n        If(#closed# == 0){\r\n            SetVar(Name: style_text, Value: \"text-normal\")\r\n            SetVar(Name: style_link, Value: \"text-primary\")\r\n        }.Else{\r\n            SetVar(Name: style_text, Value: \"text-muted\")\r\n            SetVar(Name: style_link, Value: \"text-muted\")\r\n        }\r\n        Span(Class: #style_text#, Body: #id#)\r\n    }.Custom(custom_recipient){\r\n        SetVar(Name: img_id, Value: 0)\r\n        \r\n        LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#recipient.member_id#\"){\r\n            If(#img_id#>0){\r\n                Image(Src: \"#img_data#\", Class: img-circle).Style(width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\r\n                Span(#recipient.member_name#)\r\n            }.Else{\r\n                Div(){\r\n                    Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n                    Span(#recipient.member_name#)\r\n                }.Style(display:flex; align-items:center;)\r\n            }\r\n        }\r\n    }.Custom(custom_sender){\r\n        If(#sender.type#==1){\r\n            LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#sender.member_id#\"){\r\n                Span(Body: #sender.member_name#)\r\n            }\r\n        }\r\n        If(#sender.type#==2){\r\n            LinkPage(Class: #style_link# h5 text-bold, Page: roles_view, PageParams: \"v_role_id=#sender.role_id#\"){\r\n                Span(Body: #sender.role_name#)\r\n            }\r\n        }\r\n    }.Custom(custom_icon){\r\n        Em(Class: fa #notification.icon# fa-2x #style_text#)\r\n    }.Custom(custom_page){\r\n        LinkPage(Class: #style_link# h5 text-bold, Page: #page_name#, PageParams: \"notific_id=#id#\"){\r\n            Span(Body: #page_name#)\r\n        }\r\n    }.Custom(custom_date){\r\n        Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\"))\r\n        Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_closed#, Format: \"DD.MM.YYYY HH:MI\"))\r\n    }.Custom(custom_status){\r\n        If(#closed# == 0){\r\n            Span(Class: #style_text#, Body: LangRes(active))\r\n        }.Else{\r\n            Span(Class: #style_text#, Body: LangRes(сlosed))\r\n        }\r\n    }.Custom(actions){\r\n        Div(pull-right){\r\n            If(#closed# == 0){\r\n                Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, Contract: Notifications_Single_Close, Params: \"notific_id=#id#\", Page: notifications_single).Alert(Text: $want_close_notification$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\r\n            }\r\n        }\r\n    }.Where(#v_Where#).Order(\"closed ASC, id desc\").Offset(#pager_offset#)\r\n\r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-1 mt-sm text-right){\r\n                    Label(For: Search){\r\n                        Span(Body: LangRes(recipient))\r\n                    }\r\n                }\r\n                Div(col-md-11){\r\n                    Div(input-group){\r\n                        Input(Name: Search, Value: #v_Search#)\r\n                        Div(input-group-btn){\r\n                            Button(Body: Em(Class: fa fa-search), Class: btn btn-default, Page: notifications_single, PageParams: \"isSearch=1,v_Search=Val(Search)\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Table(Source: src_notifications, Columns: \"$id$=custom_id,$icon$=custom_icon,$recipient$=custom_recipient,$page_name$=custom_page,$sender$=custom_sender,$sent$/$сlosed$=custom_date,$status$=custom_status,=actions\")\r\n                }\r\n            }\r\n            If(GetVar(isSearch) == 1){\r\n                Div(row){\r\n                    Div(col-md-12 mt-lg){\r\n                        Div(text-center){\r\n                            Button(Body: $view_all$, Class: btn btn-primary, Page: notifications_single, PageParams: \"isSearch=0\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Div(panel-footer){\r\n            Include(pager)\r\n        }\r\n    }\r\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "page_upload_doc",
            "Value": "Div(content-wrapper){\r\n    SetTitle(Uploading documents)\r\n    \r\n    DBFind(Name: notifications, Source: src_notifications).Columns(\"page_params->transaction_id,closed\").Where(\"id=#notific_id#\").Vars(n)\r\n\tDBFind(Name: validated_transactions, Source: src_validated).Where(\"id=#n_page_params_transaction_id#\").Vars(v)\r\n\r\n\r\n    Form(row){\r\n        Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\r\n            Div(panel panel-default){\r\n                Div(panel-heading text-center){\r\n                    Span(Class: h3, Body: Uploading documents)\r\n                }\r\n                Div(panel-body){\r\n                    Div(list-group-item text-center){\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 text-bold m0, Body: Sender:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: members).Columns(\"member_name\").Where(\"id=#v_sender#\").Vars(rv1)\r\n                                P(Class: h5 m0, Body: Address(#v_sender#))\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Recipient:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: members).Columns(\"member_name\").Where(\"id=#v_recipient#\").Vars(rv2)\r\n                                P(Class: h5 m0, Body: Address(#v_recipient#))\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Amount:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                P(Class: h5 m0, Body: #v_amount# APL)\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Financial institution:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: roles).Columns(\"role_name\").Where(\"id=#v_financial_institution_id#\").Vars(rv3)\r\n                                P(Class: h5 m0, Body: #rv3_role_name#)\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Delegate:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: members).Columns(\"member_name\").Where(\"id=#v_delegate#\").Vars(rv4)\r\n                                P(Class: h5 m0, Body: Address(#v_delegate#))\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Comment:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                P(Class: h5 m0, Body: #v_comment#)\r\n                            }\r\n                        }\r\n                    }\r\n                    If(And(#n_closed#==0,#v_sender#==#key_id#)){\r\n                        Div(list-group-item){\r\n                            Input(Name: input_file, Type: file)\r\n                            Input(Name: notific_id, Class: hidden, Value: #notific_id#)\r\n                            Input(Name: validated_id, Class: hidden, Value: #n_page_params_transaction_id#)\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-12 mt-lg text-right){\r\n                                Button(Body: \"Load\", Class: btn btn-primary, Contract: Upload_doc, Page: notifications_single)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "page_upload_doc_check",
            "Value": "Div(content-wrapper){\r\n    SetTitle(Verification of documents)\r\n    \r\n    DBFind(Name: notifications, Source: src_notifications).Columns(\"page_params->transaction_id,closed\").Where(\"id=#notific_id#\").Vars(n)\r\n\tDBFind(Name: validated_transactions, Source: src_validated).Where(\"id=#n_page_params_transaction_id#\").Vars(v)\r\n\r\n\r\n    Form(row){\r\n        Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\r\n            Div(panel panel-default){\r\n                Div(panel-heading text-center){\r\n                    Span(Class: h3, Body: Verification of documents)\r\n                }\r\n                Div(panel-body){\r\n                    Div(list-group-item text-center){\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 text-bold m0, Body: Sender:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: members).Columns(\"member_name\").Where(\"id=#v_sender#\").Vars(rv1)\r\n                                P(Class: h5 m0, Body: Address(#v_sender#))\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Recipient:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: members).Columns(\"member_name\").Where(\"id=#v_recipient#\").Vars(rv2)\r\n                                P(Class: h5 m0, Body: Address(#v_recipient#))\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Amount:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                P(Class: h5 m0, Body: #v_amount# APL)\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Financial institution:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: roles).Columns(\"role_name\").Where(\"id=#v_financial_institution_id#\").Vars(rv3)\r\n                                P(Class: h5 m0, Body: #rv3_role_name#)\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Delegate:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                DBFind(Name: members).Columns(\"member_name\").Where(\"id=#v_delegate#\").Vars(rv4)\r\n                                P(Class: h5 m0, Body: Address(#v_delegate#))\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-4 mt-sm text-right){\r\n                                P(Class: h5 m0 text-bold, Body: Comment:)\r\n                            }\r\n                            Div(col-md-8 mt-sm text-left){\r\n                                P(Class: h5 m0, Body: #v_comment#)\r\n                            }\r\n                        }\r\n                        Div(row){\r\n                            Div(col-md-12 mt-sm){\r\n\t\t\t\t\t\t\t\tDBFind(Name: binaries, Source: src_binaries).Where(\"id=#v_document_id#\").Custom(doc){\r\n                                    Span(Class: text-bold, Body: \"Document\")\r\n                                }\r\n\t\t\t\t\t\t\t\tTable(src_binaries, \"=doc,=data\")\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n                    }\r\n                    If(And(#n_closed#==0,#v_delegate#==#key_id#)){\r\n                        Div(row){\r\n                            Div(col-md-6 mt-lg text-left){\r\n                                Input(Name: notific_id, Class: hidden, Value: #notific_id#)\r\n                                Input(Name: validated_id, Class: hidden, Value: #n_page_params_transaction_id#)\r\n                                Button(Body: Em(Class: fa fa-thumbs-down) Reject, Class: btn btn-danger, Page: transactions, Contract: Upload_Doc_Reject)\r\n                            }\r\n                            Div(col-md-6 mt-lg text-right){\r\n                                Button(Body: Em(Class: fa fa-thumbs-up) Accept, Class: btn btn-success, Page: transactions, Contract: Upload_Doc_Accept)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "profile_edit",
            "Value": "Div(content-wrapper){\r\n    SetTitle($editing_profile$)\r\n    Div(breadcrumb){\r\n        LinkPage($user_info$, profile_view)\r\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\r\n        Span(Class: text-muted, Body: $editing_profile$)\r\n    }\r\n    \r\n    If(Or(#v_member_id#>0,#v_member_id#<0)){\r\n        DBFind(Name: members, Source: src_member).Columns(\"id,member_name,image_id,member_info->information\").Where(\"id=#v_member_id#\").Vars(prefix)\r\n    }.Else{\r\n        DBFind(Name: members, Source: src_member).Columns(\"id,member_name,image_id,member_info->information\").Where(\"id=#key_id#\").Vars(prefix)\r\n    }\r\n    \r\n    Div(row){\r\n        Div(col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3){\r\n            Form(panel panel-primary){\r\n                Div(panel-heading, Body: LangRes(editing_profile))\r\n                Div(panel-body){\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 mt-sm text-right){\r\n                                Label(For: member_name){\r\n                                    Span(Body: LangRes(member_name))\r\n                                    Span(Class: text-danger, Body:*)\r\n                                }\r\n                            }\r\n                            Div(col-md-9 mc-sm text-left){\r\n                                If(GetVar(prefix_member_name)>0){\r\n                                    Input(Name: member_name, Value: #prefix_member_name#, Disabled: true)\r\n                                }.Else{\r\n                                    Input(Name: member_name).Validate(minLength:5, maxLength:20)\r\n                                    InputErr(Name: member_name, minLength: $validate_member_name$, maxLength: $validate_member_name$)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 mt-sm text-right){\r\n                                Label(For: member_image){\r\n                                    Span(Body: LangRes(member_image))\r\n                                    If(Or(#prefix_id#>0,#prefix_id#<0)){\r\n                                    }.Else{\r\n                                        Span(Class: text-danger, Body:*)\r\n                                    }\r\n                                }\r\n                            }\r\n                            Div(col-md-9 mc-sm text-left){\r\n                                ImageInput(Name: member_image, Width: 100, Ratio: 1/1)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Div(row){\r\n                            Div(col-md-3 mt-lg text-right){\r\n                                Label(For: information){\r\n                                    Span(Body: LangRes(information))\r\n                                }\r\n                            }\r\n                            Div(col-md-9 mc-sm text-left){\r\n                                If(GetVar(prefix_member_info_information)){\r\n                                    Input(Name: information, Type: textarea, Value: #prefix_member_info_information#)\r\n                                }.Else{\r\n                                    Input(Name: information, Type: textarea)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    Button(Body: LangRes(save), Class: btn btn-primary, Contract: Profile_Edit, Page: members_list,).Alert(Text: $want_save_changes$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "profile_edit_institution",
            "Value": "Div(content-wrapper){\r\n    SetTitle(New financial institution)\r\n    Div(row){\r\n        Div(col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3){\r\n            Form(panel panel-primary){\r\n                Div(panel-heading, Body: New financial institution)\r\n                Div(panel-body){\r\n                    Div(row){\r\n                        Div(col-md-3 mt-sm text-right){\r\n                            Label(){\r\n                                Span(Body: LangRes(name))\r\n                                Span(Class: text-danger, Body:*)\r\n                            }\r\n                        }\r\n                        Div(col-md-9 mc-sm text-left){\r\n                            Input(Name: role_name, Value: \"Financial institution\")\r\n                            Input(Name: member_key, Class: hidden, Value: #v_member_id#)\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    Button(Body: Add, Class: btn btn-primary, Contract: Profile_Edit_Institution, Page: members_list)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "profile_edit_member",
            "Value": "Div(content-wrapper){\r\n    SetTitle(New member)\r\n    Div(row){\r\n        Div(col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3){\r\n            Form(panel panel-primary){\r\n                Div(panel-heading, Body: New member)\r\n                Div(panel-body){\r\n                    Div(row){\r\n                        Div(col-md-3 mt-sm text-right){\r\n                            Label(){\r\n                                Span(Body: LangRes(member_name))\r\n                                Span(Class: text-danger, Body:*)\r\n                            }\r\n                        }\r\n                        Div(col-md-9 mc-sm text-left){\r\n                            Input(Name: member_name, Value: Address(#v_member_id#), Disabled: 1)\r\n                            Input(Name: member_key, Class: hidden, Value: #v_member_id#)\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    Button(Body: Add, Class: btn btn-primary, Contract: Profile_Edit_Member, Page: members_list)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "profile_view",
            "Value": "Div(content-wrapper){\r\n    SetTitle($user_info$)\r\n    \r\n    If(Or(#v_member_id#>0,#v_member_id#<0)){\r\n    }.Else{\r\n        SetVar(Name: v_member_id, Value: #key_id#)\r\n    }\r\n    DBFind(Name: members, Source: src_member).Where(\"id=#v_member_id#\").Vars(prefix)\r\n    DBFind(Name: keys, Source: src_keys).Where(\"id=#key_id#\").Vars(tokens)\r\n    \r\n    If(#prefix_image_id#>0){\r\n        DBFind(Name: binaries, Source: src_binaries).Columns(\"id,data\").Where(\"id=#prefix_image_id#\").Vars(img)\r\n    }\r\n    If(Or(#prefix_id#>0,#prefix_id#<0)){\r\n    }.Else{\r\n        SetVar(Name: prefix_member_name, Value: \"\")\r\n    }\r\n    \r\n    Div(row){\r\n        Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\r\n            Form(panel panel-default){\r\n                Div(panel-heading text-center){\r\n                    Span(Class: h3, Body: LangRes(user_info))\r\n                }\r\n                Div(panel-body){\r\n                    Div(form-group){\r\n                        Div(row){\r\n                            Div(col-md-12 mt-sm text-center){\r\n                                If(Or(#prefix_id#>0,#prefix_id#<0)){\r\n                                    If(#prefix_id# == #key_id#){\r\n                                        Button(Class: btn btn-link, Page: profile_edit, PageParams: \"v_member_id=#key_id#\"){\r\n                                            If(#img_id#>0){\r\n                                                Image(Src: \"#img_data#\", Class: img-circle).Style(width: 80px; border: 1px solid #5A5D63;)\r\n                                            }.Else{\r\n                                                Span(Class: fa icon-user fa-5x text-primary)\r\n                                            }\r\n                                            Div(m0 h3 text-bold){#prefix_member_name#}\r\n                                        }\r\n                                    }.Else{\r\n                                        If(#img_id#>0){\r\n                                            Image(Src: \"#img_data#\", Class: img-circle).Style(width: 80px; border: 1px solid #5A5D63;)\r\n                                        }.Else{\r\n                                            Span(Class: fa icon-user fa-5x)\r\n                                        }\r\n                                        Div(m0 h3 text-bold){#prefix_member_name#}\r\n                                    }\r\n                                }.Else{\r\n                                    Button(Class: btn btn-link, Page: profile_edit){\r\n                                        Span(Class: h3 text-bold, Body: LangRes(editing_profile))\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item text-center){\r\n                        Div(text-muted m0 h5, Body: LangRes(address))\r\n                        Span(Class: h5 text-bold, Body: Address(#prefix_id#))\r\n                    }\r\n                    Div(list-group-item text-center){\r\n                        Div(text-muted m0 h5, Body: LangRes(roles))\r\n                        DBFind(Name: roles_participants, Source: src_check).Columns(\"id\").Where(\"member->member_id='#v_member_id#' and deleted=0\").Vars(check)\r\n                        If(#check_id#>0){\r\n                            DBFind(Name: roles_participants, Source: src_roles).Columns(\"role->id,role->name\").Where(\"member->member_id='#v_member_id#' and deleted=0\").Order(\"id\")\r\n                            ForList(src_roles){\r\n                                Span(){\r\n                                    LinkPage(Page: roles_view, PageParams: \"v_role_id=#role.id#\"){\r\n                                        Span(Class: h5 text-bold, Body: \"#role.name#\")\r\n                                    }\r\n                                }.Style(margin-right: 5px; margin-left: 5px;)\r\n                            }\r\n                        }.Else{\r\n                            Span(LangRes(no))\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "roles_view",
            "Value": "Div(content-wrapper){\n    \n    If(#v_role_id# > 0){\n        DBFind(Name: roles, Source: src_roles).Columns(\"role_name,role_type,deleted\").Where(\"id=#v_role_id#\").Vars(prefix)\n        \n        SetTitle($role$: #prefix_role_name#)\n        Div(breadcrumb){\n            LinkPage($roles$, roles_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: #prefix_role_name#)\n        }\n        \n        DBFind(Name: roles_participants, Source: src_participants).Columns(\"id,member->member_id,member->member_name,member->image_id,appointed->member_id,appointed->member_name,appointed->voting_id,appointed->voting_name,date_created,date_deleted,deleted\").Custom(custom_id){\n            If(#deleted# == 0){\n                SetVar(Name: style_text, Value: \"text-normal\")\n                SetVar(Name: style_link, Value: \"text-primary\")\n            }.Else{\n                SetVar(Name: style_text, Value: \"text-muted\")\n                SetVar(Name: style_link, Value: \"text-muted\")\n            }\n            Span(Class: #style_text#, Body: #id#)\n        }.Custom(custom_appointed){\n            If(Or(#appointed.member_id#>0,#appointed.member_id#<0)){\n                LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#appointed.member_id#\"){\n                    Span(Body: #appointed.member_name#)\n                }\n            }\n            If(#appointed.voting_id#>0){\n                LinkPage(Page: voting_view, PageParams: \"vID=#appointed.voting_id#\"){\n                    Span(Class: h5 text-bold, Body: #appointed.voting_name#)\n                }\n            }\n        }.Custom(custom_member){\n            SetVar(Name: img_id, Value: 0)\n            If(#member.image_id#>0){\n                DBFind(Name: binaries, Source: src_binaries).Columns(\"data\").Where(\"id=#member.image_id#\").Vars(img)\n            }\n            LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#member.member_id#\"){\n                If(#img_id#>0){\n                    Image(Src: \"#img_data#\", Class: img-circle).Style(width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\n                    Span(#member.member_name#)\n                }.Else{\n                    Div(){\n                        Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\n                        Span(#member.member_name#)\n                    }.Style(display:flex; align-items:center;)\n                }\n            }\n        }.Custom(custom_address){\n            Span(Class: #style_text#, Body: Address(#member.member_id#))\n        }.Custom(custom_date){\n            Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\"))\n            Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_deleted#, Format: \"DD.MM.YYYY HH:MI\"))\n        }.Custom(custom_status){\n            If(#deleted# == 0){\n                Span(Class: #style_text#, Body: LangRes(active))\n            }.Else{\n                Span(Class: #style_text#, Body: LangRes(deleted))\n            }\n        }.Custom(actions){\n            Div(pull-right){\n                If(And(#deleted#==0,#prefix_role_type#!=3)){\n                    Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, Contract: Roles_Unassign, Params: \"row_id=#id#\", Page: roles_view, PageParams: \"v_role_id=#v_role_id#\").Alert(Text: $sure_want_delete$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                }\n            }\n        }.Where(\"role->id='#v_role_id#'\").Order(\"deleted ASC, id ASC\")\n        \n        Form(panel panel-primary){\n            Div(panel-body){\n                Table(Source: src_participants, Columns: \"$id$=custom_id,$member$=custom_member,$address$=custom_address,$appointed$=custom_appointed,$appointed$ / $deleted$=custom_date,$status$=custom_status,=actions\")\n            }\n            Div(panel-footer text-right){\n                Button(Body: LangRes(back), Class: btn btn-default, Page: roles_list)\n                If(#prefix_deleted#==0){\n                    Button(Body: LangRes(assign), Class: btn btn-primary, Page: roles_assign, PageParams: \"v_role_id=#v_role_id#\")\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "accounts",
            "Value": "Include(accounts)",
            "Conditions": "true",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "transactions",
            "Value": "Div(content-wrapper){\r\n    SetTitle(Transactions)\r\n\r\n    If(#role_id#==0){\r\n       SetVar(v_Where, \"sender=#key_id# or recipient=#key_id#\")\r\n    }\r\n    If(#role_id#==1){\r\n       SetVar(v_Where, \"sender=#key_id# or recipient=#key_id#\")\r\n    }\r\n    If(#role_id#>1){\r\n       SetVar(v_Where, \"financial_institution_id=#role_id#\")\r\n    }\r\n\r\n    DBFind(Name: validated_transactions, Source: src_validated_transactions).Columns(\"id,sender,recipient,amount,status,tr_date,financial_institution_id,delegate\").Custom(custom_id){\r\n        Span(Class: h5, Body: #id#)\r\n    }.Custom(custom_sender){\r\n        DBFind(Name: members).Columns(\"member_name\").Where(\"id=#sender#\").Vars(rv1)\r\n        LinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#sender#\"){\r\n            Div(){\r\n                Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n                Span(#rv1_member_name#)\r\n            }.Style(display:flex; align-items:center;)\r\n        }\r\n    }.Custom(custom_recipient){\r\n\t\tIf(Or(#delegate#>0,#delegate#<0)){\r\n\t\t\tDBFind(Name: members).Columns(\"member_name\").Where(\"id=#delegate#\").Vars(rv2)\r\n\t\t\tLinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#delegate#\"){\r\n\t\t\t\tDiv(){\r\n\t\t\t\t\tSpan(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n\t\t\t\t\tSpan(#rv2_member_name#)\r\n\t\t\t\t}.Style(display:flex; align-items:center;)\r\n\t\t\t}\r\n\t\t}.Else{\r\n\t\t\tDBFind(Name: members).Columns(\"member_name\").Where(\"id=#recipient#\").Vars(rv2)\r\n\t\t\tLinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#recipient#\"){\r\n\t\t\t\tDiv(){\r\n\t\t\t\t\tSpan(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\r\n\t\t\t\t\tSpan(#rv2_member_name#)\r\n\t\t\t\t}.Style(display:flex; align-items:center;)\r\n\t\t\t}\r\n\t\t}\r\n    }.Custom(custom_amount){\r\n        Span(Class: h4 text-bold, Body: #amount# APL)\r\n    }.Custom(custom_date){\r\n        Span(Class: h4, Body: DateTime(DateTime: #tr_date#, Format: \"YYYY-MM-DD HH:MI\"))\r\n    }.Custom(custom_arr){\r\n        Span(Em(Class: text-muted fa fa-arrow-right fa-2x))\r\n    }.Custom(custom_status){\r\n        If(#status#==-1){\r\n            Span(Class: h4 text-danger, Body: Rejected)\r\n        }\r\n        If(#status#==1){\r\n            Span(Class: h4 text-warning, Body: Checking)\r\n        }\r\n        If(#status#==2){\r\n            Span(Class: h4 text-success, Body: Accepted)\r\n        }\r\n        If(#status#==3){\r\n            Span(Class: h4 text-danger, Body: Rollback)\r\n        }\r\n        If(#status#==4){\r\n            Span(Class: h4 text-success, Body: Confirmation)\r\n        }\r\n        If(#status#==5){\r\n            Span(Class: h4 text-danger, Body: Member deleted)\r\n        }\r\n    }.Where(#v_Where#).Order(\"id desc\").Limit(10)\r\n\r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Table(Source: src_validated_transactions, Columns: \"$id$=custom_id,$sender$=custom_sender,=custom_arr,$recipient$=custom_recipient,Date=custom_date,$amount$=custom_amount,$status$=custom_status\")\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n}",
            "Conditions": "true",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "roles_options",
            "Value": "Div(content-wrapper){\r\n    DBFind(Name: roles, Source: src_roles).Columns(\"id,role_name,financial_institutions->max_amount,financial_institutions->daily_limit\").Where(\"id=#v_role_id#\").Vars(role)\r\n\r\n    SetTitle(#role_role_name#)\r\n    Div(breadcrumb){\r\n        LinkPage($roles$, roles_list)\r\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\r\n        Span(Class: text-muted, Body: $edit$)\r\n    }\r\n\r\n    Div(row){\r\n        Div(col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3){\r\n            Form(panel panel-primary){\r\n                Div(panel-heading, Body: #role_role_name#)\r\n                Div(panel-body){\r\n                    Div(row){\r\n                        Div(col-md-3 mt-sm text-right){\r\n                            Label(){\r\n                                Span(Body: Max amount APL)\r\n                                Span(Class: text-danger, Body:*)\r\n                            }\r\n                        }\r\n                        Div(col-md-9 mc-sm text-left){\r\n                            Input(Name: role_id, Value: #v_role_id#, Class: hidden)\r\n                            Input(Name: max_amount, Value: #role_financial_institutions_max_amount#)\r\n                        }\r\n                    }\r\n                    Div(row){\r\n                        Div(col-md-3 mt-sm text-right){\r\n                            Label(){\r\n                                Span(Body: Daily limit APL)\r\n                                Span(Class: text-danger, Body:*)\r\n                            }\r\n                        }\r\n                        Div(col-md-9 mc-sm text-left){\r\n                            Input(Name: daily_limit, Value: #role_financial_institutions_daily_limit#)\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    Button(Body: LangRes(save), Class: btn btn-primary, Contract: Poles_Options, Page: roles_list)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "ecosystem_new",
            "Value": "Div(content-wrapper){\n    \n    SetTitle(New Ecosystem)\n    Div(breadcrumb){\n        Span(Class: text-muted, Body: New Ecosystem)\n    }\n    \n    Div(row){\n        Div(col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4){\n            Form(panel panel-primary){\n                Div(panel-heading){New Ecosystem}\n                Div(panel-body){\n                    Div(row){\n                        Div(col-md-3 mt-sm text-right){\n                            Label(For: Name){$name$}\n                        }\n                        Div(col-md-9 mc-sm text-left){\n                            Input(Placeholder: Name of Ecosystem, Name:Name)\n                        }\n                    }\n                }\n                Div(panel-footer text-right){\n                    Button(Body: LangRes(create), Class: btn btn-primary, Contract: NewEcosystem)\n                }\n            }\n        }\n    }\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Type": "app_params",
            "Name": "roles_types",
            "Value": "assigned_role,elective_role,system_role,company_role",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "tables",
            "Name": "validated_transactions",
            "Columns": "[{\"name\":\"amount\",\"type\":\"money\",\"conditions\":\"true\"},{\"name\":\"sender\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"status\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"comment\",\"type\":\"text\",\"conditions\":\"true\"},{\"name\":\"deleted\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"tr_date\",\"type\":\"datetime\",\"conditions\":\"true\"},{\"name\":\"delegate\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"recipient\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"document_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"financial_institution_id\",\"type\":\"number\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"true\", \"update\": \"true\", \"new_column\": \"ContractConditions(\\\"MainCondition\\\")\"}"
        }
    ]
}