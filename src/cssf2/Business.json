{
    "name": "Business",
    "data": [
        {
            "Type": "blocks",
            "Name": "payment_block",
            "Value": "Div(){\r\n    If(And(#id#>0,#business_model_object_type#>0)){\r\n        SetVar(payment_table,\"AppParam(App:4,Name:object_status_tables, Index:#business_model_object_type#)\")\r\n        If(#payment_table#!=\"\"){\r\n            DBFind(#payment_table#).WhereId(#id#).Vars(pay)\r\n            Strong(\"Applications fees: \", mr-sm)\r\n            Span(Class:text-warning){\r\n                If(Or(#pay_applications_fees#>0,#pay_applications_fees#<0)){\r\n                    #pay_applications_fees#\r\n                }.Else{\r\n                    0\r\n                }\r\n                AED\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "business_Manager",
            "Value": "contract business_Manager {\r\n    data {\r\n        Action string\r\n        Id string \"optional\"\r\n        EventId string \"optional\"\r\n        ModelId string \"optional\"\r\n        ObjectType string \"optional\"\r\n        Title string \"optional\"\r\n        RoleId string \"optional\"\r\n        TextBody string \"optional\"\r\n        NeedComment string \"optional\"\r\n        // condition\r\n        ConditionEventId array \"optional\"\r\n        ConditionResult array \"optional\"\r\n        ConditionDelete array \"optional\"\r\n        // result\r\n        Submit string \"optional\"\r\n        SentBack string \"optional\"\r\n        Accept string \"optional\"\r\n        Escalation string \"optional\"\r\n        Reject string \"optional\"\r\n        Inform string \"optional\"\r\n        Pay string \"optional\"\r\n    }\r\n    func boolChar(s string) int {\r\n        if s {\r\n            return 1\r\n        }\r\n        return 0\r\n    }\r\n    func safeGet(a array, i int) int {\r\n        if Len(a) > i{\r\n            return Int(a[i])\r\n        }\r\n        return 0\r\n    }\r\n    func safeGetBoolChar(a array, i int) int {\r\n        if Len(a) > i{\r\n            return boolChar(a[i])\r\n        }\r\n        return 0\r\n    }\r\n    func getResultId(r string)int{\r\n        var i int\r\n        while i<Len($results){\r\n            if $results[i] == r{\r\n                return i+1\r\n            }\r\n            i=i+1\r\n        }\r\n        return 0\r\n    }\r\n    func getCondArray(cond map) array {\r\n        var res array\r\n        // Int() for fixed \"interface conversion: interface {} is nil, not decimal.Decimal\"\r\n        if Int(cond[\"EventId\"]) > 0{\r\n            res[0] = Sprintf(\"%v\", cond[\"EventId\"])\r\n        }\r\n        var type string\r\n        var i int\r\n        while i<Len($results){\r\n            type = $results[i]\r\n            if Int(cond[type]) == 1{\r\n                res[Len(res)] = Sprintf(\"%v(%v)\", type, getResultId(type))\r\n            }\r\n            i=i+1\r\n        }\r\n        return res\r\n    }\r\n    conditions {\r\n        $Id = Int($Id)\r\n        $ApplicationId = Int(DBFind(\"applications\").Where(\"name='Business'\").One(\"id\"))\r\n        if $ApplicationId == 0 {\r\n            warning \"Application ID not found\"\r\n        }\r\n        $results = AppParam($ApplicationId, \"results\")\r\n        $results = Split($results, \",\")\r\n\r\n        $SUBMIT = \"Submit\"\r\n        $SENDBACK = \"Send Back\"\r\n        $ACCEPT = \"Accept\"\r\n        $ESCALATION = \"Escalation\"\r\n        $REJECT = \"Reject\"\r\n        $INFORM = \"Inform\"\r\n        $PAY = \"Pay\"\r\n    }\r\n    action {\r\n        if $Action == \"create\" || $Action == \"update\"{\r\n            $ModelId = Int($ModelId)\r\n            $ObjectType = Int($ObjectType)\r\n            $RoleId = Int($RoleId)\r\n            $EventId = Int($EventId)\r\n            $NeedComment = boolChar($NeedComment)\r\n            var condition map\r\n            var conditionPretty array\r\n            var i int\r\n            while i<Len($ConditionResult){\r\n                var conditionDelete int\r\n                conditionDelete = safeGetBoolChar($ConditionDelete, i)\r\n                if !conditionDelete {\r\n                    var cond map\r\n                    var key val int\r\n                    key = safeGet($ConditionEventId, i)\r\n                    val = safeGet($ConditionResult, i)\r\n                    condition[Str(key)] = val\r\n                    var prettyPrint string\r\n                    if key == 0{\r\n                        prettyPrint = Sprintf(\"%v(%v)\", $results[val-1], val)\r\n                    }else{\r\n                        prettyPrint = Sprintf(\"[%v:%v(%v)]\", key, $results[val-1], val)\r\n                    }\r\n                    conditionPretty[Len(conditionPretty)] = prettyPrint\r\n                }\r\n                i=i+1\r\n            }\r\n            $Condition = JSONEncode(condition)\r\n            $conditionPretty = Join(conditionPretty, \" OR \")\r\n\r\n            var result map\r\n            result[$SUBMIT] = boolChar($Submit)\r\n            result[$SENDBACK] = boolChar($SentBack)\r\n            result[$ACCEPT] = boolChar($Accept)\r\n            result[$ESCALATION] = boolChar($Escalation)\r\n            result[$REJECT] = boolChar($Reject)\r\n            result[$INFORM] = boolChar($Inform)\r\n            result[$PAY] = boolChar($Pay)\r\n            $Result = JSONEncode(result)\r\n            $resultPretty = Join(getCondArray(result), \", \")\r\n        }\r\n\r\n        if $Action == \"create\"{\r\n            DBInsert(\"business_models\", \"event_id,object_type,title,role_id,text_body,need_comment,condition,result,condition_pretty,result_pretty,model_id\", $EventId,$ObjectType,$Title,$RoleId,$TextBody,$NeedComment,$Condition,$Result,$conditionPretty,$resultPretty,$ModelId)\r\n        }\r\n        if $Id == 0 {\r\n            return\r\n        }\r\n        if $Action == \"update\" {\r\n            DBUpdate(\"business_models\", $Id, \"event_id,object_type,title,role_id,text_body,need_comment,condition,result,condition_pretty,result_pretty,model_id\", $EventId,$ObjectType,$Title,$RoleId,$TextBody,$NeedComment,$Condition,$Result,$conditionPretty,$resultPretty,$ModelId)\r\n        }\r\n        if $Action == \"delete\" {\r\n            DBUpdate(\"business_models\", $Id, \"deleted\", 1)\r\n        }\r\n        if $Action == \"restore\" {\r\n            DBUpdate(\"business_models\", $Id, \"deleted\", 0)\r\n        }\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "business_Process",
            "Value": "contract business_Process {\r\n    data {\r\n        Id int // business_models:id\r\n        ModelId int // business_models:model_id\r\n        EventId int\r\n        ResultId int\r\n        ObjectType int\r\n        ObjectId int\r\n        Comment string \"optional\"\r\n        NotificId string \"optional\"\r\n    }\r\n    func stringInArray(s string, a array) bool{\r\n        var i int\r\n        while i<Len(a){\r\n            if a[i] == s{\r\n                return true\r\n            }\r\n            i=i+1\r\n        }\r\n        return false\r\n    }\r\n    func resultToStatusId(r string)int{\r\n        // Ecosystem param property_statuses\r\n        var statuses map\r\n        statuses[$SUBMIT] = 1 // submited\r\n        statuses[$ESCALATE] = 2 // escalated\r\n        statuses[$SENDBACK] = 3 // sendback\r\n        statuses[$ACCEPT] = 4 // accepted\r\n        statuses[$REJECT] = 5 // rejected\r\n        statuses[$AMACCEPT] = 6 // am_accepted\r\n        var status int\r\n        if statuses[r] {\r\n            status = statuses[r]\r\n        }\r\n        return status\r\n    }\r\n    func updateObject(){\r\n        if Size($objectTable) > 1{\r\n            // if $resultStr == $ACCEPT && stringInArray(Str($role_id), $managerRoleIds){\r\n            //     $resultStr = $AMACCEPT\r\n            // }\r\n            var status int\r\n            status = resultToStatusId($resultStr)\r\n            if status > 0{\r\n                if DBFind($objectTable).WhereId($ObjectId).One(\"status\"){\r\n                    DBUpdate($objectTable, $ObjectId, \"status\", status)\r\n                }else{\r\n                    warning \"Status not found\"\r\n                }\r\n            }\r\n            if $objectTable == \"property_contracts\" && ($resultStr == $ACCEPT || $resultStr == $AMACCEPT) {\r\n                var obj map\r\n                obj = DBFind($objectTable).Where(\"id=?\",$ObjectId).Row()\r\n                if obj {\r\n                    var unitId propertyId int\r\n                    unitId = Int(obj[\"unit_id\"])\r\n                    propertyId = Int(obj[\"property_id\"])\r\n                    if unitId > 0{\r\n                        DBUpdate(\"units\", unitId, \"rented,start_date,end_date,tenant_id\", $ObjectId, obj[\"start_date\"], obj[\"end_date\"], obj[\"tenant_id\"])\r\n                    }else{\r\n                        if propertyId > 0{\r\n                            DBUpdate(\"properties\", propertyId, \"rented,start_date,end_date,tenant_id\", $ObjectId, obj[\"start_date\"], obj[\"end_date\"], obj[\"tenant_id\"])\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    func getAppParamArray(name string, min int) array{\r\n        var res array\r\n        res = Split(AppParam($ApplicationId, name), \",\")\r\n        if Len(res) < min {\r\n            warning Sprintf(\"%v invalid\", name)\r\n        }\r\n        return res\r\n    }\r\n    func trim(s string)string{\r\n        while HasPrefix(s, \" \"){\r\n            s = Substr(s, 1, Size(s))\r\n        }\r\n        while \" \" == Substr(s, Size(s)-1, 1){\r\n            s = Substr(s, 0, Size(s)-1)\r\n        }\r\n        return s\r\n    }\r\n    func getNextModel()map{\r\n        var nextModel model map\r\n        var i int\r\n        while i<Len($models){\r\n            model = $models[i]\r\n            var cond map\r\n            cond = JSONDecode(model[\"condition\"])\r\n            if cond[\"0\"] == $ResultId || cond[Str($EventId)] == $ResultId {\r\n                nextModel = model\r\n                break\r\n            }\r\n            i=i+1\r\n        }\r\n        return nextModel\r\n    }\r\n    func closeNotify(){\r\n        if $NotificId > 0{\r\n            Notifications_Roles_Processing(\"notific_id\", $NotificId)\r\n            Notifications_Roles_Close(\"notific_id\", $NotificId)\r\n        }\r\n    }\r\n    func sendNext(model map){\r\n        if model {\r\n            var roleId closureType sender int\r\n            roleId = model[\"role_id\"]\r\n            closureType = 2 // multiple\r\n            sender = 2 // from admin?\r\n            var icon header body page string\r\n            icon = \"icon-envelope\"\r\n            header = Sprintf(\"Business process: %v\", model[\"title\"])\r\n            body = Sprintf(\"Next step for object id #%v\", $ObjectId)\r\n            page = \"business_process\"\r\n            var params map\r\n            params[\"id\"] = model[\"id\"]\r\n            params[\"object_id\"] = $ObjectId\r\n            params[\"comment\"] = $Comment\r\n            if roleId == $ownerRoleId {\r\n                var initiator string\r\n                initiator = DBFind(\"business_events\").Where(\"object_id=? and result_id=1 and model_id=?\", $ObjectId, $ModelId).Order(\"event_id asc, id desc\").One(\"key_id\")\r\n                if initiator {\r\n                    // if the role is Owner send alert to the initiating user (submit event)\r\n                    Notifications_Single_Send_map(\"member_id,sender,icon_name,text_header,text_body,page_name,params_map\", Int(initiator), sender, icon, header, body, page, params)\r\n                }else{\r\n                    warning \"Initiator process not found\"\r\n                }\r\n            }else{\r\n                Notifications_Roles_Send_map(\"rid,closure_type,sender,icon_name,text_header,text_body,page_name,params_map\", roleId, closureType, sender, icon, header, body, page, params)\r\n            }\r\n        }\r\n    }\r\n    conditions {\r\n        $ApplicationId = Int(DBFind(\"applications\").Where(\"name='Business'\").One(\"id\"))\r\n        if $ApplicationId == 0 {\r\n            warning \"Application ID not found\"\r\n        }\r\n        $ownerRoleId = Int(AppParam($ApplicationId,\"owner_role_id\"))\r\n        if $ownerRoleId == 0 {\r\n            info \"Application parameter owner_role_id not found\"\r\n        }\r\n        $SUBMIT = \"Submit\"\r\n        $ESCALATE = \"Escalate\"\r\n        $SENDBACK = \"Send Back\"\r\n        $ACCEPT = \"Accept\"\r\n        $REJECT = \"Reject\"\r\n        $AMACCEPT = \"AM Accept\"\r\n\r\n        $results = getAppParamArray(\"results\", $ResultId)\r\n        $objectTypes = getAppParamArray(\"object_types\", $ObjectType)\r\n        $managerRoleIds = getAppParamArray(\"manager_role_ids\", 1)\r\n        $objectTables = getAppParamArray(\"object_status_tables\", $ObjectType)\r\n\r\n        $objectTable = trim($objectTables[$ObjectType-1])\r\n        $resultStr = trim($results[$ResultId-1])\r\n        $objectStr = trim($objectTypes[$ObjectType-1])\r\n\r\n        $numSubmitted = Int(DBFind(\"business_events\").Where(\"event_id=? and object_type=? and object_id=? and key_id=? and result_id=? and model_id=?\", $EventId, $ObjectType, $ObjectId, $key_id, $ResultId, $ModelId).Order(\"num_submitted desc\").One(\"num_submitted\")) + 1\r\n        $models = DBFind(\"business_models\").Order(\"event_id\").Where(\"deleted='0' and model_id=?\", $ModelId)\r\n\r\n        var currentModel map\r\n        currentModel = DBFind(\"business_models\").Where(\"deleted='0' and id=?\", $Id).Row()\r\n        if !currentModel{\r\n            error \"Business model not found\"\r\n        }\r\n        if $resultStr == \"Submit\" || $resultStr == \"Send Back\"{\r\n            if currentModel[\"need_comment\"] == 1 && Size($Comment) < 1 {\r\n                warning \"Need comment\"\r\n            }\r\n        }\r\n        $NotificId = Int($NotificId)\r\n    }\r\n    action {\r\n        DBInsert(\"business_events\", \"event_id,object_type,object_id,key_id,result_id,comment,num_submitted,created_at,model_id\", $EventId, $ObjectType, $ObjectId, $key_id, $ResultId, $Comment, $numSubmitted, \"Now()\", $ModelId)\r\n        updateObject()\r\n        sendNext(getNextModel())\r\n        closeNotify()\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "languages",
            "Name": "Condition",
            "Conditions": "",
            "Trans": "{\"en\": \"Condition\", \"ru\": \"Условие\", \"ar\": \"شرط\"}"
        },
        {
            "Type": "languages",
            "Name": "EventId",
            "Conditions": "",
            "Trans": "{\"en\": \"Event ID\", \"ru\": \"Идентификатор События\", \"ar\": \"معرف الحدث\"}"
        },
        {
            "Type": "languages",
            "Name": "NeedComment",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Need comment from user\",\n    \"ar\": \"بحاجة الى تعليق من المستخدم\",\n    \"ru\": \"Нужен комментарий от пользователя\"\n}"
        },
        {
            "Type": "languages",
            "Name": "ObjectType",
            "Conditions": "",
            "Trans": "{\"en\": \"Object Type\", \"ru\": \"Тип Объекта\", \"ar\": \"نوع الكائن\"}"
        },
        {
            "Type": "languages",
            "Name": "Result",
            "Conditions": "",
            "Trans": "{\"en\": \"Result\", \"ru\": \"Результат\", \"ar\": \"نتيجة\"}"
        },
        {
            "Type": "languages",
            "Name": "RoleId",
            "Conditions": "",
            "Trans": "{\"en\": \"Role ID\", \"ru\": \"Идентификатор роли\", \"ar\": \"معرف الدور\"}"
        },
        {
            "Type": "languages",
            "Name": "TextBody",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Text Body\",\n    \"ar\": \"نص النص\",\n    \"ru\": \"Текст\"\n}"
        },
        {
            "Type": "languages",
            "Name": "Title",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Title\",\n    \"ar\": \"عنوان\",\n    \"ru\": \"Название\"\n}"
        },
        {
            "Type": "languages",
            "Name": "actived",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Activated\",\n    \"ru\": \"Активированые\",\n    \"ar\": \"نشيط\"\n}"
        },
        {
            "Type": "languages",
            "Name": "business_manager",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Business Process Manager\",\n    \"ar\": \"مدير العمليات التجارية\",\n    \"ru\": \"Менеджер Бизнес-Процессов\"\n}"
        },
        {
            "Type": "languages",
            "Name": "model",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Model\",\n    \"ar\": \"نموذج\",\n    \"ru\": \"Модель\"\n}"
        },
        {
            "Type": "languages",
            "Name": "business_process",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Business process\",\n    \"ar\": \"طريقة العمل\"\n}"
        },
        {
            "Type": "languages",
            "Name": "ObjectId",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Object ID\",\n    \"ru\": \"Идентификатор объекта\",\n    \"ar\": \"معرف الكائن\"\n}"
        },
        {
            "Type": "languages",
            "Name": "num_submitted",
            "Conditions": "",
            "Trans": "{\"en\": \"Amount of attempts\", \"ru\": \"Идентификатор роли\", \"ar\": \"مقدار المحاولات\"}"
        },
        {
            "Type": "languages",
            "Name": "wallet",
            "Conditions": "",
            "Trans": "{\n    \"en\": \"Wallet\",\n    \"ru\": \"Кошелек\",\n    \"ar\": \"محفظة نقود\"\n}"
        },
        {
            "Type": "menu",
            "Name": "default_menu",
            "Value": "Div(ajnav){\r\n    If(#role_id# == 0){\r\n        MenuItem(Title:Registration, Page: ajman_user_registration, Icon:\"fa icon-user\")\r\n    }.ElseIf(Or(#role_id# == 16,#role_id# == 18)){\r\n\t\tDiv(col text-center){\r\n\t\t\tDiv(col-md-12){\r\n\t\t\t\tDBFind(\"members\").Columns(\"id,member_name\").WhereId(#key_id#).Vars(pre)\r\n\t\t\t\tImage(Binary().ById(20), Class: img-thumbnail img-circle img-responsive thumb96)\r\n\t\t\t\tDiv(col-md-12 ajman-color-h1){\r\n\t\t\t\t\tSpan(Body:#pre_member_name#)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tDiv(col pd-top-50){\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Contracts\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"All Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"My Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=my\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Signed contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                        }\r\n                    }\r\n                }\r\n\t\t\t}\r\n\t\t}.Style(height: 100vh; background-color: #323639)\r\n    }.ElseIf(Or(#role_id# == 14,#role_id# == 15)){\r\n\t\tDiv(col text-center pd-top-50){\r\n\t\t\tDiv(col-md-12){\r\n\t\t\t\tDBFind(\"members\").Columns(\"id,member_name\").WhereId(#key_id#).Vars(pre)\r\n\t\t\t\tImage(Binary().ById(20), Class: img-thumbnail img-circle img-responsive thumb96)\r\n\t\t\t\tDiv(col-md-12 ajman-color-h1){\r\n\t\t\t\t\tSpan(Body:#pre_member_name#)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tDiv(col pd-top-50){\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Contracts\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"All Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"My Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=my\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Signed contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                        }\r\n                    }\r\n                }\r\n\t\t\t}\r\n\t\t}.Style(height: 100vh; background-color: #323639)\r\n    }.ElseIf(Or(#role_id# == 19,#role_id# == 21)){\r\n\t\tDiv(col text-center pd-top-50){\r\n\t\t\tDiv(col-md-12){\r\n\t\t\t\tDBFind(\"members\").Columns(\"id,member_name\").WhereId(#key_id#).Vars(pre)\r\n\t\t\t\tImage(Binary().ById(20), Class: img-thumbnail img-circle img-responsive thumb96)\r\n\t\t\t\tDiv(col-md-12 ajman-color-h1){\r\n\t\t\t\t\tSpan(Body:#pre_member_name#)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tDiv(col pd-top-50){\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Contracts\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"All Contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Signed contracts\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title: \"Managment control\", Icon: \"icon-folder\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$profile$, Page:profile_view, Icon:\"fa icon-user\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$membership$, Page:members_list, Icon:\"fa icon-people\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuGroup(Title:$notifications$, Icon:\"fa fa-bell-o\"){\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$single_notifics$, Page:notifications_single, Icon:\"fa fa-bell-o\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$role_notifics$, Page:notifications_roles, Icon:\"fa fa-bullhorn\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$test_page$, Page:notifications_testpage, Icon:\"icon-settings\")\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$roles$, Page:roles_list, Icon:\"fa fa-list-ul\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title: $catalog_ecosystems$, Page: catalog_ecosystems, Icon:\"fa fa-book\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuGroup(Title:$admin$, Icon:\"fa icon-settings\"){\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$tokens_transfer$, Page:money_transfer, Icon:\"icon-energy\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$new_ecosystem$, Page:ecosystem_new, Icon:\"icon-globe\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title: $sysparams_list$,Page:sysparams_list, Icon:\"fa icon-settings\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$sysparams_candidates$, Page:sysparams_candidates, Icon:\"icon-list\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$sysparams_ecos$, Page:sysparams_ecos, Icon:\"icon-list\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$tokenrefund_list$, Page:tokenrefund_list, Icon:\"icon-list\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$tokens_transfer$, Page:tokens_transfer, Icon:\"icon-credit-card\")\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuGroup(Title:$voting$, Icon:\"fa fa-edit\"){\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$voting$, Page:voting_list, Icon:\"fa fa-edit\")\r\n                                }\r\n                                Div(ajnav){\r\n                                    MenuItem(Title:$voting_templates$, Page:voting_templates, Icon:\"fa icon-pin\")\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\t\t\t}\r\n\t\t}.Style(height: 100vh; background-color: #323639)\r\n\t}.ElseIf(#role_id# == 22){\r\n    }.Else{\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Basic\", Icon: \"icon-folder\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:$profile$, Page:profile_view, Icon:\"fa icon-user\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:$membership$, Page:members_list, Icon:\"fa icon-people\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title:$notifications$, Icon:\"fa fa-bell-o\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$single_notifics$, Page:notifications_single, Icon:\"fa fa-bell-o\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$role_notifics$, Page:notifications_roles, Icon:\"fa fa-bullhorn\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$test_page$, Page:notifications_testpage, Icon:\"icon-settings\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:$roles$, Page:roles_list, Icon:\"fa fa-list-ul\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title: $catalog_ecosystems$, Page: catalog_ecosystems, Icon:\"fa fa-book\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title:$admin$, Icon:\"fa icon-settings\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$tokens_transfer$, Page:money_transfer, Icon:\"icon-energy\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$new_ecosystem$, Page:ecosystem_new, Icon:\"icon-globe\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title: $sysparams_list$,Page:sysparams_list, Icon:\"fa icon-settings\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$sysparams_candidates$, Page:sysparams_candidates, Icon:\"icon-list\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$sysparams_ecos$, Page:sysparams_ecos, Icon:\"icon-list\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$tokenrefund_list$, Page:tokenrefund_list, Icon:\"icon-list\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$tokens_transfer$, Page:tokens_transfer, Icon:\"icon-credit-card\")\r\n                        }\r\n                    }\r\n                }\r\n                Div(ajnav){\r\n                    MenuGroup(Title:$voting$, Icon:\"fa fa-edit\"){\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$voting$, Page:voting_list, Icon:\"fa fa-edit\")\r\n                        }\r\n                        Div(ajnav){\r\n                            MenuItem(Title:$voting_templates$, Page:voting_templates, Icon:\"fa icon-pin\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Договоры\", Icon: \"icon-folder\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Все договоры\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=all\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Мои договоры\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=my\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Подписанные договоры\", Page:ajman_contract_list, Icon:\"icon-layers\", Params: \"mode=signed\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Арендовать Property\", Page:ajman_contract_add, Icon:\"fa fa-edit\", Params: \"property_id=2,unit_id=0,owner_id=7207124132448258015\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Арендовать Unit\", Page:ajman_contract_add, Icon:\"fa fa-edit\", Params: \"property_id=2,unit_id=1,owner_id=7207124132448258015\")\r\n                }\r\n            }\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:$business_manager$, Page:business_manager, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:$business_process$, Page:business_process, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:$ajman_user_registration$, Page:ajman_user_registration, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:\"Ajman_companies\", Page:Ajman_companies, Icon:\"icon-layers\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:\"Ajman_persones\", Page:Ajman_persones, Icon:\"icon-layers\")\r\n        }\r\n        Div(ajnav){\r\n            MenuItem(Title:\"Ajman Roles\", Page:ajamal_enter_user_role, Icon:\"fa fa-edit\")\r\n        }\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Property & Units\", Icon: \"icon-folder\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Add Property\", Page:property_add, Icon:\"icon-folder\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Properties list\", Page:property_list, Icon:\"icon-folder\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Add Unit\", Page:units_add, Icon:\"icon-folder\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:\"Units list\", Page:units_list, Icon:\"icon-folder\")\r\n                }\r\n            }\r\n        }\r\n        Div(ajnav){\r\n            MenuGroup(Title: \"Layout\", Icon: \"icon-layers\"){\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_1, Page:aj_1, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_2, Page:aj_2, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_3, Page:aj_3, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_4, Page:aj_4, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_5, Page:aj_5, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:aj_new, Page:aj_new, Icon:\"fa fa-edit\")\r\n                }\r\n                Div(ajnav){\r\n                    MenuItem(Title:Table_Bled Page:Table_blead, Icon:\"fa fa-edit\")\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Title": "default",
            "Conditions": "ContractAccess(\"@1EditMenu\")"
        },
        {
            "Type": "pages",
            "Name": "business_manager",
            "Value": "DBFind(applications).Where(\"name='Business'\").Vars(application)\r\nIf(#Mode#==deleted){\r\n    SetVar(Where,\"deleted='1'\").(panel,\"panel-warning\")\r\n}.Else{\r\n    SetVar(Where,\"deleted='0'\").(Mode,actived)\r\n}\r\nIf(GetVar(mid)){\r\n    If(#mid#==All){}.Else{\r\n        SetVar(Where,#Where# and model_id=#mid#)\r\n    }\r\n}\r\n\r\nDBFind(roles, src_roles).Columns(\"id,role_name\")\r\nDBFind(business_models, src_models).Where(#Where#).Order(\"model_id,event_id\").Limit(250).Custom(_actions){\r\n    Div(text-right btn-group){\r\n        Button(Class: icon-settings link ajman_text_blue, Page: business_model, PageParams: \"Id=#id#,Mode=#Mode#\")\r\n        If(#deleted#==1){\r\n            Button(Class: fa fa-undo link ajman_text_blue, Page: business_manager, Contract: business_Manager,Params: \"Id=#id#,Action=restore\", PageParams: \"Mode=#Mode#\")\r\n        }.Else{\r\n            Button(Class: icon-trash link ajman_text_red, Page: business_manager, Contract: business_Manager,Params: \"Id=#id#,Action=delete\", PageParams: \"Mode=#Mode#\")\r\n            Button(Class: icon-control-play link ajman_text_darkgreen, Page: business_model, PageParams: \"Id=#id#,Mode=play\")\r\n        }\r\n    }.Style(display:flex; .link {\r\n        border: none;\r\n        background-color: transparent;\r\n        padding: 6px 12px;\r\n        border-radius: 5px;\r\n    }\r\n    .link:hover {\r\n        box-shadow: 0 3px 5px gray;\r\n    }\r\n    .link:active {\r\n        box-shadow: 0 0 5px gray;\r\n    })\r\n}.Custom(_obj){\r\n    \"AppParam(App: #application_id#, Name: object_types, Index: #object_type#)(#object_type#)\"\r\n}.Custom(_role){\r\n    ForList(src_roles){\r\n        If(#role_id#==#id#){\r\n            #role_name#\r\n        }\r\n    }\r\n}.Custom(_cond){\r\n    Div(){#condition_pretty#}.Style(min-width:150px; word-break: break-word;)\r\n}.Custom(_res){\r\n    Div(){#result_pretty#}.Style(min-width:150px; word-break: break-word;)\r\n}.Custom(_com){\r\n    Div(){\r\n        If(#need_comment#==1){\r\n            $yes$\r\n        }\r\n    }.Style(max-width:50px;)\r\n}.Custom(_text){\r\n    Strong(#title#)\r\n    Div(){\r\n        #text_body#\r\n    }.Style(min-width:150px; word-break: break-word;)\r\n}\r\nSetVar(has_models,0)\r\nForList(src_models){\r\n    SetVar(has_models,1)\r\n}\r\nDiv(fullscreen-wrapper ajman_content){\r\n    Div(row){\r\n        Div(col-md-6 pull-left){Image(Binary().ById(18), Class: pull-left)}\r\n        Div(col-md-6 pull-right){Image(Binary().ById(19), Class: pull-right)}\r\n    }.Style(padding-bottom: 10px;)\r\n    Div(row){\r\n        Div(col-md-12){\r\n            Div(Class: panel-heading text-center){\r\n                Span(Class: ajman-color-h1, Body: $business_manager$: LangRes(#Mode#))\r\n            }\r\n        }.Style(height: 50px; background-color: #0f789c)\r\n        Div(col-sm-12 content){\r\n            Div(content-wrapper){\r\n                Div(row){\r\n                    Div(col-sm-12){\r\n                        Div(text-right form-group){\r\n                            Data(model_range, \"id\"){\r\n                                All\r\n                                1\r\n                                2\r\n                                3\r\n                                4\r\n                            }\r\n                            Form(input-group pull-left col-sm-3){\r\n                                Label(For:mid, Class: input-group-addon){Model ID}\r\n                                Select(Source: model_range, Name: mid, NameColumn: id, ValueColumn: id)\r\n                                Div(input-group-btn){\r\n                                    Button(Class: btn btn-default fa fa-check, Page: business_manager, PageParams: \"Mode=#Mode#,mid=Val(mid)\")\r\n                                }\r\n                            }.Style(width:250px;)\r\n                            If(#Mode#==deleted){\r\n                                LinkPage(Page: business_manager, PageParams: \"Mode=actived\", Body: $show_actived$)\r\n                            }.Else{\r\n                                LinkPage(Page: business_manager, PageParams: \"Mode=deleted\", Body: $show_deleted$).Style(margin-right:15px;)\r\n                                Button(Page: business_model, Class: btn ajman_button_darkgreen, Body: $create$)\r\n                            }\r\n                        }\r\n                        Div(panel){\r\n                            Div(panel-body){\r\n                                If(#has_models#==1){\r\n                                    Div(table-responsive){\r\n                                        Table(src_models,\"$ModelId$=model_id,$EventId$=event_id,$ObjectType$=_obj,$RoleId$=_role,$NeedComment$=_com,$Condition$=_cond,$Result$=_res,$text$=_text,=_actions\")\r\n                                    }\r\n                                }.Else{\r\n                                    Div(h3 text-center){\r\n                                        LangRes(#Mode#) $models_not_found$\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}.Style(background-color: #f7f7f7)",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "business_model",
            "Value": "DBFind(applications).Where(\"name='Business'\").Vars(application)\r\nAppParam(App: #application_id#, Name: object_types, Source: src_objects)\r\nData(app_results, \"id,name\"){\r\n    1,Submit\r\n    2,Send Back\r\n    3,Accept\r\n    4,Escalation\r\n    5,Reject\r\n    6,Inform\r\n    7,Pay\r\n}\r\n\r\nSetVar(result_col_class,col-sm-3)\r\nIf(#Mode#==\"play\"){\r\n    If(#Id#>0){\r\n        DBFind(Name:business_models, src_models).Where(\"id=#Id#\").Vars(model)\r\n        SetVar(heading,\"$business_manager$: $model$ $info$ ##Id#\")\r\n        JsonToSource(src_results,#model_result#).(src_condition,#model_condition#)\r\n        DBFind(roles).Where(\"deleted=0 and id=#model_role_id#\").Columns(\"id,role_name\").Vars(role)\r\n        Data(forms, \"Name,Type,Value,Src\"){\r\n            EventId,text,#model_event_id#,\r\n            ObjectType,select,#model_object_type#,src_objects\r\n            ModelId,text,#model_model_id#,\r\n            ObjectId,number,,\r\n            RoleId,text,#role_role_name#,\r\n            Title,text,#model_title#,\r\n            TextBody,text,#model_text_body#,\r\n            NeedComment,checkbox,#model_need_comment#,\r\n            Comment,textarea,#model_need_comment#,\r\n            Result,result,,src_results\r\n            Conditions,condition,,src_condition\r\n        }\r\n        Div(fullscreen-wrapper ajman_content){\r\n            Div(row){\r\n                Div(col-md-6 pull-left){Image(Binary().ById(18), Class: pull-left)}\r\n                Div(col-md-6 pull-right){Image(Binary().ById(19), Class: pull-right)}\r\n            }.Style(padding-bottom: 10px;)\r\n            Div(row){\r\n                Div(col-md-12 form-group){\r\n                    Div(Class: panel-heading text-center){\r\n                        Span(Class: ajman-color-h1, Body: #heading#)\r\n                    }\r\n                }.Style(height: 50px; background-color: #0f789c)\r\n\r\n                Div(col-sm-12 content){\r\n                    Form(){\r\n                        Div(){\r\n                            ForList(forms){\r\n                                Div(row form-group){\r\n                                    Div(col-sm-4 text-right){\r\n                                        Strong(LangRes(#Name#))\r\n                                    }\r\n                                    Div(col-sm-8){\r\n                                        If(#Type#==condition){\r\n                                            ForList(#Src#){\r\n                                                Div(col-sm-3){\r\n                                                    #key#:AppParam(App: #application_id#, Name: results, Index: #value#)\r\n                                                }\r\n                                            }\r\n                                        }.ElseIf(#Type#==result){\r\n                                            ForList(#Src#){\r\n                                                If(#value#==1){\r\n                                                    Div(#result_col_class#){#key#}\r\n                                                }\r\n                                            }\r\n                                        }.ElseIf(#Type#==select){\r\n                                            ForList(#Src#){\r\n                                                If(#id#==#Value#){\r\n                                                    #name#\r\n                                                }\r\n                                            }\r\n                                        }.ElseIf(#Type#==checkbox){\r\n                                            If(#Value#==1){\r\n                                                SetVar(bool,true)\r\n                                            }.Else{\r\n                                                SetVar(bool,false)\r\n                                            }\r\n                                            Input(Name: #Name#, Type:#Type#, Value: #bool#, Disabled: 1)\r\n                                        }.ElseIf(#Type#==number){\r\n                                            Input(Name:#Name#, Type:#Type#)\r\n                                        }.ElseIf(#Type#==textarea){\r\n                                            If(#Value#==1){\r\n                                                Input(Name:#Name#, Type:#Type#)\r\n                                            }.Else{\r\n                                                Input(Name:#Name#, Type:hidden)\r\n                                            }\r\n                                        }.Else{\r\n                                            #Value#\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(panel-footer text-right){\r\n                            Input(Name:Id, Type: hidden, Value:#Id#)\r\n                            Input(Name:ModelId, Type:hidden, Value:#model_model_id#)\r\n                            Input(Name:EventId, Type:hidden, Value:#model_event_id#)\r\n                            Input(Name:ObjectType, Type:hidden, Value:#model_object_type#)\r\n                            Input(Name:NotificId, Type:hidden)\r\n                            Div(pull-left){\r\n                                Button(Class: btn ajman_button_green_medium, Page: business_manager, Body: $back$)\r\n                            }\r\n                            Div(){\r\n                                ForList(src_results){\r\n                                    ForList(app_results){\r\n                                        If(And(#name#==#key#,#value#==1)){\r\n                                            If(#key#==Submit){\r\n                                                SetVar(business_class,ajman_button_darkgreen_medium)\r\n                                            }.ElseIf(#key#==Accept){\r\n                                                SetVar(business_class,ajman_button_darkgreen_large)\r\n                                            }.ElseIf(#key#==Reject){\r\n                                                SetVar(business_class,ajman_button_red_large)\r\n                                            }.Else{\r\n                                                SetVar(business_class,ajman_button_blue_medium)\r\n                                            }\r\n                                            Button(Body:#key#, Class: btn #business_class#, Page: business_process, Contract: business_Process, Params:\"ResultId=#id#\")\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }.Style(div {display:inline-block;})\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }.Style(background-color: #f7f7f7)\r\n    }.Else{\r\n        Div(md-12 alert alert-danger text-center){\r\n            Span(Body: LangRes(attention))\r\n        }\r\n    }\r\n}.Else{\r\n    DBFind(Name:roles, Source: src_roles).Where(\"deleted=0\").Order(id).Columns(\"id,role_name\").Custom(name){#role_name#}\r\n    If(#Id#>0){\r\n        DBFind(Name:business_models, src_models).Where(\"id=#Id#\").Vars(model)\r\n        SetVar(Action, update).(heading,\"$business_manager$: $model$ $edit$ ##Id#\")\r\n        JsonToSource(src_results,#model_result#).(src_condition,#model_condition#)\r\n        Data(forms, \"Name,Type,Src,Value\"){\r\n            EventId,number,,#model_event_id#\r\n            ModelId,number,,#model_model_id#\r\n            ObjectType,select,src_objects,#model_object_type#\r\n            Title,text,,#model_title#\r\n            RoleId,select,src_roles,#model_role_id#\r\n            TextBody,textarea,,#model_text_body#\r\n            NeedComment,checkbox,,#model_need_comment#\r\n            Result,result,src_results,\r\n        }\r\n    }.Else{\r\n        SetVar(Id,0).(Action,create).(heading,\"$business_manager$: $create$\")\r\n        Data(forms, \"Name,Type,Src\"){\r\n            EventId,number,\r\n            ModelId,number,\r\n            ObjectType,select,src_objects\r\n            Title,text,\r\n            RoleId,select,src_roles\r\n            TextBody,textarea,\r\n            NeedComment,checkbox,\r\n            Result,result,app_results\r\n        }\r\n        SetVar(Value,)\r\n    }\r\n    If(#condition_count#>0){}.Else{\r\n        If(#Id#>0){\r\n            SetVar(condition_count,0).(min_count,0)\r\n        }.Else{\r\n            SetVar(condition_count,1).(min_count,1)\r\n        }\r\n    }\r\n    Div(fullscreen-wrapper ajman_content){\r\n        Div(row){\r\n            Div(col-md-6 pull-left){Image(Binary().ById(18), Class: pull-left)}\r\n            Div(col-md-6 pull-right){Image(Binary().ById(19), Class: pull-right)}\r\n        }.Style(padding-bottom: 10px;)\r\n        Div(row){\r\n            Div(col-md-12 form-group){\r\n                Div(Class: panel-heading text-center){\r\n                    Span(Class: ajman-color-h1, Body: #heading#)\r\n                }\r\n            }.Style(height: 50px; background-color: #0f789c)\r\n\r\n            Div(col-sm-12 content){\r\n                Div(row){\r\n                    Div(col-sm-10 col-sm-offset-1){\r\n                        Form(){\r\n                            Div(){\r\n                                ForList(forms){\r\n                                    Div(row form-group){\r\n                                        Div(col-sm-3 text-right pt-sm){\r\n                                            Label(For:#Name#){LangRes(#Name#)}\r\n                                        }\r\n                                        Div(col-sm-9){\r\n                                            If(#Type#==result){\r\n                                                Div(row){\r\n                                                    ForList(#Src#){\r\n                                                        Div(#result_col_class#){\r\n                                                            If(#Id#>0){\r\n                                                                If(#value#==1){\r\n                                                                    SetVar(bool,true)\r\n                                                                }.Else{\r\n                                                                    SetVar(bool,false)\r\n                                                                }\r\n                                                                If(#key#==\"Send Back\"){\r\n                                                                    Input(Name: SentBack, Type:checkbox, Value: #bool#) #key#\r\n                                                                }.Else{\r\n                                                                    Input(Name: #key#, Type:checkbox, Value: #bool#) #key#\r\n                                                                }\r\n                                                            }.Else{\r\n                                                                If(#key#==\"Send Back\"){\r\n                                                                    Input(Name: SentBack, Type:checkbox) #name#\r\n                                                                }.Else{\r\n                                                                    Input(Name: #name#, Type:checkbox) #name#\r\n                                                                }\r\n                                                            }\r\n                                                        }.Style(div {display:inline-block;})\r\n                                                    }\r\n                                                }\r\n                                            }.ElseIf(#Type#==select){\r\n                                                Select(Name: #Name#, Source:#Src#, NameColumn: name, ValueColumn: id, Value:#Value#)\r\n                                            }.ElseIf(#Type#==checkbox){\r\n                                                If(#Value#==1){\r\n                                                    SetVar(bool,true)\r\n                                                }.Else{\r\n                                                    SetVar(bool,false)\r\n                                                }\r\n                                                Input(Name: #Name#, Type:#Type#, Value: #bool#)\r\n                                            }.Else{\r\n                                                Input(Name: #Name#, Type:#Type#, Value: #Value#)\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                                Div(row form-group){\r\n                                    Div(col-sm-3 text-right pt-sm){\r\n                                        Label(For:Condition){LangRes(Conditions)}\r\n                                        Div(row){\r\n                                            Div(col-sm-12 text-right){\r\n                                                SetVar(condition_plus,Calculate(#condition_count#+1)).(condition_minus,Calculate(#condition_count#-1))\r\n                                                If(#condition_count#>#min_count#){\r\n                                                    Button(Page:business_model, PageParams:\"Mode=#Mode#,condition_count=#condition_minus#,Id=#Id#\", Class: btn btn-default fa fa-minus)\r\n                                                }\r\n                                                Button(Page:business_model, PageParams:\"Mode=#Mode#,condition_count=#condition_plus#,Id=#Id#\", Class: btn btn-default fa fa-plus)\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    Div(col-sm-9){\r\n                                        If(#Id#>0){\r\n                                            ForList(src_condition){\r\n                                                Div(list-group-item){\r\n                                                    Div(row form-group){\r\n                                                        Div(col-sm-3 text-right pt-sm){\r\n                                                            LangRes(EventId)\r\n                                                        }\r\n                                                        Div(col-sm-7){\r\n                                                            Input(Name: ConditionEventId, Value: #key#, Type:number)\r\n                                                        }\r\n                                                        Div(col-sm-2){\r\n                                                            Input(Name: ConditionDelete, Type:checkbox)\r\n                                                            Div(icon-trash text-danger)\r\n                                                        }.Style(div {display:inline-block;})\r\n                                                    }\r\n                                                    Div(row){\r\n                                                        Div(col-sm-3 text-right pt-sm){\r\n                                                            LangRes(Condition)\r\n                                                        }\r\n                                                        Div(col-sm-7){\r\n                                                            Select(Name:ConditionResult, NameColumn:name, ValueColumn:id, Source: app_results, Value:#value#)\r\n                                                        }\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                        Range(Source:condition_range,From:0,To:#condition_count#)\r\n                                        ForList(condition_range){\r\n                                            Div(list-group-item){\r\n                                                Div(row form-group){\r\n                                                    Div(col-sm-3 text-right pt-sm){\r\n                                                        LangRes(EventId)\r\n                                                    }\r\n                                                    Div(col-sm-7){\r\n                                                        Input(Name: ConditionEventId, Type:number)\r\n                                                    }\r\n                                                }\r\n                                                Div(row){\r\n                                                    Div(col-sm-3 text-right pt-sm){\r\n                                                        LangRes(Condition)\r\n                                                    }\r\n                                                    Div(col-sm-7){\r\n                                                        Select(Name:ConditionResult, NameColumn:name, ValueColumn:id, Source: app_results)\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            Div(text-right){\r\n                                Div(btn-group pull-left){\r\n                                    Button(Class: btn ajman_button_green_medium, Page: business_manager, PageParams: \"Mode=#Mode#\", Body: $back$)\r\n                                }\r\n                                Input(Name:Action, Value:#Action#, Type: hidden)\r\n                                Input(Name:Id, Value:#Id#, Type: hidden)\r\n                                Div(btn-group){\r\n                                    If(#Action#==update){\r\n                                        SetVar(hidden,)\r\n                                    }.Else{\r\n                                        SetVar(hidden,hidden)\r\n                                    }\r\n                                    Button(Class: btn ajman_button_blue_medium #hidden#, Contract: business_Manager, Params: \"Id=0,Action=create\", Page: business_model, PageParams: \"Id=#Id#,Mode=#Mode#\", Body: $copy$)\r\n                                    Button(Body:LangRes(#Action#), Class: btn ajman_button_darkgreen_large, Page: business_manager, PageParams: \"Mode=#Mode#\", Contract: business_Manager)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }.Style(background-color: #f7f7f7)\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "business_object",
            "Value": "DBFind(applications).Where(\"name='Business'\").Vars(application)",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Menu": "default_menu"
        },
        {
            "Type": "pages",
            "Name": "business_process",
            "Value": "DBFind(applications).Where(\"name='Business'\").Vars(business_app)\r\nIf(#notific_id#>0){\r\n    DBFind(notifications).WhereId(#notific_id#).Columns(\"page_params->object_id,page_params->id,page_params->comment\").Vars(note)\r\n    SetVar(business_model_id,#note_page_params_id#).(business_object_id,#note_page_params_object_id#).(comment,#note_page_params_comment#)\r\n}\r\nAppParam(App: #business_app_id#, Name: object_blocks, Source: app_blocks)\r\nData(app_results, \"id,name\"){\r\n    1,Submit\r\n    2,Send Back\r\n    3,Accept\r\n    4,Escalation\r\n    5,Reject\r\n    6,Inform\r\n    7,Pay\r\n}\r\nDiv(content-wrapper ajman_content){\r\n    Div(row){\r\n        Div(col-md-6 pull-left){Image(Binary().ById(18), Class: pull-left)}\r\n        Div(col-md-6 pull-right){Image(Binary().ById(19), Class: pull-right)}\r\n    }.Style(padding-bottom: 10px;)\r\n\r\n    If(And(#business_model_id#>0, #business_object_id#>0)){\r\n        DBFind(business_models).Where(\"id=#business_model_id#\").Vars(business_model)\r\n        JsonToSource(business_model_results,#business_model_result#)\r\n        DBFind(roles).Where(\"deleted=0 and id=#business_model_role_id#\").Columns(\"id,role_name\").Vars(business_role)\r\n        SetVar(business_object,\"AppParam(App: #business_app_id#, Name: object_types, Index: #business_model_object_type#)\")\r\n        Div(row){\r\n            Div(col-sm-12 form-group text-center pt-sm){\r\n                Span(#business_model_title# : #business_object# : #business_object_id#, ajman-color-h1)\r\n            }.Style(height: 50px; background-color: #0f789c!important;)\r\n        }\r\n        Form(container){\r\n            Div(form-group){\r\n                Div(row form-group){\r\n                    Div(col-sm-12){\r\n                        #business_model_text_body#\r\n                    }\r\n                }\r\n\r\n                If(#comment#!=\"\"){\r\n                    Div(row form-group){\r\n                        Div(col-sm-12){#comment#}\r\n                    }\r\n                }\r\n\r\n                ForList(app_blocks){\r\n                    If(#id#==#business_model_object_type#){\r\n                        SetVar(id,#business_object_id#)\r\n                        Include(#name#)\r\n                    }\r\n                }\r\n\r\n                If(#business_model_need_comment#==1){\r\n                    Div(row form-group){\r\n                        Div(col-md-2 text-right){\r\n                            Label(For:Comment){LangRes(Comment)}\r\n                        }\r\n                        Div(col-sm-10){\r\n                            Input(Name:Comment, Type:textarea)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(row){\r\n                If(#notific_id#>0){\r\n                    Input(Name:Id, Type:hidden, Value:#business_model_id#)\r\n                    Input(Name:ModelId, Type:hidden, Value:#business_model_model_id#)\r\n                    Input(Name:ObjectId, Type:hidden, Value:#business_object_id#)\r\n                    Input(Name:EventId, Type:hidden, Value:#business_model_event_id#)\r\n                    Input(Name:ObjectType, Type:hidden, Value:#business_model_object_type#)\r\n                    Input(Name:NotificId, Type:hidden, Value:#notific_id#)\r\n                    Div(col-sm-12 text-right){\r\n                        ForList(app_results){\r\n                            ForList(business_model_results){\r\n                                If(And(#name#==#key#,#value#==1)){\r\n                                    If(#key#==Submit){\r\n                                        SetVar(business_class,ajman_button_darkgreen_medium)\r\n                                    }.ElseIf(#key#==Accept){\r\n                                        SetVar(business_class,ajman_button_darkgreen_large)\r\n                                    }.ElseIf(#key#==Reject){\r\n                                        SetVar(business_class,ajman_button_red_large)\r\n                                    }.Else{\r\n                                        SetVar(business_class,ajman_button_blue_medium)\r\n                                    }\r\n                                    Button(Body:#key#, Class: btn #business_class#, Page: default_page, Contract: business_Process, Params:\"ResultId=#id#\")\r\n                                }\r\n                            }\r\n                        }\r\n                    }.Style(div {display:inline-block;})\r\n                }.Else{\r\n                    Div(text-warning){\r\n                        Notification not found. Action impossible\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }.Else{\r\n        AppParam(App: #business_app_id#, Name: object_types, Source: app_objects)\r\n        AppParam(App: #business_app_id#, Name: results, Source: app_results)\r\n        DBFind(business_events,src_events).Order(\"id desc\").Custom(_obj){\r\n            ForList(app_objects){\r\n                If(#id#==#object_type#){\r\n                    #name# (#object_type#)\r\n                }\r\n            }\r\n        }.Custom(_res){\r\n            ForList(app_results){\r\n                If(#id#==#result_id#){\r\n                    #name#\r\n                }\r\n            }\r\n        }\r\n        Form(row){\r\n            Div(col-sm-12 form-group text-center){\r\n                Span($business_events$, ajman-color-h1)\r\n            }.Style(height: 50px; background-color: #0f789c!important;)\r\n            Div(col-sm-12){\r\n                Table(src_events, \"$ModelId$=model_id,$EventId$=event_id,$object$=_obj,$ObjectId$=object_id,$wallet$=key_id,$result$=_res,$comment$=comment,$num_submitted$=num_submitted,$created$=created_at\")\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Menu": "default_menu"
        },
        {
            "Type": "app_params",
            "Name": "object_types",
            "Value": "Property,Unit,Residential Contract,Commercial Contract, Рayment",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "app_params",
            "Name": "results",
            "Value": "Submit,Send Back,Accept,Escalation,Reject,Inform,Pay",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "app_params",
            "Name": "class_results",
            "Value": "btn-primary,btn-info,btn-success,btn-warning,btn-danger,btn-info,btn-primary",
            "Conditions": "true"
        },
        {
            "Type": "app_params",
            "Name": "object_blocks",
            "Value": "property_block,units_block,ajman_contract,ajman_contract, payment_block",
            "Conditions": "true"
        },
        {
            "Type": "app_params",
            "Name": "object_status_tables",
            "Value": "properties,units,property_contracts,property_contracts,property_contracts",
            "Conditions": "true"
        },
        {
            "Type": "app_params",
            "Name": "manager_role_ids",
            "Value": "17,19",
            "Conditions": "true"
        },
        {
            "Type": "app_params",
            "Name": "owner_role_id",
            "Value": "20",
            "Conditions": "true"
        },
        {
            "Type": "tables",
            "Name": "business_conditions",
            "Columns": "[{\"name\":\"accept\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"inform\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"reject\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"submit\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"deleted\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"event_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"sent_back\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"escalation\",\"type\":\"character\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"true\", \"update\": \"true\", \"new_column\": \"true\"}"
        },
        {
            "Type": "tables",
            "Name": "business_events",
            "Columns": "[{\"name\":\"key_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"object\",\"type\":\"varchar\",\"conditions\":\"true\"},{\"name\":\"comment\",\"type\":\"text\",\"conditions\":\"true\"},{\"name\":\"event_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"model_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"object_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"result_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"created_at\",\"type\":\"datetime\",\"conditions\":\"true\"},{\"name\":\"object_type\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"num_submitted\",\"type\":\"number\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"true\", \"update\": \"true\", \"new_column\": \"true\"}"
        },
        {
            "Type": "tables",
            "Name": "business_models",
            "Columns": "[{\"name\":\"title\",\"type\":\"varchar\",\"conditions\":\"true\"},{\"name\":\"result\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"deleted\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"role_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"event_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"model_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"condition\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"text_body\",\"type\":\"text\",\"conditions\":\"true\"},{\"name\":\"object_type\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"need_comment\",\"type\":\"character\",\"conditions\":\"true\"},{\"name\":\"result_pretty\",\"type\":\"varchar\",\"conditions\":\"true\"},{\"name\":\"condition_pretty\",\"type\":\"varchar\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"true\", \"update\": \"true\", \"new_column\": \"true\"}"
        }
    ]
}