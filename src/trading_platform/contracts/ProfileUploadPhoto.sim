contract ProfileUploadPhoto {
    data {
        Photo bytes "file"
    }
    conditions {}

    action {
        var appId imageId int image map
        appId = Int(DBFind("applications").Where("name='Trading Platform' and deleted=0").One("id"))
        imageId = @1UploadBinary("ApplicationId,Name,Data", appId, "avatar", $Photo)
        image["id"] = imageId

        @1buffer_Manager("Action,Key,Val", "set", "avatar", JSONEncode(image))
    }
}